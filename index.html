<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>절대강자 메모장</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 50%, #7fc9a5 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 15px;
            padding: 10px 20px;
            position: relative;
        }

        .backup-btn {
            position: absolute;
            top: 10px;
            right: 0;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .backup-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* 백업 모달 스타일 */
        .backup-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .backup-modal-overlay.active {
            display: flex;
        }

        .backup-modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .backup-modal-header {
            background: linear-gradient(135deg, #4aba7a 0%, #7fc9a5 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .backup-modal-header h2 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .backup-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .backup-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .backup-modal-body {
            padding: 25px;
        }

        .backup-option {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .backup-option:hover {
            background: #f0f1f3;
            border-color: #667eea;
        }

        .backup-option-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            margin-bottom: 12px;
        }

        .backup-option-icon.download {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .backup-option-icon.upload {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .backup-option-icon.delete {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }

        .delete-all-option {
            border: 2px solid #ffebee;
        }

        .delete-all-option:hover {
            background: #fff5f5 !important;
            border-color: #ff416c !important;
        }

        .backup-option h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .backup-option p {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .backup-info {
            background: #fff3cd;
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 12px;
            color: #856404;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .backup-info i {
            font-size: 16px;
            margin-top: 2px;
        }

        /* 파일 입력 숨김 */
        #backupFileInput {
            display: none;
        }

        /* 메뉴 관리 버튼 스타일 */
        .menu-manage-btn {
            position: absolute;
            top: 10px;
            left: 0;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-manage-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* 메뉴 관리 모달 스타일 */
        .menu-manage-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .menu-manage-modal-overlay.active {
            display: flex;
        }

        .menu-manage-modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .menu-manage-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .menu-manage-modal-header h2 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-manage-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-manage-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .menu-manage-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .menu-manage-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .menu-manage-tab {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: #f0f1f3;
            color: #666;
        }

        .menu-manage-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .menu-manage-tab:hover:not(.active) {
            background: #e0e1e3;
        }

        .menu-manage-section {
            display: none;
        }

        .menu-manage-section.active {
            display: block;
        }

        .menu-manage-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .menu-manage-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-manage-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .menu-manage-item:hover {
            background: #f0f1f3;
        }

        .menu-manage-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .menu-manage-item-info {
            flex: 1;
        }

        .menu-manage-item-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .menu-manage-item-category {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }

        .menu-manage-item-actions {
            display: flex;
            gap: 8px;
        }

        .menu-manage-action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-manage-action-btn.hide {
            background: #fff3cd;
            color: #856404;
        }

        .menu-manage-action-btn.hide:hover {
            background: #ffeaa7;
        }

        .menu-manage-action-btn.show {
            background: #d4edda;
            color: #155724;
        }

        .menu-manage-action-btn.show:hover {
            background: #c3e6cb;
        }

        .menu-manage-action-btn.delete {
            background: #f8d7da;
            color: #721c24;
        }

        .menu-manage-action-btn.delete:hover {
            background: #f5c6cb;
        }

        .menu-manage-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .menu-manage-empty i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .menu-manage-empty p {
            font-size: 14px;
            line-height: 1.5;
        }

        /* 숨겨진 메뉴 아이템 스타일 */
        .grid-item.hidden-menu {
            display: none !important;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 10px;
        }

        .grid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .grid-item:hover {
            transform: translateY(-5px);
        }

        .icon-box {
            width: 80px;
            height: 80px;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .grid-item:hover .icon-box {
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.25);
        }

        /* 일반 메모 - 보라색 */
        .memo-general {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* 할일 목록 - 핑크 */
        .todo-list {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* 일정 관리 - 부드러운 블루그레이 */
        .schedule {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
        }

        /* 여행 관리 - 오렌지/코랄 */
        .travel {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        /* 맛집 관리 - 노랑/골드 */
        .restaurant {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }

        /* 병원 관리 - 의료 블루 */
        .hospital {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* 사이트 관리 - 틸 그린 */
        .sitemanage {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        /* 계좌번호 관리 - 민트/청록 */
        .bankaccount {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        /* 문화관리 - 노랑/골드 (맛집 스타일) */
        .culture {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }

        /* 사람관리 - 레드/오렌지 (맛집 스타일) */
        .people {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }



        .grid-item span {
            color: white;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            line-height: 1.4;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h2 i {
            font-size: 24px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-body {
            padding: 20px;
            max-height: calc(90vh - 140px);
            overflow-y: auto;
        }

        .add-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .add-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .item-list {
            margin-top: 20px;
        }

        .item-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            position: relative;
            transition: all 0.2s;
        }

        .item-card:hover {
            background: #f0f1f3;
        }

        .item-card h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            padding-right: 60px;
        }

        .item-card p {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .item-card .meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .item-card .tag {
            background: #e0e0e0;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            color: #555;
        }

        .item-card .date-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .item-card .rating {
            color: #ffc107;
        }

        .item-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
        }

        .item-actions button {
            background: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .item-actions .edit-btn {
            color: #667eea;
        }

        .item-actions .delete-btn {
            color: #ff5f6d;
        }

        .item-actions button:hover {
            transform: scale(1.1);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* Travel specific styles */
        .travel-header .modal-header {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .travel-header .modal-close {
            color: white;
        }

        .travel-header .add-btn {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        /* Restaurant specific styles */
        .restaurant-header .modal-header {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
        }

        .restaurant-header .modal-close {
            color: white;
        }

        .restaurant-header .add-btn {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }

        /* ========== 여행관리 전체화면 모달 스타일 ========== */
        .travel-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fff5f7 0%, #fff0e6 50%, #fff5e6 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .travel-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .travel-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(250, 112, 154, 0.2);
            box-shadow: 0 2px 20px rgba(250, 112, 154, 0.1);
        }

        .travel-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .travel-modal-header h2 i {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .travel-back-btn {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.4);
        }

        .travel-back-btn:hover {
            transform: scale(1.05);
        }

        .travel-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .travel-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(250, 112, 154, 0.12);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(250, 112, 154, 0.1);
        }

        .travel-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(250, 112, 154, 0.2);
        }

        .travel-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .travel-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .travel-card-title i {
            color: #fa709a;
        }

        .travel-card-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .travel-card-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            color: #666;
            font-size: 14px;
        }

        .travel-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .travel-card-info i {
            width: 18px;
            color: #fa709a;
        }

        .travel-card-memo {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
            color: #888;
            font-size: 13px;
            line-height: 1.5;
        }

        .travel-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(250, 112, 154, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .travel-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(250, 112, 154, 0.6);
        }

        .travel-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .travel-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .travel-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 여행 상세보기 모달 */
        .travel-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fff5f7 0%, #fff0e6 50%, #fff5e6 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .travel-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .travel-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(250, 112, 154, 0.2);
        }

        .travel-detail-header .left-actions button,
        .travel-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .travel-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .travel-detail-header button:hover {
            background: rgba(250, 112, 154, 0.1);
            color: #fa709a;
        }

        .travel-detail-header .delete-action:hover {
            background: rgba(255, 95, 109, 0.1);
            color: #ff5f6d;
        }

        .travel-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .travel-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .travel-detail-title i {
            color: #fa709a;
        }

        .travel-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(250, 112, 154, 0.1);
        }

        .travel-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .travel-detail-info-item:last-child {
            border-bottom: none;
        }

        .travel-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(250, 112, 154, 0.1) 0%, rgba(254, 225, 64, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fa709a;
            font-size: 16px;
        }

        .travel-detail-info-item .info-content {
            flex: 1;
        }

        .travel-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .travel-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .travel-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(250, 112, 154, 0.1);
        }

        .travel-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .travel-detail-memo-card h4 i {
            color: #fa709a;
        }

        .travel-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* 여행 입력 폼 모달 */
        .travel-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fff5f7 0%, #fff0e6 50%, #fff5e6 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .travel-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .travel-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(250, 112, 154, 0.2);
        }

        .travel-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .travel-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
        }

        .travel-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .travel-form-group {
            margin-bottom: 20px;
        }

        .travel-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .travel-form-group input,
        .travel-form-group textarea,
        .travel-form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .travel-form-group input:focus,
        .travel-form-group textarea:focus,
        .travel-form-group select:focus {
            outline: none;
            border-color: #fa709a;
            box-shadow: 0 0 0 4px rgba(250, 112, 154, 0.1);
        }

        .travel-form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .travel-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.4);
        }

        .travel-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(250, 112, 154, 0.5);
        }

        /* ========== 맛집관리 전체화면 모달 스타일 ========== */
        .restaurant-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .restaurant-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .restaurant-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
            box-shadow: 0 2px 20px rgba(255, 78, 80, 0.1);
        }

        .restaurant-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .restaurant-modal-header h2 i {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .restaurant-back-btn {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255, 78, 80, 0.4);
        }

        .restaurant-back-btn:hover {
            transform: scale(1.05);
        }

        .restaurant-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .restaurant-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 78, 80, 0.1);
        }

        .restaurant-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 78, 80, 0.18);
        }

        .restaurant-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .restaurant-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .restaurant-card-title i {
            color: #ff4e50;
        }

        .restaurant-card-category {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
        }

        .restaurant-card-rating {
            color: #ffc107;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .restaurant-card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            color: #666;
            font-size: 14px;
        }

        .restaurant-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .restaurant-card-info i {
            width: 16px;
            color: #ff4e50;
        }

        .restaurant-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(255, 78, 80, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .restaurant-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(255, 78, 80, 0.6);
        }

        .restaurant-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .restaurant-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .restaurant-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 맛집 상세보기 모달 */
        .restaurant-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .restaurant-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .restaurant-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
        }

        .restaurant-detail-header .left-actions button,
        .restaurant-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .restaurant-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .restaurant-detail-header button:hover {
            background: rgba(255, 78, 80, 0.1);
            color: #ff4e50;
        }

        .restaurant-detail-header .delete-action:hover {
            background: rgba(255, 95, 109, 0.1);
            color: #ff5f6d;
        }

        .restaurant-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .restaurant-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .restaurant-detail-title i {
            color: #ff4e50;
        }

        .restaurant-detail-rating {
            font-size: 24px;
            color: #ffc107;
            margin-bottom: 20px;
        }

        .restaurant-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.08);
        }

        .restaurant-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .restaurant-detail-info-item:last-child {
            border-bottom: none;
        }

        .restaurant-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(249, 212, 35, 0.1) 0%, rgba(255, 78, 80, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff4e50;
            font-size: 16px;
        }

        .restaurant-detail-info-item .info-content {
            flex: 1;
        }

        .restaurant-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .restaurant-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .restaurant-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.08);
        }

        .restaurant-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .restaurant-detail-memo-card h4 i {
            color: #ff4e50;
        }

        .restaurant-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* 맛집 입력 폼 모달 */
        .restaurant-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .restaurant-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .restaurant-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
        }

        .restaurant-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .restaurant-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
        }

        .restaurant-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .restaurant-form-group {
            margin-bottom: 20px;
        }

        .restaurant-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .restaurant-form-group input,
        .restaurant-form-group textarea,
        .restaurant-form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .restaurant-form-group input:focus,
        .restaurant-form-group textarea:focus,
        .restaurant-form-group select:focus {
            outline: none;
            border-color: #ff4e50;
            box-shadow: 0 0 0 4px rgba(255, 78, 80, 0.1);
        }

        .restaurant-form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .restaurant-star-rating {
            display: flex;
            gap: 8px;
            padding: 10px 0;
        }

        .restaurant-star-rating i {
            font-size: 28px;
            color: #ddd;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restaurant-star-rating i:hover,
        .restaurant-star-rating i.active {
            color: #ffc107;
            transform: scale(1.1);
        }

        .restaurant-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 78, 80, 0.4);
        }

        .restaurant-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 78, 80, 0.5);
        }

        /* ========== 사람관리 전체화면 모달 스타일 (맛집 스타일 기반) ========== */
        .people-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .people-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .people-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
            box-shadow: 0 2px 20px rgba(255, 78, 80, 0.1);
        }

        .people-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .people-modal-header h2 i {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .people-back-btn {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255, 78, 80, 0.4);
        }

        .people-back-btn:hover {
            transform: scale(1.05);
        }

        .people-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .people-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 78, 80, 0.1);
        }

        .people-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 78, 80, 0.18);
        }

        .people-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .people-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .people-card-title i {
            color: #ff4e50;
        }

        .people-card-relation {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
        }

        .people-card-importance {
            font-size: 14px;
            margin-bottom: 10px;
        }

        .people-card-importance.high {
            color: #ff4e50;
        }

        .people-card-importance.medium {
            color: #f9a825;
        }

        .people-card-importance.low {
            color: #9e9e9e;
        }

        .people-card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            color: #666;
            font-size: 14px;
        }

        .people-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .people-card-info i {
            width: 16px;
            color: #ff4e50;
        }

        .people-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(255, 78, 80, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .people-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(255, 78, 80, 0.6);
        }

        .people-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .people-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .people-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 사람 상세보기 모달 */
        .people-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .people-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .people-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
        }

        .people-detail-header .left-actions button,
        .people-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .people-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .people-detail-header button:hover {
            background: rgba(255, 78, 80, 0.1);
            color: #ff4e50;
        }

        .people-detail-header .delete-action:hover {
            background: rgba(255, 95, 109, 0.1);
            color: #ff5f6d;
        }

        .people-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .people-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .people-detail-title i {
            color: #ff4e50;
        }

        .people-detail-importance {
            font-size: 20px;
            margin-bottom: 20px;
        }

        .people-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.08);
        }

        .people-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .people-detail-info-item:last-child {
            border-bottom: none;
        }

        .people-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(249, 212, 35, 0.1) 0%, rgba(255, 78, 80, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff4e50;
            font-size: 16px;
        }

        .people-detail-info-item .info-content {
            flex: 1;
        }

        .people-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .people-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .people-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.08);
        }

        .people-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .people-detail-memo-card h4 i {
            color: #ff4e50;
        }

        .people-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* 사람 입력 폼 모달 */
        .people-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .people-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .people-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
        }

        .people-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .people-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
        }

        .people-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .people-form-group {
            margin-bottom: 20px;
        }

        .people-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .people-form-group input,
        .people-form-group textarea,
        .people-form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .people-form-group input:focus,
        .people-form-group textarea:focus,
        .people-form-group select:focus {
            outline: none;
            border-color: #ff4e50;
            box-shadow: 0 0 0 4px rgba(255, 78, 80, 0.1);
        }

        .people-form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .people-importance-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .people-importance-option {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }

        .people-importance-option:hover {
            border-color: #ff4e50;
        }

        .people-importance-option.active {
            border-color: #ff4e50;
            background: linear-gradient(135deg, rgba(249, 212, 35, 0.1) 0%, rgba(255, 78, 80, 0.1) 100%);
            color: #ff4e50;
        }

        .people-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 78, 80, 0.4);
        }

        .people-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 78, 80, 0.5);
        }

        /* ========== 문화관리 전체화면 모달 스타일 (맛집 스타일 기반) ========== */
        .culture-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .culture-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .culture-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
            box-shadow: 0 2px 20px rgba(255, 78, 80, 0.1);
        }

        .culture-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .culture-modal-header h2 i {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .culture-back-btn {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255, 78, 80, 0.4);
        }

        .culture-back-btn:hover {
            transform: scale(1.05);
        }

        .culture-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .culture-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 78, 80, 0.1);
        }

        .culture-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 78, 80, 0.18);
        }

        .culture-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .culture-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .culture-card-title i {
            color: #ff4e50;
        }

        .culture-card-genre {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
        }

        .culture-card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            color: #666;
            font-size: 14px;
        }

        .culture-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .culture-card-info i {
            width: 16px;
            color: #ff4e50;
        }

        .culture-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(255, 78, 80, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .culture-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(255, 78, 80, 0.6);
        }

        .culture-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .culture-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .culture-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 문화 상세보기 모달 */
        .culture-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .culture-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .culture-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
        }

        .culture-detail-header .left-actions button,
        .culture-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .culture-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .culture-detail-header button:hover {
            background: rgba(255, 78, 80, 0.1);
            color: #ff4e50;
        }

        .culture-detail-header .delete-action:hover {
            background: rgba(255, 95, 109, 0.1);
            color: #ff5f6d;
        }

        .culture-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .culture-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .culture-detail-title i {
            color: #ff4e50;
        }

        .culture-detail-genre-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
            margin-bottom: 20px;
        }

        .culture-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.08);
        }

        .culture-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .culture-detail-info-item:last-child {
            border-bottom: none;
        }

        .culture-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(249, 212, 35, 0.1) 0%, rgba(255, 78, 80, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff4e50;
            font-size: 16px;
        }

        .culture-detail-info-item .info-content {
            flex: 1;
        }

        .culture-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .culture-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .culture-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(255, 78, 80, 0.08);
        }

        .culture-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .culture-detail-memo-card h4 i {
            color: #ff4e50;
        }

        .culture-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* 문화 입력 폼 모달 */
        .culture-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #fffdf5 0%, #fff8e6 50%, #fff5e0 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .culture-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .culture-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 78, 80, 0.2);
        }

        .culture-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .culture-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
        }

        .culture-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .culture-form-group {
            margin-bottom: 20px;
        }

        .culture-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .culture-form-group input,
        .culture-form-group textarea,
        .culture-form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .culture-form-group input:focus,
        .culture-form-group textarea:focus,
        .culture-form-group select:focus {
            outline: none;
            border-color: #ff4e50;
            box-shadow: 0 0 0 4px rgba(255, 78, 80, 0.1);
        }

        .culture-form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .culture-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 78, 80, 0.4);
        }

        .culture-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 78, 80, 0.5);
        }

        /* ========== 계좌번호관리 전체화면 모달 스타일 ========== */
        .bankaccount-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0fff4 0%, #dcffe4 50%, #c6f7d4 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .bankaccount-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .bankaccount-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(17, 153, 142, 0.2);
            box-shadow: 0 2px 20px rgba(17, 153, 142, 0.1);
        }

        .bankaccount-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bankaccount-modal-header h2 i {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bankaccount-back-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .bankaccount-back-btn:hover {
            transform: scale(1.05);
        }

        .bankaccount-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .bankaccount-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(17, 153, 142, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(17, 153, 142, 0.1);
        }

        .bankaccount-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(17, 153, 142, 0.18);
        }

        .bankaccount-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .bankaccount-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bankaccount-card-title i {
            color: #11998e;
        }

        .bankaccount-card-bank {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .bankaccount-card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            color: #666;
            font-size: 14px;
        }

        .bankaccount-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bankaccount-card-info i {
            width: 16px;
            color: #11998e;
        }

        .bankaccount-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(17, 153, 142, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .bankaccount-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(17, 153, 142, 0.6);
        }

        .bankaccount-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .bankaccount-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .bankaccount-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 계좌번호 상세보기 모달 */
        .bankaccount-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0fff4 0%, #dcffe4 50%, #c6f7d4 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .bankaccount-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .bankaccount-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(17, 153, 142, 0.2);
        }

        .bankaccount-detail-header .left-actions button,
        .bankaccount-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bankaccount-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .bankaccount-detail-header button:hover {
            background: rgba(17, 153, 142, 0.1);
            color: #11998e;
        }

        .bankaccount-detail-header .delete-action:hover {
            background: rgba(255, 95, 109, 0.1);
            color: #ff5f6d;
        }

        .bankaccount-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .bankaccount-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bankaccount-detail-title i {
            color: #11998e;
        }

        .bankaccount-detail-bank {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            margin-bottom: 20px;
        }

        .bankaccount-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(17, 153, 142, 0.08);
        }

        .bankaccount-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .bankaccount-detail-info-item:last-child {
            border-bottom: none;
        }

        .bankaccount-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #11998e;
            font-size: 16px;
        }

        .bankaccount-detail-info-item .info-content {
            flex: 1;
        }

        .bankaccount-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .bankaccount-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .bankaccount-detail-info-item .info-value.account-number {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #11998e;
        }

        .bankaccount-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(17, 153, 142, 0.08);
        }

        .bankaccount-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bankaccount-detail-memo-card h4 i {
            color: #11998e;
        }

        .bankaccount-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .bankaccount-detail-warning {
            background: #fff3cd;
            border-radius: 12px;
            padding: 12px 15px;
            margin-top: 20px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 13px;
            color: #856404;
        }

        .bankaccount-detail-warning i {
            font-size: 16px;
            margin-top: 2px;
        }

        /* 계좌번호 입력 폼 모달 */
        .bankaccount-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0fff4 0%, #dcffe4 50%, #c6f7d4 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .bankaccount-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .bankaccount-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(17, 153, 142, 0.2);
        }

        .bankaccount-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .bankaccount-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
        }

        .bankaccount-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .bankaccount-form-group {
            margin-bottom: 20px;
        }

        .bankaccount-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .bankaccount-form-group input,
        .bankaccount-form-group textarea,
        .bankaccount-form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .bankaccount-form-group input:focus,
        .bankaccount-form-group textarea:focus,
        .bankaccount-form-group select:focus {
            outline: none;
            border-color: #11998e;
            box-shadow: 0 0 0 4px rgba(17, 153, 142, 0.1);
        }

        .bankaccount-form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .bankaccount-form-warning {
            background: #fff3cd;
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 13px;
            color: #856404;
        }

        .bankaccount-form-warning i {
            font-size: 16px;
            margin-top: 2px;
        }

        .bankaccount-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .bankaccount-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.5);
        }

        /* 계좌번호 복사 버튼 */
        .copy-account-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: auto;
        }

        .copy-account-btn:hover {
            transform: scale(1.05);
        }

        .copy-account-btn i {
            margin-right: 5px;
        }

        /* ========== 병원관리 전체화면 모달 스타일 ========== */
        .hospital-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .hospital-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .hospital-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
            box-shadow: 0 2px 20px rgba(79, 172, 254, 0.1);
        }

        .hospital-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hospital-modal-header h2 i {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hospital-back-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .hospital-back-btn:hover {
            transform: scale(1.05);
        }

        .hospital-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .hospital-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(79, 172, 254, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(79, 172, 254, 0.1);
        }

        .hospital-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(79, 172, 254, 0.18);
        }

        .hospital-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .hospital-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hospital-card-title i {
            color: #4facfe;
        }

        .hospital-card-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .hospital-card-status.미진행 {
            background: #9ca3af;
        }

        .hospital-card-status.예약 {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        }

        .hospital-card-status.진행중 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .hospital-card-status.완료 {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        }

        .hospital-card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            color: #666;
            font-size: 14px;
        }

        .hospital-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hospital-card-info i {
            width: 16px;
            color: #4facfe;
        }

        .hospital-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(79, 172, 254, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .hospital-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(79, 172, 254, 0.6);
        }

        .hospital-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .hospital-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .hospital-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 병원 상세보기 모달 */
        .hospital-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .hospital-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .hospital-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
        }

        .hospital-detail-header .left-actions button,
        .hospital-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hospital-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .hospital-detail-header button:hover {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
        }

        .hospital-detail-header .delete-action:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .hospital-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .hospital-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hospital-detail-title i {
            color: #4facfe;
        }

        .hospital-detail-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 20px;
        }

        .hospital-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(79, 172, 254, 0.08);
        }

        .hospital-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .hospital-detail-info-item:last-child {
            border-bottom: none;
        }

        .hospital-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4facfe;
            font-size: 16px;
        }

        .hospital-detail-info-item .info-content {
            flex: 1;
        }

        .hospital-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .hospital-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .hospital-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(79, 172, 254, 0.08);
            margin-bottom: 20px;
        }

        .hospital-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hospital-detail-memo-card h4 i {
            color: #4facfe;
        }

        .hospital-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* 병원 입력 폼 모달 */
        .hospital-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .hospital-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .hospital-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(79, 172, 254, 0.2);
        }

        .hospital-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .hospital-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
        }

        .hospital-form-header button:hover {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
        }

        .hospital-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .hospital-form-group {
            margin-bottom: 20px;
        }

        .hospital-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .hospital-form-group input,
        .hospital-form-group textarea,
        .hospital-form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .hospital-form-group input:focus,
        .hospital-form-group textarea:focus,
        .hospital-form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.1);
        }

        .hospital-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .hospital-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .hospital-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.5);
        }

        /* ========== 사이트관리 전체화면 모달 스타일 ========== */
        .sitemanage-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0fff4 0%, #dcfce7 50%, #bbf7d0 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .sitemanage-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .sitemanage-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(17, 153, 142, 0.2);
            box-shadow: 0 2px 20px rgba(17, 153, 142, 0.1);
        }

        .sitemanage-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sitemanage-modal-header h2 i {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sitemanage-back-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .sitemanage-back-btn:hover {
            transform: scale(1.05);
        }

        .sitemanage-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 20px 100px;
        }

        .sitemanage-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(17, 153, 142, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(17, 153, 142, 0.1);
        }

        .sitemanage-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(17, 153, 142, 0.18);
        }

        .sitemanage-card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .sitemanage-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sitemanage-card-title i {
            color: #11998e;
        }

        .sitemanage-card-link {
            color: #11998e;
            font-size: 14px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            background: rgba(17, 153, 142, 0.1);
            transition: all 0.2s;
        }

        .sitemanage-card-link:hover {
            background: rgba(17, 153, 142, 0.2);
        }

        .sitemanage-card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            color: #666;
            font-size: 14px;
        }

        .sitemanage-card-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sitemanage-card-info i {
            width: 16px;
            color: #11998e;
        }

        .sitemanage-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(17, 153, 142, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
        }

        .sitemanage-fab:hover {
            transform: scale(1.1) translateY(-3px);
            box-shadow: 0 10px 35px rgba(17, 153, 142, 0.6);
        }

        .sitemanage-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .sitemanage-empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.5;
        }

        .sitemanage-empty-state p {
            font-size: 15px;
            line-height: 1.6;
        }

        /* 사이트 상세보기 모달 */
        .sitemanage-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0fff4 0%, #dcfce7 50%, #bbf7d0 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .sitemanage-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .sitemanage-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(17, 153, 142, 0.2);
        }

        .sitemanage-detail-header .left-actions button,
        .sitemanage-detail-header .right-actions button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sitemanage-detail-header .right-actions {
            display: flex;
            gap: 5px;
        }

        .sitemanage-detail-header button:hover {
            background: rgba(17, 153, 142, 0.1);
            color: #11998e;
        }

        .sitemanage-detail-header .delete-action:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .sitemanage-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .sitemanage-detail-title {
            font-size: 26px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sitemanage-detail-title i {
            color: #11998e;
        }

        .sitemanage-detail-url {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            color: white;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            margin-bottom: 20px;
            text-decoration: none;
            transition: all 0.3s;
        }

        .sitemanage-detail-url:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .sitemanage-detail-info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(17, 153, 142, 0.08);
        }

        .sitemanage-detail-info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .sitemanage-detail-info-item:last-child {
            border-bottom: none;
        }

        .sitemanage-detail-info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #11998e;
            font-size: 16px;
        }

        .sitemanage-detail-info-item .info-content {
            flex: 1;
        }

        .sitemanage-detail-info-item .info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .sitemanage-detail-info-item .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .sitemanage-detail-memo-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(17, 153, 142, 0.08);
            margin-bottom: 20px;
        }

        .sitemanage-detail-memo-card h4 {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sitemanage-detail-memo-card h4 i {
            color: #11998e;
        }

        .sitemanage-detail-memo-card p {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .sitemanage-warning {
            background: #fef3c7;
            border-radius: 12px;
            padding: 12px 15px;
            font-size: 12px;
            color: #92400e;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .sitemanage-warning i {
            width: auto !important;
            height: auto !important;
            background: none !important;
            font-size: 16px;
        }

        /* 사이트 입력 폼 모달 */
        .sitemanage-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f0fff4 0%, #dcfce7 50%, #bbf7d0 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .sitemanage-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .sitemanage-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(17, 153, 142, 0.2);
        }

        .sitemanage-form-header h2 {
            color: #333;
            font-size: 20px;
            font-weight: 600;
        }

        .sitemanage-form-header button {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: #666;
            font-size: 18px;
            transition: all 0.2s;
        }

        .sitemanage-form-header button:hover {
            background: rgba(17, 153, 142, 0.1);
            color: #11998e;
        }

        .sitemanage-form-body {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .sitemanage-form-group {
            margin-bottom: 20px;
        }

        .sitemanage-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .sitemanage-form-group input,
        .sitemanage-form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .sitemanage-form-group input:focus,
        .sitemanage-form-group textarea:focus {
            outline: none;
            border-color: #11998e;
            box-shadow: 0 0 0 4px rgba(17, 153, 142, 0.1);
        }

        .sitemanage-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .sitemanage-form-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        .sitemanage-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.5);
        }

        .sitemanage-form-warning {
            background: #fef3c7;
            border-radius: 12px;
            padding: 12px 15px;
            font-size: 12px;
            color: #92400e;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .sitemanage-form-warning i {
            font-size: 16px;
        }

        /* Star rating input */
        .star-rating {
            display: flex;
            gap: 5px;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }

        .star-rating input {
            display: none;
        }

        .star-rating label {
            cursor: pointer;
            font-size: 24px;
            color: #ddd;
            transition: color 0.2s;
        }

        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #ffc107;
        }

        /* Responsive */
        @media (max-width: 400px) {
            .grid-container {
                gap: 15px;
            }

            .icon-box {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }

            .grid-item span {
                font-size: 12px;
            }
        }

        /* Image preview */
        .image-preview {
            width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 10px;
        }

        .item-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* ========== 할일 목록 전체화면 모달 스타일 (밝은 테마) ========== */
        .todo-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f8f9ff 0%, #e8eeff 50%, #dde4ff 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .todo-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .todo-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 2px 20px rgba(102, 126, 234, 0.1);
        }

        .todo-modal-header h2 {
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .todo-modal-header h2 i {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .todo-back-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .todo-back-btn:hover {
            transform: scale(1.05);
        }

        .todo-date-display {
            text-align: center;
            padding: 15px 20px;
            background: white;
            margin: 15px 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
        }

        .todo-date-display .date-main {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .todo-date-display .date-sub {
            font-size: 14px;
            color: #666;
        }

        .todo-success-rate {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px 20px;
            margin: 0 20px 15px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
        }

        .todo-success-rate .rate-circle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: conic-gradient(#10b981 var(--rate), #e5e7eb var(--rate));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .todo-success-rate .rate-circle::before {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
        }

        .todo-success-rate .rate-text {
            position: relative;
            z-index: 1;
            font-size: 16px;
            font-weight: 700;
            color: #10b981;
        }

        .todo-success-rate .rate-info {
            text-align: left;
        }

        .todo-success-rate .rate-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .todo-success-rate .rate-info p {
            font-size: 13px;
            color: #666;
        }

        .todo-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 100px;
        }

        .todo-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 20px 0 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .todo-section-title i {
            color: #f093fb;
        }

        .todo-item {
            background: white;
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 15px rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .todo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.2);
        }

        .todo-item.completed {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .todo-item.completed .todo-title {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .todo-checkbox {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .todo-checkbox:hover {
            border-color: #10b981;
        }

        .todo-checkbox.checked {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: transparent;
        }

        .todo-checkbox.checked i {
            color: white;
            font-size: 14px;
        }

        .todo-content {
            flex: 1;
            min-width: 0;
        }

        .todo-title {
            font-size: 15px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
            word-break: break-word;
        }

        .todo-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .todo-tag {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 20px;
            background: #f3f4f6;
            color: #6b7280;
        }

        .todo-tag.daily {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1d4ed8;
        }

        .todo-tag.weekday {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #b45309;
        }

        .todo-tag.specific {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            color: #7c3aed;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .todo-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .todo-action-btn.end-btn {
            background: #fef2f2;
            color: #ef4444;
        }

        .todo-action-btn.end-btn:hover {
            background: #fee2e2;
        }

        .todo-action-btn.delete-btn {
            background: #f3f4f6;
            color: #6b7280;
        }

        .todo-action-btn.delete-btn:hover {
            background: #e5e7eb;
            color: #ef4444;
        }

        /* 할일 추가 버튼 (플로팅) */
        .todo-add-floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            cursor: pointer;
            color: white;
            font-size: 26px;
            box-shadow: 0 6px 25px rgba(240, 147, 251, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .todo-add-floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 35px rgba(240, 147, 251, 0.6);
        }

        /* 할일 추가 모달 */
        .todo-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: flex-end;
            padding: 0;
        }

        .todo-form-modal.active {
            display: flex;
        }

        .todo-form-content {
            background: white;
            width: 100%;
            max-width: 500px;
            border-radius: 24px 24px 0 0;
            padding: 25px;
            animation: slideUpModal 0.3s ease;
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes slideUpModal {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .todo-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .todo-form-header h3 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .todo-form-close {
            background: #f3f4f6;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: #6b7280;
            transition: all 0.2s ease;
        }

        .todo-form-close:hover {
            background: #e5e7eb;
            color: #333;
        }

        .todo-form-group {
            margin-bottom: 20px;
        }

        .todo-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .todo-form-group input[type="text"] {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }

        .todo-form-group input[type="text"]:focus {
            outline: none;
            border-color: #f093fb;
        }

        .todo-repeat-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .todo-repeat-option {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            background: white;
        }

        .todo-repeat-option:hover {
            border-color: #f093fb;
        }

        .todo-repeat-option.selected {
            border-color: #f093fb;
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
        }

        .todo-repeat-option i {
            font-size: 22px;
            margin-bottom: 6px;
            display: block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .todo-repeat-option span {
            font-size: 12px;
            color: #333;
            font-weight: 500;
        }

        .todo-weekday-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .todo-weekday-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e5e7eb;
            background: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s ease;
        }

        .todo-weekday-btn:hover {
            border-color: #f093fb;
        }

        .todo-weekday-btn.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-color: transparent;
            color: white;
        }

        .todo-date-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            margin-top: 10px;
        }

        .todo-date-input:focus {
            outline: none;
            border-color: #f093fb;
        }

        .todo-submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }

        .todo-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(240, 147, 251, 0.4);
        }

        /* 지난 할일 섹션 */
        .todo-past-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px dashed #e5e7eb;
        }

        .todo-past-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .todo-past-header h4 {
            font-size: 15px;
            font-weight: 600;
            color: #9ca3af;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .todo-past-toggle {
            font-size: 14px;
            color: #9ca3af;
            transition: transform 0.3s ease;
        }

        .todo-past-toggle.expanded {
            transform: rotate(180deg);
        }

        .todo-past-list {
            display: none;
        }

        .todo-past-list.expanded {
            display: block;
        }

        .todo-past-date-group {
            margin-bottom: 15px;
        }

        .todo-past-date-title {
            font-size: 13px;
            font-weight: 600;
            color: #9ca3af;
            margin-bottom: 10px;
            padding-left: 5px;
        }

        .todo-past-item {
            background: #f9fafb;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 8px;
            opacity: 0.7;
        }

        .todo-past-item .todo-title {
            font-size: 14px;
            color: #6b7280;
        }

        .todo-past-item .todo-status {
            font-size: 11px;
            margin-top: 4px;
        }

        .todo-past-item .todo-status.completed {
            color: #10b981;
        }

        .todo-past-item .todo-status.incomplete {
            color: #ef4444;
        }

        /* 종료된 할일 표시 */
        .todo-item.ended {
            opacity: 0.5;
            background: #f9fafb;
        }

        .todo-item.ended .todo-title {
            text-decoration: line-through;
            color: #9ca3af;
        }

        /* ========== 일반 메모 전체화면 모달 스타일 ========== */
        .memo-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            z-index: 2000;
            animation: fadeInUp 0.3s ease;
        }

        .memo-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .memo-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .memo-modal-header h2 {
            color: #fff;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .memo-modal-header h2 i {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .memo-back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .memo-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            padding-bottom: 100px;
        }

        /* 날짜 그룹 헤더 */
        .date-group {
            margin-bottom: 24px;
        }

        .date-group-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .date-group-header .date-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 16px;
        }

        .date-group-header .date-info {
            flex: 1;
        }

        .date-group-header .date-text {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }

        .date-group-header .date-count {
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            margin-top: 2px;
        }

        /* 메모 카드 리스트 아이템 */
        .memo-list-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 18px 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
        }

        .memo-list-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .memo-list-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(4px);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .memo-list-item:hover::before {
            opacity: 1;
        }

        .memo-list-item:active {
            transform: translateX(4px) scale(0.98);
        }

        .memo-list-item h4 {
            color: #fff;
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .memo-list-item .memo-preview {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .memo-list-item .memo-time {
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* 플로팅 추가 버튼 */
        .memo-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
            z-index: 2001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .memo-fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
        }

        .memo-fab:active {
            transform: scale(1.05) rotate(90deg);
        }

        /* 빈 상태 */
        .memo-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }

        .memo-empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .memo-empty-state p {
            font-size: 16px;
            line-height: 1.6;
        }

        /* 상세보기 모달 */
        .memo-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            z-index: 2002;
            animation: fadeInUp 0.3s ease;
        }

        .memo-detail-modal.active {
            display: flex;
            flex-direction: column;
        }

        .memo-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .memo-detail-header .left-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .memo-detail-header .right-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .memo-detail-header button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-detail-header button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .memo-detail-header .delete-action {
            color: #ff6b6b;
        }

        .memo-detail-header .delete-action:hover {
            background: rgba(255, 107, 107, 0.2);
        }

        .memo-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px 24px;
        }

        .memo-detail-content .memo-date {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            margin-bottom: 16px;
        }

        .memo-detail-content h3 {
            color: #fff;
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 24px;
            line-height: 1.4;
        }

        .memo-detail-content .memo-body {
            color: rgba(255, 255, 255, 0.85);
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* 메모 추가/수정 모달 */
        .memo-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            z-index: 2003;
            animation: fadeInUp 0.3s ease;
        }

        .memo-form-modal.active {
            display: flex;
            flex-direction: column;
        }

        .memo-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .memo-form-header h2 {
            color: #fff;
            font-size: 20px;
            font-weight: 600;
        }

        .memo-form-header .header-btns {
            display: flex;
            gap: 10px;
        }

        .memo-cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-cancel-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .memo-save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-save-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .memo-form-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 24px;
            overflow-y: auto;
        }

        .memo-form-body .form-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            padding: 16px 18px;
            color: #fff;
            font-size: 18px;
            font-family: inherit;
            font-weight: 600;
            margin-bottom: 16px;
            transition: all 0.2s;
        }

        .memo-form-body .form-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }

        .memo-form-body .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .memo-form-body .form-textarea {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            padding: 18px;
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            line-height: 1.7;
            resize: none;
            transition: all 0.2s;
        }

        .memo-form-body .form-textarea:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }

        .memo-form-body .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* 메모 이미지 업로드 스타일 */
        .memo-image-upload-section {
            margin-top: 16px;
        }

        .memo-image-buttons {
            display: flex;
            gap: 12px;
        }

        .memo-image-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 14px;
            padding: 18px 12px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-image-upload-label.gallery-btn:hover {
            border-color: rgba(74, 222, 128, 0.6);
            background: rgba(74, 222, 128, 0.15);
            color: #4ade80;
        }

        .memo-image-upload-label.camera-btn:hover {
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
        }

        /* Flutter WebView에서 카메라 버튼 숨김 */
        body.flutter-webview .memo-image-upload-label.camera-btn {
            display: none;
        }
        
        body.flutter-webview .memo-image-buttons {
            gap: 0;
        }
        
        body.flutter-webview .memo-image-upload-label.gallery-btn {
            flex: 1;
            max-width: 100%;
        }



        .memo-image-upload-label i {
            font-size: 24px;
        }

        .memo-image-upload-label span {
            font-size: 14px;
        }

        .memo-image-preview-container {
            margin-top: 12px;
            display: none;
            position: relative;
        }

        .memo-image-preview-container.active {
            display: block;
        }

        .memo-image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .memo-image-remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memo-image-remove-btn:hover {
            background: rgba(255, 107, 107, 0.8);
            transform: scale(1.1);
        }

        /* 메모 리스트 아이템의 이미지 썸네일 */
        .memo-list-item-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        /* 메모 상세보기 이미지 */
        .memo-detail-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 14px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .memo-detail-image:hover {
            transform: scale(1.02);
        }

        /* 이미지 전체화면 보기 */
        .image-fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .image-fullscreen-overlay.active {
            display: flex;
        }

        .image-fullscreen-overlay img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
        }

        .image-fullscreen-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .image-fullscreen-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ========== 공통 이미지 업로드 스타일 (여행, 맛집, 병원, 문화, 사람) ========== */
        .form-image-upload-section {
            margin-top: 16px;
            margin-bottom: 20px;
        }

        .form-image-buttons {
            display: flex;
            gap: 12px;
        }

        .form-image-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            background: rgba(0, 0, 0, 0.04);
            border: 2px dashed rgba(0, 0, 0, 0.2);
            border-radius: 14px;
            padding: 18px 12px;
            color: rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: all 0.2s;
        }

        .form-image-upload-label.gallery-btn:hover {
            border-color: rgba(74, 222, 128, 0.6);
            background: rgba(74, 222, 128, 0.1);
            color: #22c55e;
        }

        .form-image-upload-label.camera-btn:hover {
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* Flutter WebView에서 카메라 버튼 숨김 */
        body.flutter-webview .form-image-upload-label.camera-btn {
            display: none;
        }
        
        body.flutter-webview .form-image-buttons {
            gap: 0;
        }
        
        body.flutter-webview .form-image-upload-label.gallery-btn {
            flex: 1;
            max-width: 100%;
        }

        .form-image-upload-label i {
            font-size: 24px;
        }

        .form-image-upload-label span {
            font-size: 14px;
        }

        .form-image-preview-container {
            margin-top: 12px;
            display: none;
            position: relative;
        }

        .form-image-preview-container.active {
            display: block;
        }

        .form-image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 14px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .form-image-remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .form-image-remove-btn:hover {
            background: rgba(255, 107, 107, 0.8);
            transform: scale(1.1);
        }

        /* 리스트 아이템 이미지 썸네일 */
        .list-item-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        /* 상세보기 이미지 */
        .detail-item-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 14px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .detail-item-image:hover {
            transform: scale(1.02);
        }

        /* ========== 공유 모달 스타일 ========== */
        .share-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3500;
            justify-content: center;
            align-items: flex-end;
            padding: 20px;
        }
        
        .share-modal-overlay.active {
            display: flex;
        }
        
        .share-modal {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-width: 500px;
            max-height: 70vh;
            overflow: hidden;
            animation: slideUpModal 0.3s ease;
        }
        
        @keyframes slideUpModal {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .share-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .share-modal-header h3 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .share-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 16px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .share-modal-body {
            padding: 20px;
        }
        
        .share-preview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .share-preview h4 {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .share-preview p {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        
        .share-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        .share-option-btn {
            background: #f0f1f3;
            border: none;
            border-radius: 12px;
            padding: 15px 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .share-option-btn:hover {
            background: #e0e1e3;
            transform: translateY(-2px);
        }
        
        .share-option-btn:active {
            transform: scale(0.95);
        }
        
        .share-option-btn i {
            font-size: 22px;
            color: #667eea;
        }
        
        .share-option-btn span {
            font-size: 11px;
            color: #555;
            font-weight: 500;
        }

        /* ========== 메뉴 추가 버튼 스타일 ========== */
        .add-category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .add-category-item:hover {
            transform: translateY(-5px);
        }

        .add-category-box {
            width: 80px;
            height: 80px;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 32px;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.15);
            border: 3px dashed rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }

        .add-category-item:hover .add-category-box {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.6);
            color: white;
        }

        .add-category-item span {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            line-height: 1.4;
        }

        /* ========== 메뉴 추가 모달 스타일 ========== */
        .category-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .category-modal-overlay.active {
            display: flex;
        }

        .category-modal {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
        }

        .category-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .category-modal-header h2 {
            color: #fff;
            font-size: 20px;
            font-weight: 600;
        }

        .category-modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .category-modal-body {
            padding: 24px;
            max-height: calc(85vh - 80px);
            overflow-y: auto;
        }

        .category-form-group {
            margin-bottom: 20px;
        }

        .category-form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .category-form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .category-form-group input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(255, 255, 255, 0.12);
        }

        .category-form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* 아이콘 선택 그리드 */
        .icon-selector-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .icon-option {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 22px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .icon-option:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            color: #fff;
        }

        .icon-option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: #fff;
            transform: scale(1.05);
        }

        /* 색상 선택 그리드 */
        .color-selector-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 14px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.05);
        }

        .color-option.selected {
            border-color: #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        .color-option.selected::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 18px;
        }

        /* 미리보기 */
        .category-preview {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .category-preview-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .category-preview-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            margin-bottom: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .category-preview-name {
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

        .category-add-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .category-add-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* 커스텀 카테고리 삭제 버튼 */
        .custom-category-wrapper {
            position: relative;
        }

        .custom-category-delete {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            background: #ff5f6d;
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.2s;
        }

        .custom-category-wrapper:hover .custom-category-delete {
            display: flex;
        }

        .custom-category-delete:hover {
            transform: scale(1.1);
            background: #ff4757;
        }

        /* 커스텀 카테고리 색상 클래스 */
        .custom-gradient-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .custom-gradient-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .custom-gradient-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .custom-gradient-4 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .custom-gradient-5 { background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%); }
        .custom-gradient-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .custom-gradient-7 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        .custom-gradient-8 { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .custom-gradient-9 { background: linear-gradient(135deg, #667db6 0%, #0082c8 100%); }
        .custom-gradient-10 { background: linear-gradient(135deg, #ff5f6d 0%, #ffc371 100%); }

        /* 입력 항목 설정 스타일 */
        .field-settings-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .field-setting-item {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            padding: 14px;
            transition: all 0.2s;
        }

        .field-setting-item:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .field-setting-item.required {
            border-color: rgba(102, 126, 234, 0.4);
            background: rgba(102, 126, 234, 0.15);
        }

        .field-setting-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .field-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .field-checkbox-wrapper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }

        .field-checkbox-wrapper input[type="checkbox"]:disabled {
            opacity: 0.8;
        }

        .field-required-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 6px;
        }

        .field-optional-badge {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            font-weight: 500;
            padding: 3px 8px;
            border-radius: 6px;
        }

        .field-type-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
        }

        .field-detail-settings {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .field-name-input {
            width: 100%;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .field-name-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(255, 255, 255, 0.15);
        }

        .field-name-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .field-sub-options {
            margin-top: 10px;
        }

        .sub-options-label {
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-bottom: 6px;
        }

        .field-options-input {
            width: 100%;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .field-options-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(255, 255, 255, 0.15);
        }

        .field-options-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* 커스텀 카테고리 전용 메모 폼 스타일 */
        .custom-memo-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            z-index: 3000;
            flex-direction: column;
        }

        .custom-memo-form-modal.active {
            display: flex;
        }

        .custom-memo-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .custom-memo-form-header h2 {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-memo-form-header .header-btns {
            display: flex;
            gap: 10px;
        }

        .custom-memo-form-header .cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-memo-form-header .cancel-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .custom-memo-form-header .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: #fff;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-memo-form-header .save-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .custom-memo-form-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .custom-form-group {
            margin-bottom: 20px;
        }

        .custom-form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .custom-form-group label .required-mark {
            color: #ff6b6b;
            margin-left: 4px;
        }

        .custom-form-input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .custom-form-input:focus {
            outline: none;
            border-color: var(--theme-color, rgba(102, 126, 234, 0.6));
            background: rgba(255, 255, 255, 0.12);
        }

        .custom-form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .custom-form-select {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='rgba(255,255,255,0.6)' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 24px;
            transition: all 0.2s;
        }

        .custom-form-select:focus {
            outline: none;
            border-color: var(--theme-color, rgba(102, 126, 234, 0.6));
            background-color: rgba(255, 255, 255, 0.12);
        }

        .custom-form-select option {
            background: #1a1a2e;
            color: #fff;
        }

        .custom-form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.2s;
        }

        .custom-form-textarea:focus {
            outline: none;
            border-color: var(--theme-color, rgba(102, 126, 234, 0.6));
            background: rgba(255, 255, 255, 0.12);
        }

        .custom-form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* 커스텀 폼 이미지 섹션 스타일 */
        .custom-form-image-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .custom-form-image-buttons {
            display: flex;
            gap: 10px;
        }

        .custom-form-image-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-form-image-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--theme-color, rgba(102, 126, 234, 0.6));
        }

        .custom-form-image-btn i {
            font-size: 18px;
        }

        .custom-form-image-preview-container {
            position: relative;
            display: none;
            max-width: 200px;
            border-radius: 12px;
            overflow: hidden;
        }

        .custom-form-image-preview {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 12px;
        }

        .custom-form-image-remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

        .custom-form-image-remove-btn:hover {
            background: rgba(255, 107, 107, 0.8);
            transform: scale(1.1);
        }

        /* 테마 색상 클래스 - 각 색상별 밝은 배경과 어두운 배경 변형 포함 */
        .theme-color-1 { 
            --theme-color: #667eea; --theme-color2: #764ba2;
            --theme-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            --theme-bg-light: linear-gradient(180deg, #eef0fb 0%, #f0eaf8 50%, #f3eff9 100%);
            --theme-bg-dark: linear-gradient(180deg, #1e1a3a 0%, #1a1640 50%, #1c1248 100%);
            --theme-header-border: rgba(102, 126, 234, 0.2);
            --theme-header-shadow: rgba(102, 126, 234, 0.1);
        }
        .theme-color-2 { 
            --theme-color: #f093fb; --theme-color2: #f5576c;
            --theme-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
            --theme-bg-light: linear-gradient(180deg, #fef0fe 0%, #fdeef5 50%, #fff0f3 100%);
            --theme-bg-dark: linear-gradient(180deg, #3a1a2e 0%, #361630 50%, #301228 100%);
            --theme-header-border: rgba(240, 147, 251, 0.2);
            --theme-header-shadow: rgba(240, 147, 251, 0.1);
        }
        .theme-color-3 { 
            --theme-color: #4facfe; --theme-color2: #00f2fe;
            --theme-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            --theme-bg-light: linear-gradient(180deg, #edf6ff 0%, #e8fbff 50%, #f0faff 100%);
            --theme-bg-dark: linear-gradient(180deg, #0f1e30 0%, #0e2535 50%, #0c2a38 100%);
            --theme-header-border: rgba(79, 172, 254, 0.2);
            --theme-header-shadow: rgba(79, 172, 254, 0.1);
        }
        .theme-color-4 { 
            --theme-color: #fa709a; --theme-color2: #fee140;
            --theme-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
            --theme-bg-light: linear-gradient(180deg, #fff5f7 0%, #fff0e6 50%, #fff5e6 100%);
            --theme-bg-dark: linear-gradient(180deg, #301820 0%, #302518 50%, #302a10 100%);
            --theme-header-border: rgba(250, 112, 154, 0.2);
            --theme-header-shadow: rgba(250, 112, 154, 0.1);
        }
        .theme-color-5 { 
            --theme-color: #f9d423; --theme-color2: #ff4e50;
            --theme-gradient: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%); 
            --theme-bg-light: linear-gradient(180deg, #fffbe6 0%, #fff4ea 50%, #fff0ef 100%);
            --theme-bg-dark: linear-gradient(180deg, #302810 0%, #301e14 50%, #301416 100%);
            --theme-header-border: rgba(249, 212, 35, 0.2);
            --theme-header-shadow: rgba(249, 212, 35, 0.1);
        }
        .theme-color-6 { 
            --theme-color: #a8edea; --theme-color2: #fed6e3;
            --theme-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); 
            --theme-bg-light: linear-gradient(180deg, #f2fcfb 0%, #fcf5f8 50%, #fdf7f9 100%);
            --theme-bg-dark: linear-gradient(180deg, #182e2d 0%, #2a2025 50%, #2e2228 100%);
            --theme-header-border: rgba(168, 237, 234, 0.3);
            --theme-header-shadow: rgba(168, 237, 234, 0.15);
        }
        .theme-color-7 { 
            --theme-color: #a18cd1; --theme-color2: #fbc2eb;
            --theme-gradient: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); 
            --theme-bg-light: linear-gradient(180deg, #f3eff9 0%, #fef4fb 50%, #fdf5fc 100%);
            --theme-bg-dark: linear-gradient(180deg, #201a30 0%, #2a1828 50%, #2e1a2c 100%);
            --theme-header-border: rgba(161, 140, 209, 0.2);
            --theme-header-shadow: rgba(161, 140, 209, 0.1);
        }
        .theme-color-8 { 
            --theme-color: #11998e; --theme-color2: #38ef7d;
            --theme-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); 
            --theme-bg-light: linear-gradient(180deg, #e6f9f5 0%, #ecfbf0 50%, #f0fdf4 100%);
            --theme-bg-dark: linear-gradient(180deg, #0a201e 0%, #0e2518 50%, #122a1c 100%);
            --theme-header-border: rgba(17, 153, 142, 0.2);
            --theme-header-shadow: rgba(17, 153, 142, 0.1);
        }
        .theme-color-9 { 
            --theme-color: #667db6; --theme-color2: #0082c8;
            --theme-gradient: linear-gradient(135deg, #667db6 0%, #0082c8 100%); 
            --theme-bg-light: linear-gradient(180deg, #eff2f9 0%, #e8f3fc 50%, #edf5fd 100%);
            --theme-bg-dark: linear-gradient(180deg, #141828 0%, #0e1e30 50%, #0c2235 100%);
            --theme-header-border: rgba(102, 125, 182, 0.2);
            --theme-header-shadow: rgba(102, 125, 182, 0.1);
        }
        .theme-color-10 { 
            --theme-color: #ff5f6d; --theme-color2: #ffc371;
            --theme-gradient: linear-gradient(135deg, #ff5f6d 0%, #ffc371 100%); 
            --theme-bg-light: linear-gradient(180deg, #fff0f0 0%, #fff6ed 50%, #fff8f0 100%);
            --theme-bg-dark: linear-gradient(180deg, #301418 0%, #30241a 50%, #302818 100%);
            --theme-header-border: rgba(255, 95, 109, 0.2);
            --theme-header-shadow: rgba(255, 95, 109, 0.1);
        }

        .custom-memo-form-modal .save-btn {
            background: var(--theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
        }

        .custom-form-input:focus,
        .custom-form-select:focus,
        .custom-form-textarea:focus {
            border-color: var(--theme-color, #667eea);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }

        /* ===== 커스텀 카테고리 테마 색상 동기화 ===== */

        /* 리스트 모달 (memoFullscreenModal) 테마 적용 */
        .memo-fullscreen-modal.custom-themed {
            background: var(--theme-bg-dark, linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%));
        }
        .memo-fullscreen-modal.custom-themed .memo-modal-header {
            background: rgba(255, 255, 255, 0.06);
            border-bottom: 1px solid var(--theme-header-border, rgba(255, 255, 255, 0.1));
            box-shadow: 0 2px 20px var(--theme-header-shadow, transparent);
        }
        .memo-fullscreen-modal.custom-themed .memo-modal-header h2 i {
            background: var(--theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .memo-fullscreen-modal.custom-themed .memo-fab {
            background: var(--theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        .memo-fullscreen-modal.custom-themed .memo-fab:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        .memo-fullscreen-modal.custom-themed .date-icon {
            background: var(--theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
        }
        .memo-fullscreen-modal.custom-themed .memo-list-item {
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        .memo-fullscreen-modal.custom-themed .memo-list-item:hover {
            border-left-color: var(--theme-color, #667eea);
        }
        .memo-fullscreen-modal.custom-themed .memo-back-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--theme-header-border, rgba(255,255,255,0.1));
        }
        .memo-fullscreen-modal.custom-themed .memo-back-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* 상세보기 모달 (memoDetailModal) 테마 적용 */
        .memo-detail-modal.custom-themed {
            background: var(--theme-bg-dark, linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%));
        }
        .memo-detail-modal.custom-themed .memo-detail-header {
            background: rgba(255, 255, 255, 0.06);
            border-bottom: 1px solid var(--theme-header-border, rgba(255, 255, 255, 0.1));
            box-shadow: 0 2px 20px var(--theme-header-shadow, transparent);
        }
        .memo-detail-modal.custom-themed .memo-detail-header button {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--theme-header-border, rgba(255,255,255,0.1));
        }
        .memo-detail-modal.custom-themed .memo-detail-header button:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        .memo-detail-modal.custom-themed .field-label {
            color: var(--theme-color, rgba(255, 255, 255, 0.6));
        }
        .memo-detail-modal.custom-themed .memo-field-item {
            border-bottom-color: var(--theme-header-border, rgba(255, 255, 255, 0.1));
        }
        .memo-detail-modal.custom-themed .memo-detail-content .memo-date i {
            color: var(--theme-color, rgba(255, 255, 255, 0.5));
        }

        /* 입력 폼 모달 (customMemoFormModal) 테마 강화 */
        .custom-memo-form-modal {
            background: var(--theme-bg-dark, linear-gradient(180deg, #1a1a2e 0%, #16213e 100%)) !important;
        }
        .custom-memo-form-modal .custom-memo-form-header {
            background: rgba(255, 255, 255, 0.06);
            border-bottom: 1px solid var(--theme-header-border, rgba(255, 255, 255, 0.1));
            box-shadow: 0 2px 20px var(--theme-header-shadow, transparent);
        }
        .custom-memo-form-modal .custom-memo-form-header .save-btn {
            background: var(--theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
        }
        .custom-memo-form-modal .custom-memo-form-header h2 i {
            background: var(--theme-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .custom-memo-form-modal .custom-form-input:focus,
        .custom-memo-form-modal .custom-form-select:focus,
        .custom-memo-form-modal .custom-form-textarea:focus {
            border-color: var(--theme-color, #667eea);
            box-shadow: 0 0 0 3px var(--theme-header-shadow, rgba(102, 126, 234, 0.15));
        }

        /* 메모 상세보기 필드 아이템 스타일 */
        .memo-field-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .memo-field-item:last-child {
            border-bottom: none;
        }

        .memo-field-item .field-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            font-weight: 500;
        }

        .memo-field-item .field-value {
            color: #fff;
            font-size: 16px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* 스크롤바 스타일 */
        .memo-list-container::-webkit-scrollbar,
        .memo-detail-content::-webkit-scrollbar,
        .memo-form-body::-webkit-scrollbar {
            width: 6px;
        }

        .memo-list-container::-webkit-scrollbar-track,
        .memo-detail-content::-webkit-scrollbar-track,
        .memo-form-body::-webkit-scrollbar-track {
            background: transparent;
        }

        .memo-list-container::-webkit-scrollbar-thumb,
        .memo-detail-content::-webkit-scrollbar-thumb,
        .memo-form-body::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .memo-list-container::-webkit-scrollbar-thumb:hover,
        .memo-detail-content::-webkit-scrollbar-thumb:hover,
        .memo-form-body::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ========== 캘린더 일정관리 스타일 ========== */
        .schedule-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #f5f7fa 0%, #e8ecf1 50%, #dde3eb 100%);
            z-index: 1000;
            overflow: hidden;
        }

        .schedule-modal-overlay.active {
            display: block;
        }

        .schedule-modal {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .schedule-modal-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(139, 164, 180, 0.2);
            box-shadow: 0 2px 15px rgba(139, 164, 180, 0.1);
        }

        .schedule-modal-header h2 {
            color: #4a5568;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .schedule-modal-header h2 i {
            color: #7c9aaa;
        }

        .schedule-modal-close {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-size: 20px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(139, 164, 180, 0.3);
        }

        .schedule-modal-close:hover {
            transform: scale(1.05);
        }

        .schedule-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* 캘린더 네비게이션 */
        .calendar-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: white;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 15px rgba(139, 164, 180, 0.15);
        }

        .calendar-nav-btn {
            background: #f0f4f8;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            color: #5a6d7d;
            font-size: 16px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav-btn:hover {
            background: #e2e8f0;
            color: #4a5568;
        }

        .calendar-nav-title {
            color: #4a5568;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 10px;
            transition: background 0.2s;
        }

        .calendar-nav-title:hover {
            background: #f0f4f8;
        }

        .calendar-today-btn {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(139, 164, 180, 0.3);
        }

        .calendar-today-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 164, 180, 0.4);
        }

        /* 캘린더 그리드 */
        .calendar-container {
            background: white;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 15px rgba(139, 164, 180, 0.15);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .calendar-weekday {
            text-align: center;
            color: #718096;
            font-size: 12px;
            font-weight: 600;
            padding: 8px 0;
        }

        .calendar-weekday.sunday {
            color: #e57373;
        }

        .calendar-weekday.saturday {
            color: #64b5f6;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 45px;
        }

        .calendar-day:hover {
            background: #e2e8f0;
        }

        .calendar-day.other-month {
            opacity: 0.4;
        }

        .calendar-day.today {
            background: #e8f4f8;
            box-shadow: 0 0 0 2px #8BA4B4;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
        }

        .calendar-day.selected .day-number {
            color: white;
        }

        .calendar-day .day-number {
            color: #4a5568;
            font-size: 14px;
            font-weight: 500;
        }

        .calendar-day.sunday .day-number {
            color: #e57373;
        }

        .calendar-day.saturday .day-number {
            color: #64b5f6;
        }

        .calendar-day.selected.sunday .day-number,
        .calendar-day.selected.saturday .day-number {
            color: white;
        }

        .calendar-day .schedule-dots {
            display: flex;
            gap: 3px;
            margin-top: 3px;
            position: absolute;
            bottom: 5px;
        }

        .schedule-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: #f0b429;
        }

        .schedule-dot.important {
            background: #e57373;
        }

        /* 선택된 날짜 일정 목록 */
        .selected-date-schedules {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(139, 164, 180, 0.15);
        }

        .selected-date-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .selected-date-title {
            color: #4a5568;
            font-size: 16px;
            font-weight: 600;
        }

        .add-schedule-btn {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(139, 164, 180, 0.3);
        }

        .add-schedule-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 164, 180, 0.4);
        }

        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .schedule-item {
            background: #f8fafc;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }

        .schedule-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .schedule-time-badge {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
            padding: 6px 10px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .schedule-time-badge.all-day {
            background: #f0b429;
            color: white;
        }

        .schedule-item-content {
            flex: 1;
        }

        .schedule-item-title {
            color: #2d3748;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .schedule-item-memo {
            color: #718096;
            font-size: 13px;
            line-height: 1.4;
        }

        .schedule-item-actions {
            display: flex;
            gap: 5px;
        }

        .schedule-item-btn {
            background: #e2e8f0;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            color: #5a6d7d;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .schedule-item-btn:hover {
            background: #cbd5e1;
            color: #4a5568;
        }

        .schedule-item-btn.delete:hover {
            background: #fed7d7;
            color: #e53e3e;
        }

        .schedule-empty {
            text-align: center;
            padding: 30px;
            color: #a0aec0;
        }

        .schedule-empty i {
            font-size: 40px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .schedule-empty p {
            font-size: 14px;
        }

        /* 일정 추가/수정 모달 */
        .schedule-form-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .schedule-form-overlay.active {
            display: flex;
        }

        .schedule-form-modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: modalSlideIn 0.3s ease;
        }

        .schedule-form-header {
            background: linear-gradient(135deg, #8BA4B4 0%, #A8C0D0 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .schedule-form-header h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .schedule-form-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .schedule-form-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .schedule-form-body {
            padding: 20px;
            overflow-y: auto;
        }

        .schedule-form-group {
            margin-bottom: 20px;
        }

        .schedule-form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .schedule-form-group input[type="text"],
        .schedule-form-group input[type="time"],
        .schedule-form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .schedule-form-group input:focus,
        .schedule-form-group textarea:focus {
            outline: none;
            border-color: #4facfe;
        }

        .schedule-form-group textarea {
            resize: none;
            height: 100px;
        }

        .schedule-time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .schedule-time-inputs input {
            flex: 1;
        }

        .schedule-time-inputs span {
            color: #666;
            font-size: 14px;
        }

        .schedule-allday-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .schedule-allday-toggle input {
            width: 20px;
            height: 20px;
            accent-color: #4facfe;
        }

        .schedule-allday-toggle span {
            font-size: 14px;
            color: #333;
        }

        .schedule-important-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: #fff5f5;
            border-radius: 12px;
            cursor: pointer;
        }

        .schedule-important-toggle input {
            width: 20px;
            height: 20px;
            accent-color: #ff6b6b;
        }

        .schedule-important-toggle span {
            font-size: 14px;
            color: #ff6b6b;
        }

        .schedule-form-footer {
            padding: 15px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .schedule-form-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .schedule-form-btn.cancel {
            background: #f1f3f4;
            color: #666;
        }

        .schedule-form-btn.cancel:hover {
            background: #e9ecef;
        }

        .schedule-form-btn.save {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .schedule-form-btn.save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        /* 캘린더 일정 뱃지 (schedule indicator) */
        .schedule-indicator {
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2px;
        }

        .schedule-indicator-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #ffe66d;
        }

        .schedule-indicator-dot.important {
            background: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <button class="menu-manage-btn" onclick="openMenuManageModal()" title="메뉴 관리">
                <i class="fas fa-cog"></i>
            </button>
            <button class="backup-btn" onclick="openBackupModal()" title="데이터 백업/복원">
                <i class="fas fa-cloud"></i>
            </button>
            <h1>절대강자 메모장</h1>
            <p>모든 기록을 한 곳에서 간편하게</p>
        </header>

        <div class="grid-container">
            <div class="grid-item" data-menu-id="memo" onclick="openModal('memo')">
                <div class="icon-box memo-general">
                    <i class="fas fa-sticky-note"></i>
                </div>
                <span>일반<br>메모</span>
            </div>

            <div class="grid-item" data-menu-id="todo" onclick="openModal('todo')">
                <div class="icon-box todo-list">
                    <i class="fas fa-check-square"></i>
                </div>
                <span>할일<br>목록</span>
            </div>

            <div class="grid-item" data-menu-id="schedule" onclick="openModal('schedule')">
                <div class="icon-box schedule">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <span>일정<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="travel" onclick="openModal('travel')">
                <div class="icon-box travel">
                    <i class="fas fa-plane"></i>
                </div>
                <span>여행<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="restaurant" onclick="openModal('restaurant')">
                <div class="icon-box restaurant">
                    <i class="fas fa-utensils"></i>
                </div>
                <span>맛집<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="hospital" onclick="openModal('hospital')">
                <div class="icon-box hospital">
                    <i class="fas fa-hospital"></i>
                </div>
                <span>병원<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="sitemanage" onclick="openModal('sitemanage')">
                <div class="icon-box sitemanage">
                    <i class="fas fa-globe"></i>
                </div>
                <span>사이트<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="bankaccount" onclick="openModal('bankaccount')">
                <div class="icon-box bankaccount">
                    <i class="fas fa-university"></i>
                </div>
                <span>계좌번호<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="culture" onclick="openModal('culture')">
                <div class="icon-box culture">
                    <i class="fas fa-theater-masks"></i>
                </div>
                <span>문화<br>관리</span>
            </div>

            <div class="grid-item" data-menu-id="people" onclick="openModal('people')">
                <div class="icon-box people">
                    <i class="fas fa-users"></i>
                </div>
                <span>사람<br>관리</span>
            </div>

            <!-- 커스텀 카테고리가 여기에 추가됨 -->
            <div id="customCategoriesContainer"></div>

            <!-- 메뉴 추가 버튼 -->
            <div class="add-category-item" onclick="openCategoryModal()">
                <div class="add-category-box">
                    <i class="fas fa-plus"></i>
                </div>
                <span>메뉴<br>추가</span>
            </div>
        </div>
    </div>

    <!-- 사람관리 전체화면 모달 -->
    <div class="people-fullscreen-modal" id="peopleFullscreenModal">
        <div class="people-modal-header">
            <h2><i class="fas fa-users"></i> 사람 관리</h2>
            <button class="people-back-btn" onclick="closePeopleFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="people-list-container" id="peopleListContainer">
            <!-- 사람 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="people-fab" onclick="openPeopleForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 사람 상세보기 모달 -->
    <div class="people-detail-modal" id="peopleDetailModal">
        <div class="people-detail-header">
            <div class="left-actions">
                <button onclick="closePeopleDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentPeople()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentPeople()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="people-detail-content" id="peopleDetailContent">
            <!-- 사람 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 사람 입력 폼 모달 -->
    <div class="people-form-modal" id="peopleFormModal">
        <div class="people-form-header">
            <h2 id="peopleFormTitle">새 인물 추가</h2>
            <button onclick="closePeopleForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="people-form-body">
            <form id="newPeopleForm" onsubmit="submitPeopleForm(event)">
                <input type="hidden" id="editPeopleId">
                <div class="people-form-group">
                    <label>관계 *</label>
                    <select id="newPeopleRelation" required>
                        <option value="가족">가족</option>
                        <option value="친척">친척</option>
                        <option value="친구">친구</option>
                        <option value="업무">업무</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="people-form-group">
                    <label>이름 *</label>
                    <input type="text" id="newPeopleName" placeholder="이름을 입력하세요" required>
                </div>
                <div class="people-form-group">
                    <label>전화번호</label>
                    <input type="tel" id="newPeoplePhone" placeholder="전화번호를 입력하세요">
                </div>
                <div class="people-form-group">
                    <label>이메일</label>
                    <input type="email" id="newPeopleEmail" placeholder="이메일을 입력하세요">
                </div>
                <div class="people-form-group">
                    <label>중요도 *</label>
                    <div class="people-importance-selector">
                        <div class="people-importance-option" data-value="낮음" onclick="selectPeopleImportance('낮음')">
                            <i class="fas fa-star"></i> 낮음
                        </div>
                        <div class="people-importance-option active" data-value="중간" onclick="selectPeopleImportance('중간')">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i> 중간
                        </div>
                        <div class="people-importance-option" data-value="높음" onclick="selectPeopleImportance('높음')">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i> 높음
                        </div>
                    </div>
                </div>
                <div class="people-form-group">
                    <label>특이사항</label>
                    <textarea id="newPeopleNote" placeholder="특이사항, 메모 등을 입력하세요"></textarea>
                </div>
                <div class="people-form-group">
                    <label>사진</label>
                    <div class="form-image-upload-section">
                        <input type="file" id="peopleImageInput" accept="image/*" style="display: none;" onchange="handleFormImageSelect(event, 'people', 'gallery')">
                        <input type="file" id="peopleCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleFormImageSelect(event, 'people', 'camera')">
                        <div class="form-image-buttons">
                            <label class="form-image-upload-label gallery-btn" onclick="handleFormGalleryClick('people')">
                                <i class="fas fa-image"></i>
                                <span>갤러리</span>
                            </label>
                        </div>
                        <div class="form-image-preview-container" id="peopleImagePreviewContainer">
                            <img src="" alt="미리보기" class="form-image-preview" id="peopleImagePreview">
                            <button type="button" class="form-image-remove-btn" onclick="removeFormImage('people')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="people-form-submit" id="peopleSubmitBtn">인물 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 문화관리 전체화면 모달 -->
    <div class="culture-fullscreen-modal" id="cultureFullscreenModal">
        <div class="culture-modal-header">
            <h2><i class="fas fa-theater-masks"></i> 문화 관리</h2>
            <button class="culture-back-btn" onclick="closeCultureFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="culture-list-container" id="cultureListContainer">
            <!-- 문화 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="culture-fab" onclick="openCultureForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 문화 상세보기 모달 -->
    <div class="culture-detail-modal" id="cultureDetailModal">
        <div class="culture-detail-header">
            <div class="left-actions">
                <button onclick="closeCultureDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentCulture()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentCulture()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="culture-detail-content" id="cultureDetailContent">
            <!-- 문화 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 문화 입력 폼 모달 -->
    <div class="culture-form-modal" id="cultureFormModal">
        <div class="culture-form-header">
            <h2 id="cultureFormTitle">새 문화 기록 추가</h2>
            <button onclick="closeCultureForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="culture-form-body">
            <form id="newCultureForm" onsubmit="submitCultureForm(event)">
                <input type="hidden" id="editCultureId">
                <div class="culture-form-group">
                    <label>장르 *</label>
                    <select id="newCultureGenre" required>
                        <option value="독서">독서</option>
                        <option value="영화">영화</option>
                        <option value="드라마">드라마</option>
                        <option value="연극">연극</option>
                        <option value="콘서트">콘서트</option>
                        <option value="취미">취미</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="culture-form-group">
                    <label>인물/대상 *</label>
                    <input type="text" id="newCultureTarget" placeholder="작품명, 인물, 대상 등을 입력하세요" required>
                </div>
                <div class="culture-form-group">
                    <label>주요내용</label>
                    <textarea id="newCultureContent" placeholder="주요 내용, 감상평, 메모 등을 입력하세요"></textarea>
                </div>
                <div class="culture-form-group">
                    <label>사진</label>
                    <div class="form-image-upload-section">
                        <input type="file" id="cultureImageInput" accept="image/*" style="display: none;" onchange="handleFormImageSelect(event, 'culture', 'gallery')">
                        <input type="file" id="cultureCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleFormImageSelect(event, 'culture', 'camera')">
                        <div class="form-image-buttons">
                            <label class="form-image-upload-label gallery-btn" onclick="handleFormGalleryClick('culture')">
                                <i class="fas fa-image"></i>
                                <span>갤러리</span>
                            </label>
                        </div>
                        <div class="form-image-preview-container" id="cultureImagePreviewContainer">
                            <img src="" alt="미리보기" class="form-image-preview" id="cultureImagePreview">
                            <button type="button" class="form-image-remove-btn" onclick="removeFormImage('culture')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="culture-form-submit" id="cultureSubmitBtn">문화 기록 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 백업/복원 모달 -->
    <div class="backup-modal-overlay" id="backupModal">
        <div class="backup-modal">
            <div class="backup-modal-header">
                <h2><i class="fas fa-cloud"></i> 데이터 백업/복원</h2>
                <button class="backup-modal-close" onclick="closeBackupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="backup-modal-body">
                <div class="backup-option" onclick="exportBackupShare()">
                    <div class="backup-option-icon download">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    <h3>데이터 백업하기</h3>
                    <p>모든 메모와 카테고리를 공유 시트로 저장/전송합니다.</p>
                </div>
                
                <div class="backup-option" onclick="document.getElementById('backupFileInput').click()">
                    <div class="backup-option-icon upload">
                        <i class="fas fa-upload"></i>
                    </div>
                    <h3>데이터 가져오기</h3>
                    <p>백업 파일에서 데이터를 복원합니다.</p>
                </div>
                
                <input type="file" id="backupFileInput" accept=".json" onchange="importBackup(event)">
                
                <div class="backup-option delete-all-option" onclick="deleteAllData()">
                    <div class="backup-option-icon delete">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <h3>모든 데이터 삭제</h3>
                    <p>저장된 모든 메모와 메뉴를 삭제합니다.</p>
                </div>
                
                <div class="backup-info">
                    <i class="fas fa-info-circle"></i>
                    <span>가져오기 시 기존 데이터가 모두 덮어씌워집니다. 중요한 데이터는 먼저 백업해주세요.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 메뉴 관리 모달 -->
    <div class="menu-manage-modal-overlay" id="menuManageModal">
        <div class="menu-manage-modal">
            <div class="menu-manage-modal-header">
                <h2><i class="fas fa-cog"></i> 메뉴 관리</h2>
                <button class="menu-manage-modal-close" onclick="closeMenuManageModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="menu-manage-modal-body">
                <div class="menu-manage-tabs">
                    <button class="menu-manage-tab active" onclick="switchMenuManageTab('visible')" id="visibleMenuTab">
                        <i class="fas fa-eye"></i> 표시 중
                    </button>
                    <button class="menu-manage-tab" onclick="switchMenuManageTab('hidden')" id="hiddenMenuTab">
                        <i class="fas fa-eye-slash"></i> 숨김
                    </button>
                </div>
                
                <!-- 표시 중인 메뉴 -->
                <div class="menu-manage-section active" id="visibleMenuSection">
                    <div class="menu-manage-section-title">홈 화면에 표시 중인 메뉴</div>
                    <div class="menu-manage-list" id="visibleMenuList">
                        <!-- 동적으로 채워짐 -->
                    </div>
                </div>
                
                <!-- 숨긴 메뉴 -->
                <div class="menu-manage-section" id="hiddenMenuSection">
                    <div class="menu-manage-section-title">숨긴 메뉴 (클릭하여 복원)</div>
                    <div class="menu-manage-list" id="hiddenMenuList">
                        <!-- 동적으로 채워짐 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메뉴 추가 모달 -->
    <div class="category-modal-overlay" id="categoryModal">
        <div class="category-modal">
            <div class="category-modal-header">
                <h2>메뉴 추가</h2>
                <button class="category-modal-close" onclick="closeCategoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="category-modal-body">
                <!-- 미리보기 -->
                <div class="category-preview">
                    <div class="category-preview-box">
                        <div class="category-preview-icon custom-gradient-1" id="categoryPreviewIcon">
                            <i class="fas fa-star" id="categoryPreviewIconEl"></i>
                        </div>
                        <div class="category-preview-name" id="categoryPreviewName">새 카테고리</div>
                    </div>
                </div>

                <!-- 메뉴 이름 -->
                <div class="category-form-group">
                    <label><i class="fas fa-pencil-alt"></i> 메뉴 이름</label>
                    <input type="text" id="categoryNameInput" placeholder="메뉴 이름을 입력하세요" maxlength="10" oninput="updateCategoryPreview()">
                </div>

                <!-- 아이콘 선택 -->
                <div class="category-form-group">
                    <label><i class="fas fa-icons"></i> 아이콘 선택</label>
                    <div class="icon-selector-grid" id="iconSelectorGrid">
                        <!-- 아이콘들이 여기에 동적으로 추가됨 -->
                    </div>
                </div>

                <!-- 색상 선택 -->
                <div class="category-form-group">
                    <label><i class="fas fa-palette"></i> 색상 선택</label>
                    <div class="color-selector-grid" id="colorSelectorGrid">
                        <!-- 색상들이 여기에 동적으로 추가됨 -->
                    </div>
                </div>

                <!-- 입력 항목 설정 -->
                <div class="category-form-group">
                    <label><i class="fas fa-list-alt"></i> 입력 항목 설정</label>
                    <div class="field-settings-container" id="fieldSettingsContainer">
                        <!-- 항목1: 이름 또는 제목 (필수) -->
                        <div class="field-setting-item required">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field1Enabled" checked disabled>
                                    <span class="field-required-badge">필수</span>
                                </div>
                                <span class="field-type-label">이름 또는 제목</span>
                            </div>
                            <input type="text" id="field1Name" class="field-name-input" placeholder="항목 이름 (예: 이름, 제목)" value="이름/제목" maxlength="20">
                        </div>

                        <!-- 항목2: 카테고리 선택 -->
                        <div class="field-setting-item">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field2Enabled" onchange="toggleFieldSetting(2)">
                                    <span class="field-optional-badge">선택</span>
                                </div>
                                <span class="field-type-label">카테고리 선택</span>
                            </div>
                            <div class="field-detail-settings" id="field2Details" style="display: none;">
                                <input type="text" id="field2Name" class="field-name-input" placeholder="항목 이름 (예: 카테고리, 분류)" value="카테고리" maxlength="20">
                                <div class="field-sub-options">
                                    <label class="sub-options-label"><i class="fas fa-tags"></i> 선택 옵션 (쉼표로 구분)</label>
                                    <input type="text" id="field2Options" class="field-options-input" placeholder="옵션1, 옵션2, 옵션3, 옵션4, 옵션5">
                                </div>
                            </div>
                        </div>

                        <!-- 항목3: 날짜 선택 -->
                        <div class="field-setting-item">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field3Enabled" onchange="toggleFieldSetting(3)">
                                    <span class="field-optional-badge">선택</span>
                                </div>
                                <span class="field-type-label">날짜 선택</span>
                            </div>
                            <div class="field-detail-settings" id="field3Details" style="display: none;">
                                <input type="text" id="field3Name" class="field-name-input" placeholder="항목 이름 (예: 날짜, 기간)" value="날짜" maxlength="20">
                            </div>
                        </div>

                        <!-- 항목4: 이름 또는 제목 (추가) -->
                        <div class="field-setting-item">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field4Enabled" onchange="toggleFieldSetting(4)">
                                    <span class="field-optional-badge">선택</span>
                                </div>
                                <span class="field-type-label">이름 또는 제목 (추가)</span>
                            </div>
                            <div class="field-detail-settings" id="field4Details" style="display: none;">
                                <input type="text" id="field4Name" class="field-name-input" placeholder="항목 이름 (예: 부제목, 담당자)" value="부제목" maxlength="20">
                            </div>
                        </div>

                        <!-- 항목5: 특이사항 -->
                        <div class="field-setting-item">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field5Enabled" onchange="toggleFieldSetting(5)">
                                    <span class="field-optional-badge">선택</span>
                                </div>
                                <span class="field-type-label">특이사항 (메모)</span>
                            </div>
                            <div class="field-detail-settings" id="field5Details" style="display: none;">
                                <input type="text" id="field5Name" class="field-name-input" placeholder="항목 이름 (예: 메모, 비고)" value="특이사항" maxlength="20">
                            </div>
                        </div>

                        <!-- 항목6: 이름 또는 제목 (추가2) -->
                        <div class="field-setting-item">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field6Enabled" onchange="toggleFieldSetting(6)">
                                    <span class="field-optional-badge">선택</span>
                                </div>
                                <span class="field-type-label">이름 또는 제목 (추가2)</span>
                            </div>
                            <div class="field-detail-settings" id="field6Details" style="display: none;">
                                <input type="text" id="field6Name" class="field-name-input" placeholder="항목 이름 (예: 제목2, 보조제목)" value="추가제목" maxlength="20">
                            </div>
                        </div>

                        <!-- 항목7: 갤러리 사용 -->
                        <div class="field-setting-item">
                            <div class="field-setting-header">
                                <div class="field-checkbox-wrapper">
                                    <input type="checkbox" id="field7Enabled" onchange="toggleFieldSetting(7)">
                                    <span class="field-optional-badge">선택</span>
                                </div>
                                <span class="field-type-label">갤러리 사용 (이미지)</span>
                            </div>
                            <div class="field-detail-settings" id="field7Details" style="display: none;">
                                <input type="text" id="field7Name" class="field-name-input" placeholder="항목 이름 (예: 사진, 이미지)" value="사진" maxlength="20">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 추가 버튼 -->
                <button class="category-add-btn" onclick="addCustomCategory()" id="categoryAddBtn">
                    <i class="fas fa-plus"></i> 메뉴 추가하기
                </button>
            </div>
        </div>
    </div>

    <!-- 여행 관리 모달 -->
    <div class="modal-overlay" id="travelModal">
        <div class="modal travel-header">
            <div class="modal-header">
                <h2><i class="fas fa-plane"></i> 여행 관리</h2>
                <button class="modal-close" onclick="closeModal('travelModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form class="add-form" id="travelForm" onsubmit="addTravel(event)">
                    <div class="form-group">
                        <label>여행지</label>
                        <input type="text" id="travelDestination" placeholder="여행지를 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label>여행 기간</label>
                        <input type="text" id="travelPeriod" placeholder="예: 2026.02.10 ~ 2026.02.15">
                    </div>
                    <div class="form-group">
                        <label>예산</label>
                        <input type="text" id="travelBudget" placeholder="예: 500,000원">
                    </div>
                    <div class="form-group">
                        <label>메모</label>
                        <textarea id="travelMemo" placeholder="여행 계획이나 메모를 적어주세요"></textarea>
                    </div>
                    <div class="form-group">
                        <label>상태</label>
                        <select id="travelStatus">
                            <option value="계획중">계획중</option>
                            <option value="예약완료">예약완료</option>
                            <option value="여행중">여행중</option>
                            <option value="완료">완료</option>
                        </select>
                    </div>
                    <button type="submit" class="add-btn">여행 추가하기</button>
                </form>
                <div class="item-list" id="travelList"></div>
            </div>
        </div>
    </div>

    <!-- 맛집 관리 모달 -->
    <div class="modal-overlay" id="restaurantModal">
        <div class="modal restaurant-header">
            <div class="modal-header">
                <h2><i class="fas fa-utensils"></i> 맛집 관리</h2>
                <button class="modal-close" onclick="closeModal('restaurantModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form class="add-form" id="restaurantForm" onsubmit="addRestaurant(event)">
                    <div class="form-group">
                        <label>맛집 이름</label>
                        <input type="text" id="restaurantName" placeholder="맛집 이름을 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label>위치</label>
                        <input type="text" id="restaurantLocation" placeholder="주소 또는 위치를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label>카테고리</label>
                        <select id="restaurantCategory">
                            <option value="한식">한식</option>
                            <option value="중식">중식</option>
                            <option value="일식">일식</option>
                            <option value="양식">양식</option>
                            <option value="분식">분식</option>
                            <option value="카페">카페</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>평점</label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5">
                            <label for="star5"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star3" name="rating" value="3" checked>
                            <label for="star3"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1"><i class="fas fa-star"></i></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>추천 메뉴</label>
                        <input type="text" id="restaurantMenu" placeholder="추천 메뉴를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label>메모</label>
                        <textarea id="restaurantMemo" placeholder="맛집에 대한 메모를 적어주세요"></textarea>
                    </div>
                    <button type="submit" class="add-btn">맛집 추가하기</button>
                </form>
                <div class="item-list" id="restaurantList"></div>
            </div>
        </div>
    </div>

    <!-- 여행 관리 전체화면 모달 -->
    <div class="travel-fullscreen-modal" id="travelFullscreenModal">
        <div class="travel-modal-header">
            <h2><i class="fas fa-plane"></i> 여행 관리</h2>
            <button class="travel-back-btn" onclick="closeTravelFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="travel-list-container" id="travelListContainer">
            <!-- 여행 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="travel-fab" onclick="openTravelForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 여행 상세보기 모달 -->
    <div class="travel-detail-modal" id="travelDetailModal">
        <div class="travel-detail-header">
            <div class="left-actions">
                <button onclick="closeTravelDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentTravel()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentTravel()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="travel-detail-content" id="travelDetailContent">
            <!-- 여행 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 여행 입력 폼 모달 -->
    <div class="travel-form-modal" id="travelFormModal">
        <div class="travel-form-header">
            <h2 id="travelFormTitle">새 여행 추가</h2>
            <button onclick="closeTravelForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="travel-form-body">
            <form id="newTravelForm" onsubmit="submitTravelForm(event)">
                <input type="hidden" id="editTravelId">
                <div class="travel-form-group">
                    <label>여행지 *</label>
                    <input type="text" id="newTravelDestination" placeholder="여행지를 입력하세요" required>
                </div>
                <div class="travel-form-group">
                    <label>여행 기간</label>
                    <input type="text" id="newTravelPeriod" placeholder="예: 2026.02.10 ~ 2026.02.15">
                </div>
                <div class="travel-form-group">
                    <label>예산</label>
                    <input type="text" id="newTravelBudget" placeholder="예: 500,000원">
                </div>
                <div class="travel-form-group">
                    <label>상태</label>
                    <select id="newTravelStatus">
                        <option value="계획중">계획중</option>
                        <option value="예약완료">예약완료</option>
                        <option value="여행중">여행중</option>
                        <option value="완료">완료</option>
                    </select>
                </div>
                <div class="travel-form-group">
                    <label>메모</label>
                    <textarea id="newTravelMemo" placeholder="여행 계획이나 메모를 적어주세요"></textarea>
                </div>
                <div class="travel-form-group">
                    <label>사진</label>
                    <div class="form-image-upload-section">
                        <input type="file" id="travelImageInput" accept="image/*" style="display: none;" onchange="handleFormImageSelect(event, 'travel', 'gallery')">
                        <input type="file" id="travelCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleFormImageSelect(event, 'travel', 'camera')">
                        <div class="form-image-buttons">
                            <label class="form-image-upload-label gallery-btn" onclick="handleFormGalleryClick('travel')">
                                <i class="fas fa-image"></i>
                                <span>갤러리</span>
                            </label>
                            <label class="form-image-upload-label camera-btn" onclick="handleFormCameraClick('travel')">
                                <i class="fas fa-camera"></i>
                                <span>카메라</span>
                            </label>
                        </div>
                        <div class="form-image-preview-container" id="travelImagePreviewContainer">
                            <img src="" alt="미리보기" class="form-image-preview" id="travelImagePreview">
                            <button type="button" class="form-image-remove-btn" onclick="removeFormImage('travel')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="travel-form-submit" id="travelSubmitBtn">여행 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 계좌번호 관리 전체화면 모달 -->
    <div class="bankaccount-fullscreen-modal" id="bankaccountFullscreenModal">
        <div class="bankaccount-modal-header">
            <h2><i class="fas fa-university"></i> 계좌번호 관리</h2>
            <button class="bankaccount-back-btn" onclick="closeBankaccountFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="bankaccount-list-container" id="bankaccountListContainer">
            <!-- 계좌번호 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="bankaccount-fab" onclick="openBankaccountForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 계좌번호 상세보기 모달 -->
    <div class="bankaccount-detail-modal" id="bankaccountDetailModal">
        <div class="bankaccount-detail-header">
            <div class="left-actions">
                <button onclick="closeBankaccountDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentBankaccount()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentBankaccount()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="bankaccount-detail-content" id="bankaccountDetailContent">
            <!-- 계좌번호 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 계좌번호 입력 폼 모달 -->
    <div class="bankaccount-form-modal" id="bankaccountFormModal">
        <div class="bankaccount-form-header">
            <h2 id="bankaccountFormTitle">새 계좌 추가</h2>
            <button onclick="closeBankaccountForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="bankaccount-form-body">
            <form id="newBankaccountForm" onsubmit="submitBankaccountForm(event)">
                <input type="hidden" id="editBankaccountId">
                <div class="bankaccount-form-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>비밀번호는 보안상 입력하지 마세요. 계좌정보만 기록하세요.</span>
                </div>
                <div class="bankaccount-form-group">
                    <label>1. 은행명 *</label>
                    <select id="newBankaccountBank" required>
                        <option value="">은행을 선택하세요</option>
                        <option value="국민은행">국민은행</option>
                        <option value="신한은행">신한은행</option>
                        <option value="우리은행">우리은행</option>
                        <option value="하나은행">하나은행</option>
                        <option value="농협은행">농협은행</option>
                        <option value="기업은행">기업은행</option>
                        <option value="카카오뱅크">카카오뱅크</option>
                        <option value="토스뱅크">토스뱅크</option>
                        <option value="케이뱅크">케이뱅크</option>
                        <option value="SC제일은행">SC제일은행</option>
                        <option value="씨티은행">씨티은행</option>
                        <option value="새마을금고">새마을금고</option>
                        <option value="신협">신협</option>
                        <option value="우체국">우체국</option>
                        <option value="수협은행">수협은행</option>
                        <option value="부산은행">부산은행</option>
                        <option value="대구은행">대구은행</option>
                        <option value="경남은행">경남은행</option>
                        <option value="광주은행">광주은행</option>
                        <option value="전북은행">전북은행</option>
                        <option value="제주은행">제주은행</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="bankaccount-form-group">
                    <label>2. 계좌번호 *</label>
                    <input type="text" id="newBankaccountNumber" placeholder="계좌번호를 입력하세요 (- 포함 가능)" required>
                </div>
                <div class="bankaccount-form-group">
                    <label>3. 소유자 *</label>
                    <input type="text" id="newBankaccountOwner" placeholder="계좌 소유자명을 입력하세요" required>
                </div>
                <div class="bankaccount-form-group">
                    <label>4. 메모</label>
                    <textarea id="newBankaccountMemo" placeholder="계좌에 대한 메모를 적어주세요 (예: 급여 통장, 적금 통장 등)"></textarea>
                </div>
                <button type="submit" class="bankaccount-form-submit" id="bankaccountSubmitBtn">계좌 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 맛집 관리 전체화면 모달 -->
    <div class="restaurant-fullscreen-modal" id="restaurantFullscreenModal">
        <div class="restaurant-modal-header">
            <h2><i class="fas fa-utensils"></i> 맛집 관리</h2>
            <button class="restaurant-back-btn" onclick="closeRestaurantFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="restaurant-list-container" id="restaurantListContainer">
            <!-- 맛집 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="restaurant-fab" onclick="openRestaurantForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 맛집 상세보기 모달 -->
    <div class="restaurant-detail-modal" id="restaurantDetailModal">
        <div class="restaurant-detail-header">
            <div class="left-actions">
                <button onclick="closeRestaurantDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentRestaurant()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentRestaurant()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="restaurant-detail-content" id="restaurantDetailContent">
            <!-- 맛집 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 맛집 입력 폼 모달 -->
    <div class="restaurant-form-modal" id="restaurantFormModal">
        <div class="restaurant-form-header">
            <h2 id="restaurantFormTitle">새 맛집 추가</h2>
            <button onclick="closeRestaurantForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="restaurant-form-body">
            <form id="newRestaurantForm" onsubmit="submitRestaurantForm(event)">
                <input type="hidden" id="editRestaurantId">
                <div class="restaurant-form-group">
                    <label>맛집 이름 *</label>
                    <input type="text" id="newRestaurantName" placeholder="맛집 이름을 입력하세요" required>
                </div>
                <div class="restaurant-form-group">
                    <label>위치</label>
                    <input type="text" id="newRestaurantLocation" placeholder="주소 또는 위치를 입력하세요">
                </div>
                <div class="restaurant-form-group">
                    <label>카테고리</label>
                    <select id="newRestaurantCategory">
                        <option value="한식">한식</option>
                        <option value="중식">중식</option>
                        <option value="일식">일식</option>
                        <option value="양식">양식</option>
                        <option value="분식">분식</option>
                        <option value="카페">카페</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="restaurant-form-group">
                    <label>평점</label>
                    <div class="restaurant-star-rating" id="newRestaurantRating">
                        <i class="fas fa-star active" data-rating="1"></i>
                        <i class="fas fa-star active" data-rating="2"></i>
                        <i class="fas fa-star active" data-rating="3"></i>
                        <i class="fas fa-star" data-rating="4"></i>
                        <i class="fas fa-star" data-rating="5"></i>
                    </div>
                </div>
                <div class="restaurant-form-group">
                    <label>추천 메뉴</label>
                    <input type="text" id="newRestaurantMenu" placeholder="추천 메뉴를 입력하세요">
                </div>
                <div class="restaurant-form-group">
                    <label>메모</label>
                    <textarea id="newRestaurantMemo" placeholder="맛집에 대한 메모를 적어주세요"></textarea>
                </div>
                <div class="restaurant-form-group">
                    <label>사진</label>
                    <div class="form-image-upload-section">
                        <input type="file" id="restaurantImageInput" accept="image/*" style="display: none;" onchange="handleFormImageSelect(event, 'restaurant', 'gallery')">
                        <input type="file" id="restaurantCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleFormImageSelect(event, 'restaurant', 'camera')">
                        <div class="form-image-buttons">
                            <label class="form-image-upload-label gallery-btn" onclick="handleFormGalleryClick('restaurant')">
                                <i class="fas fa-image"></i>
                                <span>갤러리</span>
                            </label>
                            <label class="form-image-upload-label camera-btn" onclick="handleFormCameraClick('restaurant')">
                                <i class="fas fa-camera"></i>
                                <span>카메라</span>
                            </label>
                        </div>
                        <div class="form-image-preview-container" id="restaurantImagePreviewContainer">
                            <img src="" alt="미리보기" class="form-image-preview" id="restaurantImagePreview">
                            <button type="button" class="form-image-remove-btn" onclick="removeFormImage('restaurant')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="restaurant-form-submit" id="restaurantSubmitBtn">맛집 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 병원관리 전체화면 모달 -->
    <div class="hospital-fullscreen-modal" id="hospitalFullscreenModal">
        <div class="hospital-modal-header">
            <h2><i class="fas fa-hospital"></i> 병원 관리</h2>
            <button class="hospital-back-btn" onclick="closeHospitalFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="hospital-list-container" id="hospitalListContainer">
            <!-- 병원 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="hospital-fab" onclick="openHospitalForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 병원 상세보기 모달 -->
    <div class="hospital-detail-modal" id="hospitalDetailModal">
        <div class="hospital-detail-header">
            <div class="left-actions">
                <button onclick="closeHospitalDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentHospital()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentHospital()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="hospital-detail-content" id="hospitalDetailContent">
            <!-- 병원 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 병원 입력 폼 모달 -->
    <div class="hospital-form-modal" id="hospitalFormModal">
        <div class="hospital-form-header">
            <h2 id="hospitalFormTitle">새 병원 기록 추가</h2>
            <button onclick="closeHospitalForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="hospital-form-body">
            <form id="newHospitalForm" onsubmit="submitHospitalForm(event)">
                <input type="hidden" id="editHospitalId">
                <div class="hospital-form-group">
                    <label>병원명 *</label>
                    <input type="text" id="newHospitalName" placeholder="병원명을 입력하세요" required>
                </div>
                <div class="hospital-form-group">
                    <label>병명</label>
                    <input type="text" id="newHospitalDisease" placeholder="병명을 입력하세요">
                </div>
                <div class="hospital-form-group">
                    <label>환자명</label>
                    <input type="text" id="newHospitalPatient" placeholder="환자명을 입력하세요">
                </div>
                <div class="hospital-form-group">
                    <label>진료 상태</label>
                    <select id="newHospitalStatus">
                        <option value="미진행">미진행</option>
                        <option value="예약">예약</option>
                        <option value="진행중">진행중</option>
                        <option value="완료">완료</option>
                    </select>
                </div>
                <div class="hospital-form-group">
                    <label>다음 예약 날짜</label>
                    <input type="date" id="newHospitalNextDate">
                </div>
                <div class="hospital-form-group">
                    <label>증상</label>
                    <textarea id="newHospitalSymptoms" placeholder="증상을 입력하세요"></textarea>
                </div>
                <div class="hospital-form-group">
                    <label>의사 소견</label>
                    <textarea id="newHospitalDoctorNote" placeholder="의사 소견을 입력하세요"></textarea>
                </div>
                <div class="hospital-form-group">
                    <label>사진</label>
                    <div class="form-image-upload-section">
                        <input type="file" id="hospitalImageInput" accept="image/*" style="display: none;" onchange="handleFormImageSelect(event, 'hospital', 'gallery')">
                        <input type="file" id="hospitalCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleFormImageSelect(event, 'hospital', 'camera')">
                        <div class="form-image-buttons">
                            <label class="form-image-upload-label gallery-btn" onclick="handleFormGalleryClick('hospital')">
                                <i class="fas fa-image"></i>
                                <span>갤러리</span>
                            </label>
                            <label class="form-image-upload-label camera-btn" onclick="handleFormCameraClick('hospital')">
                                <i class="fas fa-camera"></i>
                                <span>카메라</span>
                            </label>
                        </div>
                        <div class="form-image-preview-container" id="hospitalImagePreviewContainer">
                            <img src="" alt="미리보기" class="form-image-preview" id="hospitalImagePreview">
                            <button type="button" class="form-image-remove-btn" onclick="removeFormImage('hospital')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="hospital-form-submit" id="hospitalSubmitBtn">병원 기록 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 사이트관리 전체화면 모달 -->
    <div class="sitemanage-fullscreen-modal" id="sitemanageFullscreenModal">
        <div class="sitemanage-modal-header">
            <h2><i class="fas fa-globe"></i> 사이트 관리</h2>
            <button class="sitemanage-back-btn" onclick="closeSitemanageFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sitemanage-list-container" id="sitemanageListContainer">
            <!-- 사이트 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="sitemanage-fab" onclick="openSitemanageForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 사이트 상세보기 모달 -->
    <div class="sitemanage-detail-modal" id="sitemanageDetailModal">
        <div class="sitemanage-detail-header">
            <div class="left-actions">
                <button onclick="closeSitemanageDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="editCurrentSitemanage()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentSitemanage()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="sitemanage-detail-content" id="sitemanageDetailContent">
            <!-- 사이트 상세 내용이 여기에 렌더링됨 -->
        </div>
    </div>

    <!-- 사이트 입력 폼 모달 -->
    <div class="sitemanage-form-modal" id="sitemanageFormModal">
        <div class="sitemanage-form-header">
            <h2 id="sitemanageFormTitle">새 사이트 추가</h2>
            <button onclick="closeSitemanageForm()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sitemanage-form-body">
            <form id="newSitemanageForm" onsubmit="submitSitemanageForm(event)">
                <input type="hidden" id="editSitemanageId">
                <div class="sitemanage-form-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>비밀번호는 절대 적지 마세요! 보안에 취약할 수 있습니다.</span>
                </div>
                <div class="sitemanage-form-group">
                    <label>사이트 이름 *</label>
                    <input type="text" id="newSitemanageName" placeholder="사이트 이름을 입력하세요" required>
                </div>
                <div class="sitemanage-form-group">
                    <label>사이트 주소 (URL)</label>
                    <input type="url" id="newSitemanageUrl" placeholder="https://example.com">
                </div>
                <div class="sitemanage-form-group">
                    <label>사이트 ID</label>
                    <input type="text" id="newSitemanageUserId" placeholder="로그인 ID를 입력하세요">
                </div>
                <div class="sitemanage-form-group">
                    <label>메모</label>
                    <textarea id="newSitemanageMemo" placeholder="기타 메모를 입력하세요 (비밀번호는 적지 마세요!)"></textarea>
                </div>
                <button type="submit" class="sitemanage-form-submit" id="sitemanageSubmitBtn">사이트 추가하기</button>
            </form>
        </div>
    </div>

    <!-- 일반 메모 전체화면 리스트 모달 -->
    <div class="memo-fullscreen-modal" id="memoFullscreenModal">
        <div class="memo-modal-header">
            <h2><i class="fas fa-sticky-note"></i> 일반 메모</h2>
            <button class="memo-back-btn" onclick="closeMemoFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="memo-list-container" id="memoListContainer">
            <!-- 날짜별 그룹화된 메모 리스트가 여기에 렌더링됨 -->
        </div>
        <button class="memo-fab" onclick="handleMemoFabClick()">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 메모 상세보기 모달 -->
    <div class="memo-detail-modal" id="memoDetailModal">
        <div class="memo-detail-header">
            <div class="left-actions">
                <button onclick="closeMemoDetail()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="right-actions">
                <button onclick="copyMemoDetail()" title="복사">
                    <i class="fas fa-copy"></i>
                </button>
                <button onclick="shareMemoDetail()" title="공유">
                    <i class="fas fa-share-alt"></i>
                </button>
                <button onclick="editCurrentMemo()">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-action" onclick="deleteCurrentMemo()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="memo-detail-content">
            <div class="memo-date" id="memoDetailDate">
                <i class="fas fa-clock"></i>
                <span></span>
            </div>
            <h3 id="memoDetailTitle"></h3>
            <div class="memo-body" id="memoDetailBody"></div>
        </div>
    </div>

    <!-- 메모 추가/수정 폼 모달 -->
    <div class="memo-form-modal" id="memoFormModal">
        <div class="memo-form-header">
            <h2 id="memoFormTitle">새 메모</h2>
            <div class="header-btns">
                <button class="memo-cancel-btn" onclick="closeMemoForm()">취소</button>
                <button class="memo-save-btn" onclick="saveMemoForm()">저장</button>
            </div>
        </div>
        <div class="memo-form-body">
            <input type="text" class="form-input" id="memoFormTitleInput" placeholder="제목을 입력하세요">
            <textarea class="form-textarea" id="memoFormContentInput" placeholder="내용을 입력하세요..."></textarea>
            <div class="memo-image-upload-section">
                <input type="file" id="memoImageInput" accept="image/*" style="display: none;" onchange="handleMemoImageSelect(event, 'gallery')">
                <input type="file" id="memoCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleMemoImageSelect(event, 'camera')">
                <div class="memo-image-buttons">
                    <label class="memo-image-upload-label gallery-btn" onclick="handleGalleryClick()">
                        <i class="fas fa-image"></i>
                        <span>갤러리</span>
                    </label>
                </div>
                <div class="memo-image-preview-container" id="memoImagePreviewContainer">
                    <img src="" alt="미리보기" class="memo-image-preview" id="memoImagePreview">
                    <button type="button" class="memo-image-remove-btn" onclick="removeMemoImage()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 커스텀 카테고리 메모 추가/수정 폼 모달 -->
    <div class="custom-memo-form-modal" id="customMemoFormModal">
        <div class="custom-memo-form-header">
            <h2 id="customMemoFormTitle"><i class="fas fa-star"></i> 새 항목</h2>
            <div class="header-btns">
                <button class="cancel-btn" onclick="closeCustomMemoForm()">취소</button>
                <button class="save-btn" onclick="saveCustomMemoForm()">저장</button>
            </div>
        </div>
        <div class="custom-memo-form-body" id="customMemoFormBody">
            <!-- 동적으로 폼 필드가 생성됨 -->
        </div>
    </div>

    <!-- 할일 목록 전체화면 모달 -->
    <div class="todo-fullscreen-modal" id="todoFullscreenModal">
        <div class="todo-modal-header">
            <h2><i class="fas fa-check-square"></i> 할일 목록</h2>
            <button class="todo-back-btn" onclick="closeTodoFullscreen()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="todo-date-display">
            <div class="date-main" id="todoDateMain">2024년 1월 15일</div>
            <div class="date-sub" id="todoDateSub">월요일</div>
        </div>
        
        <div class="todo-success-rate">
            <div class="rate-circle" id="todoRateCircle" style="--rate: 0%;">
                <span class="rate-text" id="todoRateText">0%</span>
            </div>
            <div class="rate-info">
                <h3>오늘의 성공률</h3>
                <p id="todoRateDetail">0/0 완료</p>
            </div>
        </div>
        
        <div class="todo-list-container" id="todoListContainer">
            <div class="todo-section-title">
                <i class="fas fa-sun"></i> 오늘 할일
            </div>
            <div id="todayTodoList">
                <!-- 오늘 할일 목록 -->
            </div>
            
            <div class="todo-past-section" id="todoPastSection" style="display: none;">
                <div class="todo-past-header" onclick="togglePastTodos()">
                    <h4><i class="fas fa-history"></i> 지난 기록</h4>
                    <i class="fas fa-chevron-down todo-past-toggle" id="todoPastToggle"></i>
                </div>
                <div class="todo-past-list" id="todoPastList">
                    <!-- 지난 할일 기록 -->
                </div>
            </div>
        </div>
        
        <button class="todo-add-floating-btn" onclick="openTodoForm()">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    
    <!-- 할일 추가/수정 모달 -->
    <div class="todo-form-modal" id="todoFormModal">
        <div class="todo-form-content">
            <div class="todo-form-header">
                <h3 id="todoFormTitle">새 할일 추가</h3>
                <button class="todo-form-close" onclick="closeTodoForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="todo-form-group">
                <label>할일 제목</label>
                <input type="text" id="todoTitleInput" placeholder="할일을 입력하세요">
            </div>
            
            <div class="todo-form-group">
                <label>반복 설정</label>
                <div class="todo-repeat-options">
                    <div class="todo-repeat-option selected" data-type="daily" onclick="selectRepeatType('daily')">
                        <i class="fas fa-redo"></i>
                        <span>매일</span>
                    </div>
                    <div class="todo-repeat-option" data-type="weekday" onclick="selectRepeatType('weekday')">
                        <i class="fas fa-calendar-week"></i>
                        <span>특정 요일</span>
                    </div>
                    <div class="todo-repeat-option" data-type="specific" onclick="selectRepeatType('specific')">
                        <i class="fas fa-calendar-day"></i>
                        <span>특정 날짜</span>
                    </div>
                </div>
                
                <div id="weekdaySelector" style="display: none;">
                    <div class="todo-weekday-selector">
                        <button type="button" class="todo-weekday-btn" data-day="0" onclick="toggleWeekday(0)">일</button>
                        <button type="button" class="todo-weekday-btn" data-day="1" onclick="toggleWeekday(1)">월</button>
                        <button type="button" class="todo-weekday-btn" data-day="2" onclick="toggleWeekday(2)">화</button>
                        <button type="button" class="todo-weekday-btn" data-day="3" onclick="toggleWeekday(3)">수</button>
                        <button type="button" class="todo-weekday-btn" data-day="4" onclick="toggleWeekday(4)">목</button>
                        <button type="button" class="todo-weekday-btn" data-day="5" onclick="toggleWeekday(5)">금</button>
                        <button type="button" class="todo-weekday-btn" data-day="6" onclick="toggleWeekday(6)">토</button>
                    </div>
                </div>
                
                <div id="specificDateSelector" style="display: none;">
                    <input type="date" class="todo-date-input" id="todoSpecificDate">
                </div>
            </div>
            
            <button class="todo-submit-btn" onclick="saveTodo()">
                <i class="fas fa-check"></i> 저장하기
            </button>
        </div>
    </div>

    <!-- 알림 메시지용 토스트 -->
    <div id="toast" style="display:none; position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:#333; color:#fff; padding:12px 24px; border-radius:25px; z-index:4000; font-size:14px;"></div>

    <!-- 이미지 전체화면 보기 오버레이 -->
    <div class="image-fullscreen-overlay" id="imageFullscreenOverlay" onclick="closeImageFullscreen()">
        <button class="image-fullscreen-close" onclick="closeImageFullscreen()">
            <i class="fas fa-times"></i>
        </button>
        <img src="" alt="전체화면" id="imageFullscreenImg">
    </div>

    <!-- 일정관리 (캘린더) 모달 -->
    <div class="schedule-modal-overlay" id="scheduleModal">
        <div class="schedule-modal">
            <div class="schedule-modal-header">
                <h2><i class="fas fa-calendar-alt"></i> 일정 관리</h2>
                <button class="schedule-modal-close" onclick="closeScheduleModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="schedule-modal-body">
                <!-- 캘린더 네비게이션 -->
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" onclick="prevMonth()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="calendar-nav-title" id="calendarNavTitle" onclick="goToToday()">2024년 1월</span>
                    <button class="calendar-today-btn" onclick="goToToday()">오늘</button>
                    <button class="calendar-nav-btn" onclick="nextMonth()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- 캘린더 -->
                <div class="calendar-container">
                    <div class="calendar-weekdays">
                        <div class="calendar-weekday sunday">일</div>
                        <div class="calendar-weekday">월</div>
                        <div class="calendar-weekday">화</div>
                        <div class="calendar-weekday">수</div>
                        <div class="calendar-weekday">목</div>
                        <div class="calendar-weekday">금</div>
                        <div class="calendar-weekday saturday">토</div>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                        <!-- 캘린더 날짜가 여기에 동적으로 추가됨 -->
                    </div>
                </div>

                <!-- 선택된 날짜 일정 목록 -->
                <div class="selected-date-schedules">
                    <div class="selected-date-header">
                        <span class="selected-date-title" id="selectedDateTitle">오늘의 일정</span>
                        <button class="add-schedule-btn" onclick="openScheduleForm()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="schedule-list" id="scheduleList">
                        <!-- 일정 목록이 여기에 동적으로 추가됨 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 일정 추가/수정 폼 모달 -->
    <div class="schedule-form-overlay" id="scheduleFormModal">
        <div class="schedule-form-modal">
            <div class="schedule-form-header">
                <h3 id="scheduleFormTitle">새 일정</h3>
                <button class="schedule-form-close" onclick="closeScheduleForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="schedule-form-body">
                <div class="schedule-form-group">
                    <label>일정 제목</label>
                    <input type="text" id="scheduleTitle" placeholder="일정 제목을 입력하세요">
                </div>
                
                <label class="schedule-allday-toggle">
                    <input type="checkbox" id="scheduleAllDay" onchange="toggleTimeInputs()">
                    <span>하루 종일</span>
                </label>

                <div class="schedule-form-group" id="scheduleTimeGroup">
                    <label>시간</label>
                    <div class="schedule-time-inputs">
                        <input type="time" id="scheduleStartTime" value="09:00">
                        <span>~</span>
                        <input type="time" id="scheduleEndTime" value="10:00">
                    </div>
                </div>

                <div class="schedule-form-group">
                    <label>메모 (선택사항)</label>
                    <textarea id="scheduleMemo" placeholder="일정에 대한 메모를 남겨보세요"></textarea>
                </div>

                <label class="schedule-important-toggle">
                    <input type="checkbox" id="scheduleImportant">
                    <span><i class="fas fa-star"></i> 중요한 일정</span>
                </label>
            </div>
            <div class="schedule-form-footer">
                <button class="schedule-form-btn cancel" onclick="closeScheduleForm()">취소</button>
                <button class="schedule-form-btn save" onclick="saveSchedule()">저장</button>
            </div>
        </div>
    </div>

    <script>
        // ========== IndexedDB 기반 저장소 (Flutter WebView 호환) ==========
        const DB_NAME = 'MemoAppDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'appData';
        let db = null;
        let isDBReady = false;

        // IndexedDB 초기화
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                if (!window.indexedDB) {
                    console.warn('IndexedDB 지원 안됨');
                    resolve(false);
                    return;
                }

                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = (event) => {
                    console.error('IndexedDB 열기 실패:', event.target.error);
                    resolve(false);
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    isDBReady = true;
                    console.log('IndexedDB 연결 성공');
                    resolve(true);
                };

                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains(STORE_NAME)) {
                        database.createObjectStore(STORE_NAME, { keyPath: 'key' });
                        console.log('IndexedDB 스토어 생성됨');
                    }
                };
            });
        }

        // IndexedDB에 저장
        function saveToIndexedDB(key, value) {
            return new Promise((resolve, reject) => {
                if (!isDBReady || !db) {
                    resolve(false);
                    return;
                }

                try {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.put({ key: key, value: value, timestamp: Date.now() });

                    request.onsuccess = () => resolve(true);
                    request.onerror = (e) => {
                        console.error('IndexedDB 저장 오류:', e.target.error);
                        resolve(false);
                    };
                } catch (e) {
                    console.error('IndexedDB 저장 예외:', e);
                    resolve(false);
                }
            });
        }

        // IndexedDB에서 읽기
        function loadFromIndexedDB(key) {
            return new Promise((resolve, reject) => {
                if (!isDBReady || !db) {
                    resolve(null);
                    return;
                }

                try {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.get(key);

                    request.onsuccess = () => {
                        if (request.result) {
                            resolve(request.result.value);
                        } else {
                            resolve(null);
                        }
                    };
                    request.onerror = (e) => {
                        console.error('IndexedDB 읽기 오류:', e.target.error);
                        resolve(null);
                    };
                } catch (e) {
                    console.error('IndexedDB 읽기 예외:', e);
                    resolve(null);
                }
            });
        }

        // 모든 데이터를 IndexedDB에 저장
        async function saveAllToIndexedDB() {
            if (!isDBReady) return;
            
            const allData = {
                travels: data.travels,
                restaurants: data.restaurants,
                memos: data.memos,
                customCategories: data.customCategories,
                customCategoryMemos: data.customCategoryMemos,
                todos: data.todos,
                todoHistory: data.todoHistory,
                lastTodoDate: data.lastTodoDate,
                schedules: data.schedules || []
            };

            await saveToIndexedDB('allData', allData);
            console.log('IndexedDB에 전체 데이터 저장 완료');
        }

        // IndexedDB에서 모든 데이터 로드
        async function loadAllFromIndexedDB() {
            const allData = await loadFromIndexedDB('allData');
            return allData;
        }

        // ========== Flutter 네이티브 브릿지 ==========
        // Flutter 앱에서 호출할 수 있는 함수들

        // Flutter에서 데이터 저장 요청 시 호출
        window.flutterSaveData = function(jsonString) {
            try {
                const importedData = JSON.parse(jsonString);
                Object.keys(importedData).forEach(key => {
                    if (data.hasOwnProperty(key)) {
                        data[key] = importedData[key];
                    }
                });
                saveAllData();
                saveAllToIndexedDB();
                return JSON.stringify({ success: true });
            } catch (e) {
                console.error('Flutter 데이터 저장 오류:', e);
                return JSON.stringify({ success: false, error: e.message });
            }
        };

        // Flutter에서 데이터 가져오기 요청 시 호출
        window.flutterGetData = function() {
            try {
                const allData = {
                    travels: data.travels,
                    restaurants: data.restaurants,
                    memos: data.memos,
                    customCategories: data.customCategories,
                    customCategoryMemos: data.customCategoryMemos,
                    todos: data.todos,
                    todoHistory: data.todoHistory,
                    lastTodoDate: data.lastTodoDate
                };
                return JSON.stringify(allData);
            } catch (e) {
                console.error('Flutter 데이터 가져오기 오류:', e);
                return JSON.stringify({});
            }
        };

        // Flutter WebView에 메시지 전송 (앱이 수신 가능한 경우)
        function sendToFlutter(type, data) {
            try {
                // Flutter WebView 채널 (가능한 경우)
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('onDataChange', JSON.stringify({ type, data }));
                }
                // 대체 방식 - postMessage
                if (window.FlutterChannel) {
                    window.FlutterChannel.postMessage(JSON.stringify({ type, data }));
                }
            } catch (e) {
                // Flutter 채널이 없을 수 있음 - 무시
            }
        }

        // ========== Flutter WebView 호환성 브릿지 (카메라/공유) ==========
        
        // Flutter WebView 환경 감지
        function isFlutterWebView() {
            return !!(window.flutter_inappwebview || window.FlutterChannel || 
                     window.FlutterCameraChannel || window.FlutterShareChannel ||
                     (navigator.userAgent && navigator.userAgent.includes('wv')));
        }
        
        // Flutter WebView 환경에서 body에 클래스 추가 (카메라 버튼 숨김용)
        function applyFlutterWebViewStyles() {
            if (isFlutterWebView()) {
                document.body.classList.add('flutter-webview');
                console.log('Flutter WebView 감지됨 - 카메라 버튼 숨김');
            }
        }

        // Flutter에서 카메라 촬영 요청
        function requestFlutterCamera() {
            try {
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('openCamera', JSON.stringify({ 
                        type: 'camera',
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
                if (window.FlutterCameraChannel) {
                    window.FlutterCameraChannel.postMessage(JSON.stringify({ 
                        type: 'camera',
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
                if (window.FlutterChannel) {
                    window.FlutterChannel.postMessage(JSON.stringify({ 
                        action: 'openCamera',
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
            } catch (e) {
                console.log('Flutter 카메라 요청 실패:', e);
            }
            return false;
        }

        // Flutter에서 갤러리 열기 요청
        function requestFlutterGallery() {
            try {
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('openGallery', JSON.stringify({ 
                        type: 'gallery',
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
                if (window.FlutterGalleryChannel) {
                    window.FlutterGalleryChannel.postMessage(JSON.stringify({ 
                        type: 'gallery',
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
                if (window.FlutterChannel) {
                    window.FlutterChannel.postMessage(JSON.stringify({ 
                        action: 'openGallery',
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
            } catch (e) {
                console.log('Flutter 갤러리 요청 실패:', e);
            }
            return false;
        }

        // Flutter에서 공유 요청 (비동기로 처리하여 응답 대기)
        let flutterSharePending = false;
        let flutterShareTimeout = null;
        
        function requestFlutterShare(title, text, imageBase64, fallbackCallback) {
            try {
                const shareData = {
                    action: 'share',
                    title: title || '',
                    text: text || '',
                    image: imageBase64 || null
                };
                
                // 공유 요청 대기 상태 설정
                flutterSharePending = true;
                
                // 3초 후 응답이 없으면 폴백 처리
                if (flutterShareTimeout) clearTimeout(flutterShareTimeout);
                flutterShareTimeout = setTimeout(() => {
                    if (flutterSharePending) {
                        flutterSharePending = false;
                        console.log('Flutter 공유 응답 타임아웃 - 폴백 처리');
                        if (fallbackCallback) fallbackCallback();
                    }
                }, 3000);
                
                let requestSent = false;
                
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('share', JSON.stringify(shareData));
                    requestSent = true;
                }
                if (!requestSent && window.FlutterShareChannel) {
                    window.FlutterShareChannel.postMessage(JSON.stringify(shareData));
                    requestSent = true;
                }
                if (!requestSent && window.FlutterChannel) {
                    window.FlutterChannel.postMessage(JSON.stringify(shareData));
                    requestSent = true;
                }
                
                // 요청이 전송되지 않으면 바로 폴백
                if (!requestSent) {
                    flutterSharePending = false;
                    clearTimeout(flutterShareTimeout);
                    return false;
                }
                
                return true;
            } catch (e) {
                console.log('Flutter 공유 요청 실패:', e);
                flutterSharePending = false;
                if (flutterShareTimeout) clearTimeout(flutterShareTimeout);
            }
            return false;
        }

        // 현재 활성화된 폼 타입 추적 (Flutter에서 이미지 수신 시 사용)
        window.currentFormType = null;
        window.currentImageTarget = 'memo'; // 'memo' 또는 다른 폼 타입

        // Flutter에서 폼별 카메라 요청
        function requestFlutterCameraForForm(formType) {
            try {
                window.currentFormType = formType;
                window.currentImageTarget = formType;
                
                const requestData = { 
                    type: 'camera',
                    formType: formType,
                    maxSize: 800,
                    quality: 80
                };
                
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('openCamera', JSON.stringify(requestData));
                    return true;
                }
                if (window.FlutterCameraChannel) {
                    window.FlutterCameraChannel.postMessage(JSON.stringify(requestData));
                    return true;
                }
                if (window.FlutterChannel) {
                    window.FlutterChannel.postMessage(JSON.stringify({ 
                        action: 'openCamera',
                        formType: formType,
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
            } catch (e) {
                console.log('Flutter 폼 카메라 요청 실패:', e);
            }
            return false;
        }

        // Flutter에서 폼별 갤러리 요청
        function requestFlutterGalleryForForm(formType) {
            try {
                window.currentFormType = formType;
                window.currentImageTarget = formType;
                
                const requestData = { 
                    type: 'gallery',
                    formType: formType,
                    maxSize: 800,
                    quality: 80
                };
                
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('openGallery', JSON.stringify(requestData));
                    return true;
                }
                if (window.FlutterGalleryChannel) {
                    window.FlutterGalleryChannel.postMessage(JSON.stringify(requestData));
                    return true;
                }
                if (window.FlutterChannel) {
                    window.FlutterChannel.postMessage(JSON.stringify({ 
                        action: 'openGallery',
                        formType: formType,
                        maxSize: 800,
                        quality: 80
                    }));
                    return true;
                }
            } catch (e) {
                console.log('Flutter 폼 갤러리 요청 실패:', e);
            }
            return false;
        }

        // Flutter에서 카메라/갤러리 이미지 수신 (콜백 함수) - 확장된 버전
        window.flutterReceiveImage = function(base64ImageData, source, formType) {
            try {
                // data:image 형식인지 확인, 아니면 추가
                let imageData = base64ImageData;
                if (!imageData.startsWith('data:image')) {
                    imageData = 'data:image/jpeg;base64,' + imageData;
                }
                
                // formType이 전달되지 않으면 currentFormType 또는 currentImageTarget 사용
                const targetFormType = formType || window.currentFormType || window.currentImageTarget || 'memo';
                
                // 이미지 리사이징 후 저장
                resizeImage(imageData, 800, 800, function(resizedImage) {
                    // 메모 폼인 경우
                    if (targetFormType === 'memo' || !targetFormType) {
                        currentMemoImage = resizedImage;
                        document.getElementById('memoImagePreview').src = resizedImage;
                        document.getElementById('memoImagePreviewContainer').classList.add('active');
                    } else {
                        // 다른 폼 타입 (people, culture, travel, restaurant, hospital 등)
                        if (typeof currentFormImages !== 'undefined') {
                            currentFormImages[targetFormType] = resizedImage;
                        }
                        const previewEl = document.getElementById(targetFormType + 'ImagePreview');
                        const containerEl = document.getElementById(targetFormType + 'ImagePreviewContainer');
                        if (previewEl) previewEl.src = resizedImage;
                        if (containerEl) containerEl.classList.add('active');
                    }
                    
                    // 카메라로 찍은 사진이면 앨범에 저장 안내
                    if (source === 'camera') {
                        showToast('📸 사진이 추가되었습니다');
                    } else {
                        showToast('🖼️ 이미지가 추가되었습니다');
                    }
                    
                    // 폼 타입 초기화
                    window.currentFormType = null;
                });
                
                return JSON.stringify({ success: true });
            } catch (e) {
                console.error('Flutter 이미지 수신 오류:', e);
                showToast('이미지 처리 중 오류가 발생했습니다');
                return JSON.stringify({ success: false, error: e.message });
            }
        };

        // Flutter WebView에서 폼 이미지 수신을 위한 추가 콜백 (formType 명시)
        window.flutterReceiveFormImage = function(base64ImageData, source, formType) {
            return window.flutterReceiveImage(base64ImageData, source, formType);
        };

        // Flutter에서 공유 완료 콜백
        window.flutterShareComplete = function(success) {
            flutterSharePending = false;
            if (flutterShareTimeout) clearTimeout(flutterShareTimeout);
            
            if (success) {
                showToast('🔗 공유되었습니다');
            }
        };

        // ========== 데이터 로드 함수 (하이브리드) ==========
        function safeJSONParse(str, defaultValue) {
            try {
                if (!str || str === 'null' || str === 'undefined') return defaultValue;
                return JSON.parse(str);
            } catch (e) {
                console.warn('JSON 파싱 실패:', e);
                return defaultValue;
            }
        }

        // localStorage에서 데이터 로드
        function loadFromLocalStorage() {
            return {
                travels: safeJSONParse(localStorage.getItem('travels'), []),
                restaurants: safeJSONParse(localStorage.getItem('restaurants'), []),
                hospitals: safeJSONParse(localStorage.getItem('hospitals'), []),
                sitemanages: safeJSONParse(localStorage.getItem('sitemanages'), []),
                bankaccounts: safeJSONParse(localStorage.getItem('bankaccounts'), []),
                cultures: safeJSONParse(localStorage.getItem('cultures'), []),
                people: safeJSONParse(localStorage.getItem('people'), []),
                memos: safeJSONParse(localStorage.getItem('memos'), []),
                customCategories: safeJSONParse(localStorage.getItem('customCategories'), []),
                customCategoryMemos: safeJSONParse(localStorage.getItem('customCategoryMemos'), {}),
                todos: safeJSONParse(localStorage.getItem('todos'), []),
                todoHistory: safeJSONParse(localStorage.getItem('todoHistory'), {}),
                lastTodoDate: localStorage.getItem('lastTodoDate') || '',
                schedules: safeJSONParse(localStorage.getItem('schedules'), [])
            };
        }

        // 데이터 병합 (더 많은 항목이 있는 데이터 선택)
        function mergeData(localData, idbData) {
            if (!idbData) return localData;
            
            const merged = {};
            const keys = ['travels', 'restaurants', 'hospitals', 'sitemanages', 'bankaccounts', 'cultures', 'people', 'memos', 'customCategories', 'todos', 'schedules'];
            
            keys.forEach(key => {
                const localArr = localData[key] || [];
                const idbArr = idbData[key] || [];
                // 더 많은 항목이 있는 것을 선택 (최근 데이터가 더 많을 가능성)
                merged[key] = localArr.length >= idbArr.length ? localArr : idbArr;
            });

            // 객체 타입 데이터
            merged.customCategoryMemos = Object.keys(localData.customCategoryMemos || {}).length >= 
                                          Object.keys(idbData.customCategoryMemos || {}).length ?
                                          localData.customCategoryMemos : idbData.customCategoryMemos;
            
            merged.todoHistory = Object.keys(localData.todoHistory || {}).length >= 
                                  Object.keys(idbData.todoHistory || {}).length ?
                                  localData.todoHistory : idbData.todoHistory;
            
            merged.lastTodoDate = localData.lastTodoDate || idbData.lastTodoDate || '';
            
            return merged;
        }

        // 초기 데이터 (나중에 async로 덮어씌움)
        let data = loadFromLocalStorage();

        // 앱 시작 시 IndexedDB와 병합
        (async function initData() {
            const dbReady = await initIndexedDB();
            if (dbReady) {
                const idbData = await loadAllFromIndexedDB();
                if (idbData) {
                    data = mergeData(data, idbData);
                    console.log('IndexedDB 데이터와 병합 완료');
                    // UI 업데이트
                    if (typeof renderCustomCategories === 'function') {
                        renderCustomCategories();
                    }
                }
            }
        })();

        // 현재 보고 있는 메모 ID
        let currentMemoId = null;
        let isEditMode = false;
        let currentMemoImage = null; // 현재 선택된 이미지 (Base64)

        // 각 폼별 현재 선택된 이미지 저장
        let currentFormImages = {
            travel: null,
            restaurant: null,
            hospital: null,
            culture: null,
            people: null
        };

        // 카테고리 관련 변수
        let selectedIcon = 'fa-star';
        let selectedColor = 1;
        let currentCustomCategoryId = null; // 현재 열려있는 커스텀 카테고리

        // 할일 관련 변수
        let currentRepeatType = 'daily';
        let selectedWeekdays = [];
        let editingTodoId = null;

        // 아이콘 목록 (20개)
        const availableIcons = [
            'fa-star', 'fa-heart', 'fa-music', 'fa-camera', 'fa-film',
            'fa-gamepad', 'fa-gift', 'fa-coffee', 'fa-car', 'fa-home',
            'fa-briefcase', 'fa-graduation-cap', 'fa-paint-brush', 'fa-paw', 'fa-baby',
            'fa-bicycle', 'fa-umbrella', 'fa-cloud', 'fa-gem', 'fa-crown'
        ];

        // 그라디언트 색상 목록 (10개)
        const availableColors = [
            { id: 1, gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
            { id: 2, gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' },
            { id: 3, gradient: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' },
            { id: 4, gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)' },
            { id: 5, gradient: 'linear-gradient(135deg, #f9d423 0%, #ff4e50 100%)' },
            { id: 6, gradient: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)' },
            { id: 7, gradient: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)' },
            { id: 8, gradient: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' },
            { id: 9, gradient: 'linear-gradient(135deg, #667db6 0%, #0082c8 100%)' },
            { id: 10, gradient: 'linear-gradient(135deg, #ff5f6d 0%, #ffc371 100%)' }
        ];

        // 모달 열기/닫기
        function openModal(type) {
            // 일반 메모는 새로운 전체화면 모달로
            if (type === 'memo') {
                openMemoFullscreen();
                return;
            }
            
            // 할일 목록은 할일 전체화면 모달로
            if (type === 'todo') {
                openTodoFullscreen();
                return;
            }
            
            // 일정 관리 (캘린더)
            if (type === 'schedule') {
                openScheduleModal();
                return;
            }
            
            // 여행 관리는 전체화면 모달로
            if (type === 'travel') {
                openTravelFullscreen();
                return;
            }
            
            // 맛집 관리는 전체화면 모달로
            if (type === 'restaurant') {
                openRestaurantFullscreen();
                return;
            }
            
            // 병원 관리는 전체화면 모달로
            if (type === 'hospital') {
                openHospitalFullscreen();
                return;
            }
            
            // 사이트관리는 전체화면 모달로
            if (type === 'sitemanage') {
                openSitemanageFullscreen();
                return;
            }
            
            // 계좌번호관리는 전체화면 모달로
            if (type === 'bankaccount') {
                openBankaccountFullscreen();
                return;
            }
            
            // 문화관리는 전체화면 모달로
            if (type === 'culture') {
                openCultureFullscreen();
                return;
            }
            
            // 사람관리는 전체화면 모달로
            if (type === 'people') {
                openPeopleFullscreen();
                return;
            }
            
            showToast('준비 중인 기능입니다!');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ========== 여행 관리 전체화면 관련 함수들 ==========
        let currentTravelId = null;
        let currentRestaurantId = null;
        let selectedRestaurantRating = 3;

        // 여행 전체화면 열기
        function openTravelFullscreen() {
            document.getElementById('travelFullscreenModal').classList.add('active');
            renderTravelList();
        }

        // 여행 전체화면 닫기
        function closeTravelFullscreen() {
            document.getElementById('travelFullscreenModal').classList.remove('active');
        }

        // 여행 리스트 렌더링
        function renderTravelList() {
            const container = document.getElementById('travelListContainer');
            
            if (data.travels.length === 0) {
                container.innerHTML = `
                    <div class="travel-empty-state">
                        <i class="fas fa-plane"></i>
                        <p>아직 등록된 여행이 없습니다.<br>새로운 여행을 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.travels.map(travel => `
                    <div class="travel-card" onclick="openTravelDetail(${travel.id})">
                        ${travel.image ? `<img src="${travel.image}" alt="여행 사진" class="list-item-image">` : ''}
                        <div class="travel-card-header">
                            <div class="travel-card-title">
                                <i class="fas fa-map-marker-alt"></i>
                                ${travel.destination}
                            </div>
                            <span class="travel-card-status">${travel.status}</span>
                        </div>
                        <div class="travel-card-info">
                            ${travel.period ? `<p><i class="fas fa-calendar-alt"></i> ${travel.period}</p>` : ''}
                            ${travel.budget ? `<p><i class="fas fa-wallet"></i> ${travel.budget}</p>` : ''}
                        </div>
                        ${travel.memo ? `<div class="travel-card-memo">${travel.memo.substring(0, 50)}${travel.memo.length > 50 ? '...' : ''}</div>` : ''}
                    </div>
                `).join('');
            }
        }

        // 여행 상세보기 열기
        function openTravelDetail(id) {
            const travel = data.travels.find(t => t.id === id);
            if (!travel) return;
            
            currentTravelId = id;
            const content = document.getElementById('travelDetailContent');
            
            content.innerHTML = `
                ${travel.image ? `<img src="${travel.image}" alt="여행 사진" class="detail-item-image" onclick="openFullscreenImage('${travel.image}')">` : ''}
                <h2 class="travel-detail-title">
                    <i class="fas fa-plane"></i>
                    ${travel.destination}
                </h2>
                <div class="travel-detail-info-card">
                    <div class="travel-detail-info-item">
                        <i class="fas fa-flag"></i>
                        <div class="info-content">
                            <div class="info-label">상태</div>
                            <div class="info-value">${travel.status}</div>
                        </div>
                    </div>
                    ${travel.period ? `
                    <div class="travel-detail-info-item">
                        <i class="fas fa-calendar-alt"></i>
                        <div class="info-content">
                            <div class="info-label">여행 기간</div>
                            <div class="info-value">${travel.period}</div>
                        </div>
                    </div>
                    ` : ''}
                    ${travel.budget ? `
                    <div class="travel-detail-info-item">
                        <i class="fas fa-wallet"></i>
                        <div class="info-content">
                            <div class="info-label">예산</div>
                            <div class="info-value">${travel.budget}</div>
                        </div>
                    </div>
                    ` : ''}
                    <div class="travel-detail-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${travel.createdAt}</div>
                        </div>
                    </div>
                </div>
                ${travel.memo ? `
                <div class="travel-detail-memo-card">
                    <h4><i class="fas fa-sticky-note"></i> 메모</h4>
                    <p>${travel.memo}</p>
                </div>
                ` : ''}
            `;
            
            document.getElementById('travelDetailModal').classList.add('active');
        }

        // 여행 상세보기 닫기
        function closeTravelDetail() {
            document.getElementById('travelDetailModal').classList.remove('active');
            currentTravelId = null;
        }

        // 여행 폼 열기
        function openTravelForm(travel = null) {
            const modal = document.getElementById('travelFormModal');
            const title = document.getElementById('travelFormTitle');
            const submitBtn = document.getElementById('travelSubmitBtn');
            
            if (travel) {
                // 수정 모드
                title.textContent = '여행 수정';
                submitBtn.textContent = '여행 수정하기';
                document.getElementById('editTravelId').value = travel.id;
                document.getElementById('newTravelDestination').value = travel.destination;
                document.getElementById('newTravelPeriod').value = travel.period || '';
                document.getElementById('newTravelBudget').value = travel.budget || '';
                document.getElementById('newTravelStatus').value = travel.status;
                document.getElementById('newTravelMemo').value = travel.memo || '';
                // 이미지 로드
                loadFormImage('travel', travel.image);
            } else {
                // 추가 모드
                title.textContent = '새 여행 추가';
                submitBtn.textContent = '여행 추가하기';
                document.getElementById('newTravelForm').reset();
                document.getElementById('editTravelId').value = '';
                // 이미지 초기화
                resetFormImage('travel');
            }
            
            modal.classList.add('active');
        }

        // 여행 폼 닫기
        function closeTravelForm() {
            document.getElementById('travelFormModal').classList.remove('active');
            resetFormImage('travel');
        }

        // 여행 폼 제출
        function submitTravelForm(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editTravelId').value;
            const travelData = {
                destination: document.getElementById('newTravelDestination').value,
                period: document.getElementById('newTravelPeriod').value,
                budget: document.getElementById('newTravelBudget').value,
                status: document.getElementById('newTravelStatus').value,
                memo: document.getElementById('newTravelMemo').value,
                image: currentFormImages.travel
            };
            
            if (editId) {
                // 수정
                const index = data.travels.findIndex(t => t.id === parseInt(editId));
                if (index !== -1) {
                    data.travels[index] = {
                        ...data.travels[index],
                        ...travelData
                    };
                    showToast('여행이 수정되었습니다!');
                }
            } else {
                // 추가
                const travel = {
                    id: Date.now(),
                    ...travelData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.travels.unshift(travel);
                showToast('여행이 추가되었습니다!');
            }
            
            saveData('travels');
            renderTravelList();
            closeTravelForm();
            
            if (editId) {
                closeTravelDetail();
            }
        }

        // 현재 여행 수정
        function editCurrentTravel() {
            const travel = data.travels.find(t => t.id === currentTravelId);
            if (travel) {
                openTravelForm(travel);
            }
        }

        // 현재 여행 삭제
        function deleteCurrentTravel() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.travels = data.travels.filter(t => t.id !== currentTravelId);
                saveData('travels');
                closeTravelDetail();
                renderTravelList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 맛집 관리 전체화면 관련 함수들 ==========

        // 맛집 전체화면 열기
        function openRestaurantFullscreen() {
            document.getElementById('restaurantFullscreenModal').classList.add('active');
            renderRestaurantList();
            initRestaurantRating();
        }

        // 맛집 전체화면 닫기
        function closeRestaurantFullscreen() {
            document.getElementById('restaurantFullscreenModal').classList.remove('active');
        }

        // 맛집 리스트 렌더링
        function renderRestaurantList() {
            const container = document.getElementById('restaurantListContainer');
            
            if (data.restaurants.length === 0) {
                container.innerHTML = `
                    <div class="restaurant-empty-state">
                        <i class="fas fa-utensils"></i>
                        <p>아직 등록된 맛집이 없습니다.<br>좋아하는 맛집을 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.restaurants.map(restaurant => `
                    <div class="restaurant-card" onclick="openRestaurantDetail(${restaurant.id})">
                        ${restaurant.image ? `<img src="${restaurant.image}" alt="맛집 사진" class="list-item-image">` : ''}
                        <div class="restaurant-card-header">
                            <div class="restaurant-card-title">
                                <i class="fas fa-store"></i>
                                ${restaurant.name}
                            </div>
                            <span class="restaurant-card-category">${restaurant.category}</span>
                        </div>
                        <div class="restaurant-card-rating">${'★'.repeat(restaurant.rating)}${'☆'.repeat(5 - restaurant.rating)}</div>
                        <div class="restaurant-card-info">
                            ${restaurant.location ? `<p><i class="fas fa-map-marker-alt"></i> ${restaurant.location}</p>` : ''}
                            ${restaurant.menu ? `<p><i class="fas fa-utensils"></i> ${restaurant.menu}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // 맛집 상세보기 열기
        function openRestaurantDetail(id) {
            const restaurant = data.restaurants.find(r => r.id === id);
            if (!restaurant) return;
            
            currentRestaurantId = id;
            const content = document.getElementById('restaurantDetailContent');
            
            content.innerHTML = `
                ${restaurant.image ? `<img src="${restaurant.image}" alt="맛집 사진" class="detail-item-image" onclick="openFullscreenImage('${restaurant.image}')">` : ''}
                <h2 class="restaurant-detail-title">
                    <i class="fas fa-store"></i>
                    ${restaurant.name}
                </h2>
                <div class="restaurant-detail-rating">${'★'.repeat(restaurant.rating)}${'☆'.repeat(5 - restaurant.rating)}</div>
                <div class="restaurant-detail-info-card">
                    <div class="restaurant-detail-info-item">
                        <i class="fas fa-tag"></i>
                        <div class="info-content">
                            <div class="info-label">카테고리</div>
                            <div class="info-value">${restaurant.category}</div>
                        </div>
                    </div>
                    ${restaurant.location ? `
                    <div class="restaurant-detail-info-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="info-content">
                            <div class="info-label">위치</div>
                            <div class="info-value">${restaurant.location}</div>
                        </div>
                    </div>
                    ` : ''}
                    ${restaurant.menu ? `
                    <div class="restaurant-detail-info-item">
                        <i class="fas fa-utensils"></i>
                        <div class="info-content">
                            <div class="info-label">추천 메뉴</div>
                            <div class="info-value">${restaurant.menu}</div>
                        </div>
                    </div>
                    ` : ''}
                    <div class="restaurant-detail-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${restaurant.createdAt}</div>
                        </div>
                    </div>
                </div>
                ${restaurant.memo ? `
                <div class="restaurant-detail-memo-card">
                    <h4><i class="fas fa-sticky-note"></i> 메모</h4>
                    <p>${restaurant.memo}</p>
                </div>
                ` : ''}
            `;
            
            document.getElementById('restaurantDetailModal').classList.add('active');
        }

        // 맛집 상세보기 닫기
        function closeRestaurantDetail() {
            document.getElementById('restaurantDetailModal').classList.remove('active');
            currentRestaurantId = null;
        }

        // 맛집 폼 열기
        function openRestaurantForm(restaurant = null) {
            const modal = document.getElementById('restaurantFormModal');
            const title = document.getElementById('restaurantFormTitle');
            const submitBtn = document.getElementById('restaurantSubmitBtn');
            
            if (restaurant) {
                // 수정 모드
                title.textContent = '맛집 수정';
                submitBtn.textContent = '맛집 수정하기';
                document.getElementById('editRestaurantId').value = restaurant.id;
                document.getElementById('newRestaurantName').value = restaurant.name;
                document.getElementById('newRestaurantLocation').value = restaurant.location || '';
                document.getElementById('newRestaurantCategory').value = restaurant.category;
                document.getElementById('newRestaurantMenu').value = restaurant.menu || '';
                document.getElementById('newRestaurantMemo').value = restaurant.memo || '';
                selectedRestaurantRating = restaurant.rating;
                // 이미지 로드
                loadFormImage('restaurant', restaurant.image);
            } else {
                // 추가 모드
                title.textContent = '새 맛집 추가';
                submitBtn.textContent = '맛집 추가하기';
                document.getElementById('newRestaurantForm').reset();
                document.getElementById('editRestaurantId').value = '';
                selectedRestaurantRating = 3;
                // 이미지 초기화
                resetFormImage('restaurant');
            }
            
            updateRestaurantRatingUI();
            modal.classList.add('active');
        }

        // 맛집 폼 닫기
        function closeRestaurantForm() {
            document.getElementById('restaurantFormModal').classList.remove('active');
            resetFormImage('restaurant');
        }

        // 별점 UI 초기화
        function initRestaurantRating() {
            const stars = document.querySelectorAll('#newRestaurantRating i');
            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    selectedRestaurantRating = index + 1;
                    updateRestaurantRatingUI();
                });
            });
        }

        // 별점 UI 업데이트
        function updateRestaurantRatingUI() {
            const stars = document.querySelectorAll('#newRestaurantRating i');
            stars.forEach((star, index) => {
                if (index < selectedRestaurantRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // 맛집 폼 제출
        function submitRestaurantForm(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editRestaurantId').value;
            const restaurantData = {
                name: document.getElementById('newRestaurantName').value,
                location: document.getElementById('newRestaurantLocation').value,
                category: document.getElementById('newRestaurantCategory').value,
                rating: selectedRestaurantRating,
                menu: document.getElementById('newRestaurantMenu').value,
                memo: document.getElementById('newRestaurantMemo').value,
                image: currentFormImages.restaurant
            };
            
            if (editId) {
                // 수정
                const index = data.restaurants.findIndex(r => r.id === parseInt(editId));
                if (index !== -1) {
                    data.restaurants[index] = {
                        ...data.restaurants[index],
                        ...restaurantData
                    };
                    showToast('맛집이 수정되었습니다!');
                }
            } else {
                // 추가
                const restaurant = {
                    id: Date.now(),
                    ...restaurantData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.restaurants.unshift(restaurant);
                showToast('맛집이 추가되었습니다!');
            }
            
            saveData('restaurants');
            renderRestaurantList();
            closeRestaurantForm();
            
            if (editId) {
                closeRestaurantDetail();
            }
        }

        // 현재 맛집 수정
        function editCurrentRestaurant() {
            const restaurant = data.restaurants.find(r => r.id === currentRestaurantId);
            if (restaurant) {
                openRestaurantForm(restaurant);
            }
        }

        // 현재 맛집 삭제
        function deleteCurrentRestaurant() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.restaurants = data.restaurants.filter(r => r.id !== currentRestaurantId);
                saveData('restaurants');
                closeRestaurantDetail();
                renderRestaurantList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 문화관리 전체화면 관련 함수들 ==========
        let currentCultureId = null;

        // 문화 전체화면 열기
        function openCultureFullscreen() {
            document.getElementById('cultureFullscreenModal').classList.add('active');
            renderCultureList();
        }

        // 문화 전체화면 닫기
        function closeCultureFullscreen() {
            document.getElementById('cultureFullscreenModal').classList.remove('active');
        }

        // 장르별 아이콘 매핑
        function getCultureIcon(genre) {
            const icons = {
                '독서': 'fa-book',
                '영화': 'fa-film',
                '드라마': 'fa-tv',
                '연극': 'fa-theater-masks',
                '콘서트': 'fa-music',
                '취미': 'fa-palette',
                '기타': 'fa-star'
            };
            return icons[genre] || 'fa-star';
        }

        // 문화 리스트 렌더링
        function renderCultureList() {
            const container = document.getElementById('cultureListContainer');
            
            if (!data.cultures) data.cultures = [];
            
            if (data.cultures.length === 0) {
                container.innerHTML = `
                    <div class="culture-empty-state">
                        <i class="fas fa-theater-masks"></i>
                        <p>아직 등록된 문화 기록이 없습니다.<br>새로운 기록을 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.cultures.map(culture => `
                    <div class="culture-card" onclick="openCultureDetail(${culture.id})">
                        ${culture.image ? `<img src="${culture.image}" alt="문화 사진" class="list-item-image">` : ''}
                        <div class="culture-card-header">
                            <div class="culture-card-title">
                                <i class="fas ${getCultureIcon(culture.genre)}"></i>
                                ${escapeHtml(culture.target)}
                            </div>
                            <span class="culture-card-genre">${escapeHtml(culture.genre)}</span>
                        </div>
                        <div class="culture-card-info">
                            ${culture.content ? `<p><i class="fas fa-sticky-note"></i> ${escapeHtml(culture.content.substring(0, 50))}${culture.content.length > 50 ? '...' : ''}</p>` : ''}
                            <p><i class="fas fa-clock"></i> ${culture.createdAt}</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        // 문화 상세보기 열기
        function openCultureDetail(id) {
            const culture = data.cultures.find(c => c.id === id);
            if (!culture) return;
            
            currentCultureId = id;
            const content = document.getElementById('cultureDetailContent');
            
            content.innerHTML = `
                ${culture.image ? `<img src="${culture.image}" alt="문화 사진" class="detail-item-image" onclick="openFullscreenImage('${culture.image}')">` : ''}
                <h2 class="culture-detail-title">
                    <i class="fas ${getCultureIcon(culture.genre)}"></i>
                    ${escapeHtml(culture.target)}
                </h2>
                <span class="culture-detail-genre-badge">${escapeHtml(culture.genre)}</span>
                <div class="culture-detail-info-card">
                    <div class="culture-detail-info-item">
                        <i class="fas fa-tag"></i>
                        <div class="info-content">
                            <div class="info-label">장르</div>
                            <div class="info-value">${escapeHtml(culture.genre)}</div>
                        </div>
                    </div>
                    <div class="culture-detail-info-item">
                        <i class="fas fa-user"></i>
                        <div class="info-content">
                            <div class="info-label">인물/대상</div>
                            <div class="info-value">${escapeHtml(culture.target)}</div>
                        </div>
                    </div>
                    <div class="culture-detail-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${culture.createdAt}</div>
                        </div>
                    </div>
                </div>
                ${culture.content ? `
                <div class="culture-detail-memo-card">
                    <h4><i class="fas fa-sticky-note"></i> 주요내용</h4>
                    <p>${escapeHtml(culture.content)}</p>
                </div>
                ` : ''}
            `;
            
            document.getElementById('cultureDetailModal').classList.add('active');
        }

        // 문화 상세보기 닫기
        function closeCultureDetail() {
            document.getElementById('cultureDetailModal').classList.remove('active');
            currentCultureId = null;
        }

        // 문화 폼 열기
        function openCultureForm(culture = null) {
            const modal = document.getElementById('cultureFormModal');
            const title = document.getElementById('cultureFormTitle');
            const submitBtn = document.getElementById('cultureSubmitBtn');
            
            if (culture) {
                // 수정 모드
                title.textContent = '문화 기록 수정';
                submitBtn.textContent = '수정하기';
                document.getElementById('editCultureId').value = culture.id;
                document.getElementById('newCultureGenre').value = culture.genre;
                document.getElementById('newCultureTarget').value = culture.target;
                document.getElementById('newCultureContent').value = culture.content || '';
                // 이미지 로드
                loadFormImage('culture', culture.image);
            } else {
                // 추가 모드
                title.textContent = '새 문화 기록 추가';
                submitBtn.textContent = '문화 기록 추가하기';
                document.getElementById('newCultureForm').reset();
                document.getElementById('editCultureId').value = '';
                // 이미지 초기화
                resetFormImage('culture');
            }
            
            modal.classList.add('active');
        }

        // 문화 폼 닫기
        function closeCultureForm() {
            document.getElementById('cultureFormModal').classList.remove('active');
            resetFormImage('culture');
        }

        // 문화 폼 제출
        function submitCultureForm(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editCultureId').value;
            const cultureData = {
                genre: document.getElementById('newCultureGenre').value,
                target: document.getElementById('newCultureTarget').value,
                content: document.getElementById('newCultureContent').value,
                image: currentFormImages.culture
            };
            
            if (!data.cultures) data.cultures = [];
            
            if (editId) {
                // 수정
                const index = data.cultures.findIndex(c => c.id === parseInt(editId));
                if (index !== -1) {
                    data.cultures[index] = {
                        ...data.cultures[index],
                        ...cultureData
                    };
                    showToast('문화 기록이 수정되었습니다!');
                }
            } else {
                // 추가
                const culture = {
                    id: Date.now(),
                    ...cultureData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.cultures.unshift(culture);
                showToast('문화 기록이 추가되었습니다!');
            }
            
            saveData('cultures');
            renderCultureList();
            closeCultureForm();
            
            if (editId) {
                closeCultureDetail();
            }
        }

        // 현재 문화 수정
        function editCurrentCulture() {
            const culture = data.cultures.find(c => c.id === currentCultureId);
            if (culture) {
                openCultureForm(culture);
            }
        }

        // 현재 문화 삭제
        function deleteCurrentCulture() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.cultures = data.cultures.filter(c => c.id !== currentCultureId);
                saveData('cultures');
                closeCultureDetail();
                renderCultureList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 사람관리 전체화면 관련 함수들 ==========
        let currentPeopleId = null;
        let selectedPeopleImportance = '중간';

        // 사람 전체화면 열기
        function openPeopleFullscreen() {
            document.getElementById('peopleFullscreenModal').classList.add('active');
            renderPeopleList();
        }

        // 사람 전체화면 닫기
        function closePeopleFullscreen() {
            document.getElementById('peopleFullscreenModal').classList.remove('active');
        }

        // 관계별 아이콘 매핑
        function getPeopleIcon(relation) {
            const icons = {
                '가족': 'fa-home',
                '친척': 'fa-users',
                '친구': 'fa-user-friends',
                '업무': 'fa-briefcase',
                '기타': 'fa-user'
            };
            return icons[relation] || 'fa-user';
        }

        // 중요도 표시
        function getImportanceStars(importance) {
            const stars = {
                '낮음': '<i class="fas fa-star"></i>',
                '중간': '<i class="fas fa-star"></i><i class="fas fa-star"></i>',
                '높음': '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>'
            };
            return stars[importance] || stars['중간'];
        }

        // 중요도 클래스
        function getImportanceClass(importance) {
            const classes = {
                '낮음': 'low',
                '중간': 'medium',
                '높음': 'high'
            };
            return classes[importance] || 'medium';
        }

        // 사람 리스트 렌더링
        function renderPeopleList() {
            const container = document.getElementById('peopleListContainer');
            
            if (!data.people) data.people = [];
            
            if (data.people.length === 0) {
                container.innerHTML = `
                    <div class="people-empty-state">
                        <i class="fas fa-users"></i>
                        <p>아직 등록된 인물이 없습니다.<br>새로운 인물을 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.people.map(person => `
                    <div class="people-card" onclick="openPeopleDetail(${person.id})">
                        ${person.image ? `<img src="${person.image}" alt="인물 사진" class="list-item-image">` : ''}
                        <div class="people-card-header">
                            <div class="people-card-title">
                                <i class="fas ${getPeopleIcon(person.relation)}"></i>
                                ${escapeHtml(person.name)}
                            </div>
                            <span class="people-card-relation">${escapeHtml(person.relation)}</span>
                        </div>
                        <div class="people-card-importance ${getImportanceClass(person.importance)}">
                            ${getImportanceStars(person.importance)}
                        </div>
                        <div class="people-card-info">
                            ${person.phone ? `<p><i class="fas fa-phone"></i> ${escapeHtml(person.phone)}</p>` : ''}
                            ${person.email ? `<p><i class="fas fa-envelope"></i> ${escapeHtml(person.email)}</p>` : ''}
                            ${person.note ? `<p><i class="fas fa-sticky-note"></i> ${escapeHtml(person.note.substring(0, 30))}${person.note.length > 30 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // 사람 상세보기 열기
        function openPeopleDetail(id) {
            const person = data.people.find(p => p.id === id);
            if (!person) return;
            
            currentPeopleId = id;
            const content = document.getElementById('peopleDetailContent');
            
            content.innerHTML = `
                ${person.image ? `<img src="${person.image}" alt="인물 사진" class="detail-item-image" onclick="openFullscreenImage('${person.image}')">` : ''}
                <h2 class="people-detail-title">
                    <i class="fas ${getPeopleIcon(person.relation)}"></i>
                    ${escapeHtml(person.name)}
                </h2>
                <div class="people-detail-importance ${getImportanceClass(person.importance)}">
                    ${getImportanceStars(person.importance)} ${person.importance}
                </div>
                <div class="people-detail-info-card">
                    <div class="people-detail-info-item">
                        <i class="fas fa-heart"></i>
                        <div class="info-content">
                            <div class="info-label">관계</div>
                            <div class="info-value">${escapeHtml(person.relation)}</div>
                        </div>
                    </div>
                    <div class="people-detail-info-item">
                        <i class="fas fa-user"></i>
                        <div class="info-content">
                            <div class="info-label">이름</div>
                            <div class="info-value">${escapeHtml(person.name)}</div>
                        </div>
                    </div>
                    ${person.phone ? `
                    <div class="people-detail-info-item">
                        <i class="fas fa-phone"></i>
                        <div class="info-content">
                            <div class="info-label">전화번호</div>
                            <div class="info-value">${escapeHtml(person.phone)}</div>
                        </div>
                    </div>
                    ` : ''}
                    ${person.email ? `
                    <div class="people-detail-info-item">
                        <i class="fas fa-envelope"></i>
                        <div class="info-content">
                            <div class="info-label">이메일</div>
                            <div class="info-value">${escapeHtml(person.email)}</div>
                        </div>
                    </div>
                    ` : ''}
                    <div class="people-detail-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${person.createdAt}</div>
                        </div>
                    </div>
                </div>
                ${person.note ? `
                <div class="people-detail-memo-card">
                    <h4><i class="fas fa-sticky-note"></i> 특이사항</h4>
                    <p>${escapeHtml(person.note)}</p>
                </div>
                ` : ''}
            `;
            
            document.getElementById('peopleDetailModal').classList.add('active');
        }

        // 사람 상세보기 닫기
        function closePeopleDetail() {
            document.getElementById('peopleDetailModal').classList.remove('active');
            currentPeopleId = null;
        }

        // 중요도 선택
        function selectPeopleImportance(importance) {
            selectedPeopleImportance = importance;
            document.querySelectorAll('.people-importance-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.value === importance) {
                    opt.classList.add('active');
                }
            });
        }

        // 사람 폼 열기
        function openPeopleForm(person = null) {
            const modal = document.getElementById('peopleFormModal');
            const title = document.getElementById('peopleFormTitle');
            const submitBtn = document.getElementById('peopleSubmitBtn');
            
            if (person) {
                // 수정 모드
                title.textContent = '인물 수정';
                submitBtn.textContent = '수정하기';
                document.getElementById('editPeopleId').value = person.id;
                document.getElementById('newPeopleRelation').value = person.relation;
                document.getElementById('newPeopleName').value = person.name;
                document.getElementById('newPeoplePhone').value = person.phone || '';
                document.getElementById('newPeopleEmail').value = person.email || '';
                document.getElementById('newPeopleNote').value = person.note || '';
                selectPeopleImportance(person.importance || '중간');
                // 이미지 로드
                loadFormImage('people', person.image);
            } else {
                // 추가 모드
                title.textContent = '새 인물 추가';
                submitBtn.textContent = '인물 추가하기';
                document.getElementById('newPeopleForm').reset();
                document.getElementById('editPeopleId').value = '';
                selectPeopleImportance('중간');
                // 이미지 초기화
                resetFormImage('people');
            }
            
            modal.classList.add('active');
        }

        // 사람 폼 닫기
        function closePeopleForm() {
            document.getElementById('peopleFormModal').classList.remove('active');
            resetFormImage('people');
        }

        // 사람 폼 제출
        function submitPeopleForm(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editPeopleId').value;
            const personData = {
                relation: document.getElementById('newPeopleRelation').value,
                name: document.getElementById('newPeopleName').value,
                phone: document.getElementById('newPeoplePhone').value,
                email: document.getElementById('newPeopleEmail').value,
                importance: selectedPeopleImportance,
                note: document.getElementById('newPeopleNote').value,
                image: currentFormImages.people
            };
            
            if (!data.people) data.people = [];
            
            if (editId) {
                // 수정
                const index = data.people.findIndex(p => p.id === parseInt(editId));
                if (index !== -1) {
                    data.people[index] = {
                        ...data.people[index],
                        ...personData
                    };
                    showToast('인물 정보가 수정되었습니다!');
                }
            } else {
                // 추가
                const person = {
                    id: Date.now(),
                    ...personData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.people.unshift(person);
                showToast('인물이 추가되었습니다!');
            }
            
            saveData('people');
            renderPeopleList();
            closePeopleForm();
            
            if (editId) {
                closePeopleDetail();
            }
        }

        // 현재 사람 수정
        function editCurrentPeople() {
            const person = data.people.find(p => p.id === currentPeopleId);
            if (person) {
                openPeopleForm(person);
            }
        }

        // 현재 사람 삭제
        function deleteCurrentPeople() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.people = data.people.filter(p => p.id !== currentPeopleId);
                saveData('people');
                closePeopleDetail();
                renderPeopleList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 계좌번호 관리 전체화면 관련 함수들 ==========
        let currentBankaccountId = null;

        // 계좌번호 전체화면 열기
        function openBankaccountFullscreen() {
            document.getElementById('bankaccountFullscreenModal').classList.add('active');
            renderBankaccountList();
        }

        // 계좌번호 전체화면 닫기
        function closeBankaccountFullscreen() {
            document.getElementById('bankaccountFullscreenModal').classList.remove('active');
        }

        // 계좌번호 리스트 렌더링
        function renderBankaccountList() {
            const container = document.getElementById('bankaccountListContainer');
            
            if (!data.bankaccounts) data.bankaccounts = [];
            
            if (data.bankaccounts.length === 0) {
                container.innerHTML = `
                    <div class="bankaccount-empty-state">
                        <i class="fas fa-university"></i>
                        <p>아직 등록된 계좌가 없습니다.<br>새로운 계좌를 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.bankaccounts.map(account => `
                    <div class="bankaccount-card" onclick="openBankaccountDetail(${account.id})">
                        <div class="bankaccount-card-header">
                            <div class="bankaccount-card-title">
                                <i class="fas fa-credit-card"></i>
                                ${escapeHtml(account.owner)}
                            </div>
                            <span class="bankaccount-card-bank">${escapeHtml(account.bank)}</span>
                        </div>
                        <div class="bankaccount-card-info">
                            <p><i class="fas fa-hashtag"></i> ${escapeHtml(account.accountNumber)}</p>
                            ${account.memo ? `<p><i class="fas fa-sticky-note"></i> ${escapeHtml(account.memo.substring(0, 30))}${account.memo.length > 30 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // 계좌번호 상세보기 열기
        function openBankaccountDetail(id) {
            const account = data.bankaccounts.find(a => a.id === id);
            if (!account) return;
            
            currentBankaccountId = id;
            const content = document.getElementById('bankaccountDetailContent');
            
            content.innerHTML = `
                <h2 class="bankaccount-detail-title">
                    <i class="fas fa-credit-card"></i>
                    ${escapeHtml(account.owner)}
                </h2>
                <div class="bankaccount-detail-bank">${escapeHtml(account.bank)}</div>
                <div class="bankaccount-detail-info-card">
                    <div class="bankaccount-detail-info-item">
                        <i class="fas fa-university"></i>
                        <div class="info-content">
                            <div class="info-label">은행</div>
                            <div class="info-value">${escapeHtml(account.bank)}</div>
                        </div>
                    </div>
                    <div class="bankaccount-detail-info-item">
                        <i class="fas fa-hashtag"></i>
                        <div class="info-content">
                            <div class="info-label">계좌번호</div>
                            <div class="info-value account-number">${escapeHtml(account.accountNumber)}</div>
                        </div>
                        <button class="copy-account-btn" onclick="copyAccountNumber(event, '${escapeHtml(account.accountNumber)}')">
                            <i class="fas fa-copy"></i>복사
                        </button>
                    </div>
                    <div class="bankaccount-detail-info-item">
                        <i class="fas fa-user"></i>
                        <div class="info-content">
                            <div class="info-label">소유자</div>
                            <div class="info-value">${escapeHtml(account.owner)}</div>
                        </div>
                    </div>
                    <div class="bankaccount-detail-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${account.createdAt}</div>
                        </div>
                    </div>
                </div>
                ${account.memo ? `
                <div class="bankaccount-detail-memo-card">
                    <h4><i class="fas fa-sticky-note"></i> 메모</h4>
                    <p>${escapeHtml(account.memo)}</p>
                </div>
                ` : ''}
                <div class="bankaccount-detail-warning">
                    <i class="fas fa-shield-alt"></i>
                    <span>계좌 정보를 안전하게 보관하세요. 비밀번호나 보안카드 정보는 저장하지 마세요.</span>
                </div>
            `;
            
            document.getElementById('bankaccountDetailModal').classList.add('active');
        }

        // 계좌번호 복사 함수
        function copyAccountNumber(event, accountNumber) {
            event.stopPropagation();
            navigator.clipboard.writeText(accountNumber).then(() => {
                showToast('계좌번호가 복사되었습니다!');
            }).catch(err => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = accountNumber;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('계좌번호가 복사되었습니다!');
            });
        }

        // 계좌번호 상세보기 닫기
        function closeBankaccountDetail() {
            document.getElementById('bankaccountDetailModal').classList.remove('active');
            currentBankaccountId = null;
        }

        // 계좌번호 폼 열기
        function openBankaccountForm(account = null) {
            const modal = document.getElementById('bankaccountFormModal');
            const title = document.getElementById('bankaccountFormTitle');
            const submitBtn = document.getElementById('bankaccountSubmitBtn');
            
            if (account) {
                // 수정 모드
                title.textContent = '계좌 수정';
                submitBtn.textContent = '계좌 수정하기';
                document.getElementById('editBankaccountId').value = account.id;
                document.getElementById('newBankaccountBank').value = account.bank;
                document.getElementById('newBankaccountNumber').value = account.accountNumber;
                document.getElementById('newBankaccountOwner').value = account.owner;
                document.getElementById('newBankaccountMemo').value = account.memo || '';
            } else {
                // 추가 모드
                title.textContent = '새 계좌 추가';
                submitBtn.textContent = '계좌 추가하기';
                document.getElementById('newBankaccountForm').reset();
                document.getElementById('editBankaccountId').value = '';
            }
            
            modal.classList.add('active');
        }

        // 계좌번호 폼 닫기
        function closeBankaccountForm() {
            document.getElementById('bankaccountFormModal').classList.remove('active');
        }

        // 계좌번호 폼 제출
        function submitBankaccountForm(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editBankaccountId').value;
            const accountData = {
                bank: document.getElementById('newBankaccountBank').value,
                accountNumber: document.getElementById('newBankaccountNumber').value,
                owner: document.getElementById('newBankaccountOwner').value,
                memo: document.getElementById('newBankaccountMemo').value
            };
            
            if (!data.bankaccounts) data.bankaccounts = [];
            
            if (editId) {
                // 수정
                const index = data.bankaccounts.findIndex(a => a.id === parseInt(editId));
                if (index !== -1) {
                    data.bankaccounts[index] = {
                        ...data.bankaccounts[index],
                        ...accountData
                    };
                    showToast('계좌가 수정되었습니다!');
                }
            } else {
                // 추가
                const account = {
                    id: Date.now(),
                    ...accountData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.bankaccounts.unshift(account);
                showToast('계좌가 추가되었습니다!');
            }
            
            saveData('bankaccounts');
            renderBankaccountList();
            closeBankaccountForm();
            
            if (editId) {
                closeBankaccountDetail();
            }
        }

        // 현재 계좌 수정
        function editCurrentBankaccount() {
            const account = data.bankaccounts.find(a => a.id === currentBankaccountId);
            if (account) {
                openBankaccountForm(account);
            }
        }

        // 현재 계좌 삭제
        function deleteCurrentBankaccount() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.bankaccounts = data.bankaccounts.filter(a => a.id !== currentBankaccountId);
                saveData('bankaccounts');
                closeBankaccountDetail();
                renderBankaccountList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 병원 관리 전체화면 관련 함수들 ==========
        let currentHospitalId = null;

        // 병원 전체화면 열기
        function openHospitalFullscreen() {
            document.getElementById('hospitalFullscreenModal').classList.add('active');
            renderHospitalList();
        }

        // 병원 전체화면 닫기
        function closeHospitalFullscreen() {
            document.getElementById('hospitalFullscreenModal').classList.remove('active');
        }

        // 병원 리스트 렌더링
        function renderHospitalList() {
            const container = document.getElementById('hospitalListContainer');
            
            if (!data.hospitals) data.hospitals = [];
            
            if (data.hospitals.length === 0) {
                container.innerHTML = `
                    <div class="hospital-empty-state">
                        <i class="fas fa-hospital"></i>
                        <p>아직 등록된 병원 기록이 없습니다.<br>새로운 기록을 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.hospitals.map(hospital => `
                    <div class="hospital-card" onclick="openHospitalDetail(${hospital.id})">
                        ${hospital.image ? `<img src="${hospital.image}" alt="병원 사진" class="list-item-image">` : ''}
                        <div class="hospital-card-header">
                            <div class="hospital-card-title">
                                <i class="fas fa-hospital"></i>
                                ${escapeHtml(hospital.name)}
                            </div>
                            <span class="hospital-card-status ${hospital.status}">${hospital.status}</span>
                        </div>
                        <div class="hospital-card-info">
                            ${hospital.disease ? `<p><i class="fas fa-notes-medical"></i> ${escapeHtml(hospital.disease)}</p>` : ''}
                            ${hospital.patient ? `<p><i class="fas fa-user"></i> ${escapeHtml(hospital.patient)}</p>` : ''}
                            ${hospital.nextDate ? `<p><i class="fas fa-calendar-check"></i> 다음 예약: ${hospital.nextDate}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // 병원 상세보기 열기
        function openHospitalDetail(id) {
            const hospital = data.hospitals.find(h => h.id === id);
            if (!hospital) return;
            
            currentHospitalId = id;
            const content = document.getElementById('hospitalDetailContent');
            
            content.innerHTML = `
                ${hospital.image ? `<img src="${hospital.image}" alt="병원 사진" class="detail-item-image" onclick="openFullscreenImage('${hospital.image}')">` : ''}
                <h2 class="hospital-detail-title">
                    <i class="fas fa-hospital"></i>
                    ${escapeHtml(hospital.name)}
                </h2>
                <div class="hospital-detail-status ${hospital.status}">${hospital.status}</div>
                <div class="hospital-detail-info-card">
                    ${hospital.disease ? `
                    <div class="hospital-detail-info-item">
                        <i class="fas fa-notes-medical"></i>
                        <div class="info-content">
                            <div class="info-label">병명</div>
                            <div class="info-value">${escapeHtml(hospital.disease)}</div>
                        </div>
                    </div>
                    ` : ''}
                    ${hospital.patient ? `
                    <div class="hospital-detail-info-item">
                        <i class="fas fa-user"></i>
                        <div class="info-content">
                            <div class="info-label">환자명</div>
                            <div class="info-value">${escapeHtml(hospital.patient)}</div>
                        </div>
                    </div>
                    ` : ''}
                    ${hospital.nextDate ? `
                    <div class="hospital-detail-info-item">
                        <i class="fas fa-calendar-check"></i>
                        <div class="info-content">
                            <div class="info-label">다음 예약 날짜</div>
                            <div class="info-value">${hospital.nextDate}</div>
                        </div>
                    </div>
                    ` : ''}
                    <div class="hospital-detail-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${hospital.createdAt}</div>
                        </div>
                    </div>
                </div>
                ${hospital.symptoms ? `
                <div class="hospital-detail-memo-card">
                    <h4><i class="fas fa-stethoscope"></i> 증상</h4>
                    <p>${escapeHtml(hospital.symptoms)}</p>
                </div>
                ` : ''}
                ${hospital.doctorNote ? `
                <div class="hospital-detail-memo-card">
                    <h4><i class="fas fa-user-md"></i> 의사 소견</h4>
                    <p>${escapeHtml(hospital.doctorNote)}</p>
                </div>
                ` : ''}
            `;
            
            document.getElementById('hospitalDetailModal').classList.add('active');
        }

        // 병원 상세보기 닫기
        function closeHospitalDetail() {
            document.getElementById('hospitalDetailModal').classList.remove('active');
            currentHospitalId = null;
        }

        // 병원 폼 열기
        function openHospitalForm(hospital = null) {
            const modal = document.getElementById('hospitalFormModal');
            const title = document.getElementById('hospitalFormTitle');
            const submitBtn = document.getElementById('hospitalSubmitBtn');
            
            if (hospital) {
                // 수정 모드
                title.textContent = '병원 기록 수정';
                submitBtn.textContent = '병원 기록 수정하기';
                document.getElementById('editHospitalId').value = hospital.id;
                document.getElementById('newHospitalName').value = hospital.name;
                document.getElementById('newHospitalDisease').value = hospital.disease || '';
                document.getElementById('newHospitalPatient').value = hospital.patient || '';
                document.getElementById('newHospitalStatus').value = hospital.status;
                document.getElementById('newHospitalNextDate').value = hospital.nextDate || '';
                document.getElementById('newHospitalSymptoms').value = hospital.symptoms || '';
                document.getElementById('newHospitalDoctorNote').value = hospital.doctorNote || '';
                // 이미지 로드
                loadFormImage('hospital', hospital.image);
            } else {
                // 추가 모드
                title.textContent = '새 병원 기록 추가';
                submitBtn.textContent = '병원 기록 추가하기';
                document.getElementById('newHospitalForm').reset();
                document.getElementById('editHospitalId').value = '';
                // 이미지 초기화
                resetFormImage('hospital');
            }
            
            modal.classList.add('active');
        }

        // 병원 폼 닫기
        function closeHospitalForm() {
            document.getElementById('hospitalFormModal').classList.remove('active');
            resetFormImage('hospital');
        }

        // 병원 폼 제출
        function submitHospitalForm(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editHospitalId').value;
            const hospitalData = {
                name: document.getElementById('newHospitalName').value,
                disease: document.getElementById('newHospitalDisease').value,
                patient: document.getElementById('newHospitalPatient').value,
                status: document.getElementById('newHospitalStatus').value,
                nextDate: document.getElementById('newHospitalNextDate').value,
                symptoms: document.getElementById('newHospitalSymptoms').value,
                doctorNote: document.getElementById('newHospitalDoctorNote').value,
                image: currentFormImages.hospital
            };
            
            if (!data.hospitals) data.hospitals = [];
            
            if (editId) {
                // 수정
                const index = data.hospitals.findIndex(h => h.id === parseInt(editId));
                if (index !== -1) {
                    data.hospitals[index] = {
                        ...data.hospitals[index],
                        ...hospitalData
                    };
                    showToast('병원 기록이 수정되었습니다!');
                }
            } else {
                // 추가
                const hospital = {
                    id: Date.now(),
                    ...hospitalData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.hospitals.unshift(hospital);
                showToast('병원 기록이 추가되었습니다!');
            }
            
            saveData('hospitals');
            renderHospitalList();
            closeHospitalForm();
            
            if (editId) {
                closeHospitalDetail();
            }
        }

        // 현재 병원 기록 수정
        function editCurrentHospital() {
            const hospital = data.hospitals.find(h => h.id === currentHospitalId);
            if (hospital) {
                openHospitalForm(hospital);
            }
        }

        // 현재 병원 기록 삭제
        function deleteCurrentHospital() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.hospitals = data.hospitals.filter(h => h.id !== currentHospitalId);
                saveData('hospitals');
                closeHospitalDetail();
                renderHospitalList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 사이트관리 전체화면 관련 함수들 ==========
        let currentSitemanageId = null;

        // 사이트관리 전체화면 열기
        function openSitemanageFullscreen() {
            document.getElementById('sitemanageFullscreenModal').classList.add('active');
            renderSitemanageList();
        }

        // 사이트관리 전체화면 닫기
        function closeSitemanageFullscreen() {
            document.getElementById('sitemanageFullscreenModal').classList.remove('active');
        }

        // 사이트 리스트 렌더링
        function renderSitemanageList() {
            const container = document.getElementById('sitemanageListContainer');
            
            if (!data.sitemanages) data.sitemanages = [];
            
            if (data.sitemanages.length === 0) {
                container.innerHTML = `
                    <div class="sitemanage-empty-state">
                        <i class="fas fa-globe"></i>
                        <p>아직 등록된 사이트가 없습니다.<br>자주 방문하는 사이트를 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.sitemanages.map(site => `
                    <div class="sitemanage-card" onclick="openSitemanageDetail(${site.id})">
                        <div class="sitemanage-card-header">
                            <div class="sitemanage-card-title">
                                <i class="fas fa-globe"></i>
                                ${escapeHtml(site.name)}
                            </div>
                            ${site.url ? `<a href="${escapeHtml(site.url)}" target="_blank" rel="noopener noreferrer" class="sitemanage-card-link" onclick="event.stopPropagation()"><i class="fas fa-external-link-alt"></i> 방문</a>` : ''}
                        </div>
                        <div class="sitemanage-card-info">
                            ${site.userId ? `<p><i class="fas fa-user"></i> ${escapeHtml(site.userId)}</p>` : ''}
                            ${site.memo ? `<p><i class="fas fa-sticky-note"></i> ${escapeHtml(site.memo.substring(0, 50))}${site.memo.length > 50 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // 사이트 상세보기 열기
        function openSitemanageDetail(id) {
            const site = data.sitemanages.find(s => s.id === id);
            if (!site) return;
            
            currentSitemanageId = id;
            const container = document.getElementById('sitemanageDetailContent');
            
            container.innerHTML = `
                <div class="sitemanage-detail-title">
                    <i class="fas fa-globe"></i>
                    ${escapeHtml(site.name)}
                </div>
                
                ${site.url ? `
                    <a href="${escapeHtml(site.url)}" target="_blank" rel="noopener noreferrer" class="sitemanage-detail-url">
                        <i class="fas fa-external-link-alt"></i>
                        사이트 방문하기
                    </a>
                ` : ''}
                
                <div class="sitemanage-detail-info-card">
                    ${site.url ? `
                        <div class="sitemanage-detail-info-item">
                            <i class="fas fa-link"></i>
                            <div class="info-content">
                                <div class="info-label">사이트 주소</div>
                                <div class="info-value">${escapeHtml(site.url)}</div>
                            </div>
                        </div>
                    ` : ''}
                    ${site.userId ? `
                        <div class="sitemanage-detail-info-item">
                            <i class="fas fa-user"></i>
                            <div class="info-content">
                                <div class="info-label">사이트 ID</div>
                                <div class="info-value">${escapeHtml(site.userId)}</div>
                            </div>
                        </div>
                    ` : ''}
                    <div class="sitemanage-detail-info-item">
                        <i class="fas fa-calendar-alt"></i>
                        <div class="info-content">
                            <div class="info-label">등록일</div>
                            <div class="info-value">${site.createdAt || '-'}</div>
                        </div>
                    </div>
                </div>
                
                ${site.memo ? `
                    <div class="sitemanage-detail-memo-card">
                        <h4><i class="fas fa-sticky-note"></i> 메모</h4>
                        <p>${escapeHtml(site.memo)}</p>
                    </div>
                ` : ''}
                
                <div class="sitemanage-warning">
                    <i class="fas fa-shield-alt"></i>
                    <span>보안을 위해 비밀번호는 이 앱에 저장하지 마세요.</span>
                </div>
            `;
            
            document.getElementById('sitemanageDetailModal').classList.add('active');
        }

        // 사이트 상세보기 닫기
        function closeSitemanageDetail() {
            document.getElementById('sitemanageDetailModal').classList.remove('active');
            currentSitemanageId = null;
        }

        // 사이트 폼 열기
        function openSitemanageForm(site = null) {
            const modal = document.getElementById('sitemanageFormModal');
            const titleEl = document.getElementById('sitemanageFormTitle');
            const submitBtn = document.getElementById('sitemanageSubmitBtn');
            
            // 폼 초기화
            document.getElementById('newSitemanageForm').reset();
            document.getElementById('editSitemanageId').value = '';
            
            if (site) {
                // 수정 모드
                titleEl.textContent = '사이트 정보 수정';
                submitBtn.textContent = '수정 완료';
                document.getElementById('editSitemanageId').value = site.id;
                document.getElementById('newSitemanageName').value = site.name || '';
                document.getElementById('newSitemanageUrl').value = site.url || '';
                document.getElementById('newSitemanageUserId').value = site.userId || '';
                document.getElementById('newSitemanageMemo').value = site.memo || '';
            } else {
                // 추가 모드
                titleEl.textContent = '새 사이트 추가';
                submitBtn.textContent = '사이트 추가하기';
            }
            
            modal.classList.add('active');
        }

        // 사이트 폼 닫기
        function closeSitemanageForm() {
            document.getElementById('sitemanageFormModal').classList.remove('active');
        }

        // 사이트 폼 제출
        function submitSitemanageForm(event) {
            event.preventDefault();
            
            const editId = document.getElementById('editSitemanageId').value;
            const siteData = {
                name: document.getElementById('newSitemanageName').value.trim(),
                url: document.getElementById('newSitemanageUrl').value.trim(),
                userId: document.getElementById('newSitemanageUserId').value.trim(),
                memo: document.getElementById('newSitemanageMemo').value.trim()
            };
            
            if (!data.sitemanages) data.sitemanages = [];
            
            if (editId) {
                // 수정
                const index = data.sitemanages.findIndex(s => s.id === parseInt(editId));
                if (index !== -1) {
                    data.sitemanages[index] = {
                        ...data.sitemanages[index],
                        ...siteData
                    };
                    showToast('사이트 정보가 수정되었습니다!');
                }
            } else {
                // 추가
                const site = {
                    id: Date.now(),
                    ...siteData,
                    createdAt: new Date().toLocaleDateString('ko-KR')
                };
                data.sitemanages.unshift(site);
                showToast('사이트가 추가되었습니다!');
            }
            
            saveData('sitemanages');
            renderSitemanageList();
            closeSitemanageForm();
            
            if (editId) {
                closeSitemanageDetail();
            }
        }

        // 현재 사이트 정보 수정
        function editCurrentSitemanage() {
            const site = data.sitemanages.find(s => s.id === currentSitemanageId);
            if (site) {
                openSitemanageForm(site);
            }
        }

        // 현재 사이트 삭제
        function deleteCurrentSitemanage() {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.sitemanages = data.sitemanages.filter(s => s.id !== currentSitemanageId);
                saveData('sitemanages');
                closeSitemanageDetail();
                renderSitemanageList();
                showToast('삭제되었습니다.');
            }
        }

        // ========== 일반 메모 전체화면 관련 함수들 ==========

        // 전체화면 메모 리스트 열기
        function openMemoFullscreen() {
            // 일반 메모 모드로 초기화
            currentCustomCategoryId = null;
            const modalHeader = document.querySelector('#memoFullscreenModal .memo-modal-header h2');
            modalHeader.innerHTML = `<i class="fas fa-sticky-note"></i> 일반 메모`;
            
            // 커스텀 테마 제거 (일반 메모는 기본 색상)
            const modal = document.getElementById('memoFullscreenModal');
            modal.className = modal.className.replace(/theme-color-\d+/g, '').replace('custom-themed', '').trim();
            
            modal.classList.add('active');
            renderMemoListByDate();
        }

        // 전체화면 메모 리스트 닫기
        function closeMemoFullscreen() {
            const modal = document.getElementById('memoFullscreenModal');
            modal.classList.remove('active');
            // 커스텀 테마 제거
            modal.className = modal.className.replace(/theme-color-\d+/g, '').replace('custom-themed', '').trim();
            currentCustomCategoryId = null;
        }

        // 메모 FAB 버튼 클릭 핸들러
        function handleMemoFabClick() {
            if (currentCustomCategoryId) {
                // 커스텀 카테고리인 경우 새 폼 열기
                openCustomMemoForm();
            } else {
                // 일반 메모인 경우 기존 폼 열기
                openMemoForm();
            }
        }

        // 메모 추가 폼 열기
        function openMemoForm(memo = null) {
            const modal = document.getElementById('memoFormModal');
            const titleEl = document.getElementById('memoFormTitle');
            const titleInput = document.getElementById('memoFormTitleInput');
            const contentInput = document.getElementById('memoFormContentInput');
            const imagePreviewContainer = document.getElementById('memoImagePreviewContainer');
            const imagePreview = document.getElementById('memoImagePreview');

            if (memo) {
                // 수정 모드
                isEditMode = true;
                currentMemoId = memo.id;
                titleEl.textContent = '메모 수정';
                titleInput.value = memo.title;
                contentInput.value = memo.content || '';
                
                // 기존 이미지가 있으면 표시
                if (memo.image) {
                    currentMemoImage = memo.image;
                    imagePreview.src = memo.image;
                    imagePreviewContainer.classList.add('active');
                } else {
                    currentMemoImage = null;
                    imagePreviewContainer.classList.remove('active');
                }
            } else {
                // 추가 모드
                isEditMode = false;
                currentMemoId = null;
                titleEl.textContent = '새 메모';
                titleInput.value = '';
                contentInput.value = '';
                currentMemoImage = null;
                imagePreviewContainer.classList.remove('active');
            }

            // 파일 input 초기화
            document.getElementById('memoImageInput').value = '';
            document.getElementById('memoCameraInput').value = '';

            modal.classList.add('active');
            titleInput.focus();
        }

        // 갤러리 버튼 클릭 핸들러 (메모 폼용)
        function handleGalleryClick() {
            // Flutter WebView 환경인지 확인
            if (isFlutterWebView()) {
                // 메모 폼임을 표시
                window.currentFormType = 'memo';
                window.currentImageTarget = 'memo';
                // Flutter 갤러리 요청 시도
                if (requestFlutterGallery()) {
                    return; // Flutter에서 처리
                }
            }
            // 일반 웹 또는 Flutter 실패시 기존 방식 사용
            document.getElementById('memoImageInput').click();
        }

        // 카메라 버튼 클릭 핸들러 (메모 폼용)
        function handleCameraClick() {
            // Flutter WebView 환경인지 확인
            if (isFlutterWebView()) {
                // 메모 폼임을 표시
                window.currentFormType = 'memo';
                window.currentImageTarget = 'memo';
                // Flutter 카메라 요청 시도
                if (requestFlutterCamera()) {
                    return; // Flutter에서 처리
                }
            }
            // 일반 웹 또는 Flutter 실패시 기존 방식 사용
            document.getElementById('memoCameraInput').click();
        }

        // 이미지 선택 핸들러 (갤러리/카메라 구분)
        let lastImageSource = 'gallery'; // 마지막 이미지 소스 추적
        
        function handleMemoImageSelect(event, source = 'gallery') {
            const file = event.target.files[0];
            if (file) {
                // 파일 크기 체크 (5MB 제한)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('이미지 크기는 5MB 이하로 선택해주세요.');
                    event.target.value = '';
                    return;
                }

                lastImageSource = source;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    // 이미지 리사이징 (너무 크면 성능 이슈)
                    resizeImage(e.target.result, 800, 800, function(resizedImage) {
                        currentMemoImage = resizedImage;
                        document.getElementById('memoImagePreview').src = resizedImage;
                        document.getElementById('memoImagePreviewContainer').classList.add('active');
                        
                        // 카메라로 찍은 사진이면 앨범에 저장 안내
                        if (source === 'camera') {
                            saveImageToAlbum(resizedImage);
                        }
                    });
                };
                reader.readAsDataURL(file);
            }
        }

        // 카메라 사진을 앨범에 저장하는 함수
        function saveImageToAlbum(dataUrl) {
            // 모바일에서 이미지를 다운로드하여 앨범에 저장
            try {
                // data URL을 Blob으로 변환
                const byteString = atob(dataUrl.split(',')[1]);
                const mimeString = dataUrl.split(',')[0].split(':')[1].split(';')[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                const blob = new Blob([ab], { type: mimeString });
                
                // 파일명 생성 (타임스탬프 기반)
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const filename = `memo_photo_${timestamp}.jpg`;
                
                // 다운로드 링크 생성
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                
                // iOS/Android에서 다운로드 트리거
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
                
                showToast('📸 사진이 앨범에 저장되었습니다');
            } catch (error) {
                console.error('사진 저장 오류:', error);
                showToast('사진 저장에 실패했습니다. 수동으로 저장해주세요.');
            }
        }

        // 이미지 리사이징 함수
        function resizeImage(dataUrl, maxWidth, maxHeight, callback) {
            const img = new Image();
            img.onload = function() {
                let width = img.width;
                let height = img.height;

                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width = width * ratio;
                    height = height * ratio;
                }

                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);

                callback(canvas.toDataURL('image/jpeg', 0.8));
            };
            img.src = dataUrl;
        }

        // 이미지 제거
        function removeMemoImage() {
            currentMemoImage = null;
            document.getElementById('memoImagePreview').src = '';
            document.getElementById('memoImagePreviewContainer').classList.remove('active');
            document.getElementById('memoImageInput').value = '';
        }

        // ========== 공통 폼 이미지 업로드 함수들 (여행, 맛집, 병원, 문화, 사람) ==========
        
        // 갤러리 버튼 클릭 핸들러
        function handleFormGalleryClick(formType) {
            // Flutter WebView 환경인지 확인
            if (isFlutterWebView()) {
                // Flutter 갤러리 요청 시 formType 저장
                window.currentFormType = formType;
                if (requestFlutterGalleryForForm && requestFlutterGalleryForForm(formType)) {
                    return;
                }
            }
            // 일반 웹 또는 Flutter 실패시 기존 방식 사용
            document.getElementById(formType + 'ImageInput').click();
        }

        // 카메라 버튼 클릭 핸들러
        function handleFormCameraClick(formType) {
            // Flutter WebView 환경인지 확인
            if (isFlutterWebView()) {
                window.currentFormType = formType;
                if (requestFlutterCameraForForm && requestFlutterCameraForForm(formType)) {
                    return;
                }
            }
            // 일반 웹 또는 Flutter 실패시 기존 방식 사용
            document.getElementById(formType + 'CameraInput').click();
        }

        // 폼 이미지 선택 핸들러
        function handleFormImageSelect(event, formType, source = 'gallery') {
            const file = event.target.files[0];
            if (file) {
                // 파일 크기 체크 (5MB 제한)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('이미지 크기는 5MB 이하로 선택해주세요.');
                    event.target.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    // 이미지 리사이징
                    resizeImage(e.target.result, 800, 800, function(resizedImage) {
                        currentFormImages[formType] = resizedImage;
                        document.getElementById(formType + 'ImagePreview').src = resizedImage;
                        document.getElementById(formType + 'ImagePreviewContainer').classList.add('active');
                        
                        // 카메라로 찍은 사진이면 앨범에 저장
                        if (source === 'camera') {
                            saveImageToAlbum(resizedImage);
                        }
                    });
                };
                reader.readAsDataURL(file);
            }
        }

        // 폼 이미지 제거
        function removeFormImage(formType) {
            currentFormImages[formType] = null;
            document.getElementById(formType + 'ImagePreview').src = '';
            document.getElementById(formType + 'ImagePreviewContainer').classList.remove('active');
            document.getElementById(formType + 'ImageInput').value = '';
            const cameraInput = document.getElementById(formType + 'CameraInput');
            if (cameraInput) cameraInput.value = '';
        }

        // 폼 이미지 초기화 (폼 열기/닫기 시 사용)
        function resetFormImage(formType) {
            currentFormImages[formType] = null;
            const previewContainer = document.getElementById(formType + 'ImagePreviewContainer');
            const preview = document.getElementById(formType + 'ImagePreview');
            const input = document.getElementById(formType + 'ImageInput');
            const cameraInput = document.getElementById(formType + 'CameraInput');
            
            if (previewContainer) previewContainer.classList.remove('active');
            if (preview) preview.src = '';
            if (input) input.value = '';
            if (cameraInput) cameraInput.value = '';
        }

        // 기존 이미지 로드 (수정 모드)
        function loadFormImage(formType, imageData) {
            if (imageData) {
                currentFormImages[formType] = imageData;
                document.getElementById(formType + 'ImagePreview').src = imageData;
                document.getElementById(formType + 'ImagePreviewContainer').classList.add('active');
            } else {
                resetFormImage(formType);
            }
        }

        // 메모 폼 닫기
        function closeMemoForm() {
            document.getElementById('memoFormModal').classList.remove('active');
            isEditMode = false;
            currentMemoId = null;
            currentMemoImage = null;
            document.getElementById('memoImagePreviewContainer').classList.remove('active');
        }

        // 메모 저장
        function saveMemoForm() {
            const title = document.getElementById('memoFormTitleInput').value.trim();
            const content = document.getElementById('memoFormContentInput').value.trim();

            if (!title) {
                showToast('제목을 입력해주세요');
                return;
            }

            const now = new Date();
            const dateStr = now.toLocaleDateString('ko-KR');
            const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

            // 커스텀 카테고리 메모인지 확인
            const isCustomCategory = currentCustomCategoryId !== null;
            const targetMemos = isCustomCategory ? data.customCategoryMemos[currentCustomCategoryId] : data.memos;

            if (isEditMode && currentMemoId) {
                // 수정
                const index = targetMemos.findIndex(m => m.id === currentMemoId);
                if (index !== -1) {
                    targetMemos[index].title = title;
                    targetMemos[index].content = content;
                    targetMemos[index].image = currentMemoImage;
                    targetMemos[index].updatedAt = dateStr;
                    targetMemos[index].updatedTime = timeStr;
                    showToast('메모가 수정되었습니다!');
                }
            } else {
                // 추가
                const memo = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    image: currentMemoImage,
                    createdAt: dateStr,
                    createdTime: timeStr
                };
                targetMemos.unshift(memo);
                showToast('메모가 추가되었습니다!');
            }

            // 저장 (Flutter WebView 호환성 강화 - 듀얼 스토리지)
            if (isCustomCategory) {
                try {
                    const jsonData = JSON.stringify(data.customCategoryMemos);
                    localStorage.setItem('customCategoryMemos', jsonData);
                    // 저장 확인
                    const saved = localStorage.getItem('customCategoryMemos');
                    if (!saved) {
                        console.warn('customCategoryMemos 저장 실패, 재시도...');
                        localStorage.setItem('customCategoryMemos', jsonData);
                    }
                    // IndexedDB에도 백업 저장
                    saveAllToIndexedDB();
                } catch (e) {
                    console.error('메모 저장 오류:', e);
                    // localStorage 실패 시 IndexedDB라도 저장
                    saveAllToIndexedDB();
                }
                renderCustomCategoryMemoList();
            } else {
                saveData('memos');
                renderMemoListByDate();
            }
            
            closeMemoForm();

            // 상세보기가 열려있으면 갱신
            if (document.getElementById('memoDetailModal').classList.contains('active') && currentMemoId) {
                const memo = targetMemos.find(m => m.id === currentMemoId);
                if (memo) showMemoDetail(memo);
            }
        }

        // 메모 상세보기 열기
        function showMemoDetail(memoRef) {
            // memoRef가 id만 가지고 있으면 data에서 찾아옴
            let memo;
            if (typeof memoRef.title !== 'undefined') {
                memo = memoRef;
            } else {
                // 커스텀 카테고리인지 확인
                if (currentCustomCategoryId !== null) {
                    memo = (data.customCategoryMemos[currentCustomCategoryId] || []).find(m => m.id === memoRef.id);
                } else {
                    memo = data.memos.find(m => m.id === memoRef.id);
                }
            }
            if (!memo) return;
            
            currentMemoId = memo.id;
            const dateText = memo.updatedAt 
                ? `${memo.createdAt} 작성 · ${memo.updatedAt} 수정` 
                : memo.createdAt + (memo.createdTime ? ` ${memo.createdTime}` : '');
            
            document.querySelector('#memoDetailDate span').textContent = dateText;
            document.getElementById('memoDetailTitle').textContent = memo.title;
            
            // 이미지 표시
            const detailContent = document.getElementById('memoDetailModal').querySelector('.memo-detail-content');
            const existingImg = detailContent.querySelector('.memo-detail-image');
            if (existingImg) {
                existingImg.remove();
            }
            
            if (memo.image) {
                const imgEl = document.createElement('img');
                imgEl.src = memo.image;
                imgEl.alt = '메모 이미지';
                imgEl.className = 'memo-detail-image';
                imgEl.onclick = function() {
                    openImageFullscreen(memo.image);
                };
                // 제목 앞에 삽입
                const titleEl = document.getElementById('memoDetailTitle');
                titleEl.parentNode.insertBefore(imgEl, titleEl);
            }
            
            document.getElementById('memoDetailBody').textContent = memo.content || '(내용 없음)';
            
            // 일반 메모일 때는 커스텀 테마 제거
            const detailModal = document.getElementById('memoDetailModal');
            detailModal.className = detailModal.className.replace(/theme-color-\d+/g, '').replace('custom-themed', '').trim();
            detailModal.classList.add('active');
        }

        // 이미지 전체화면 열기
        function openImageFullscreen(imageSrc) {
            document.getElementById('imageFullscreenImg').src = imageSrc;
            document.getElementById('imageFullscreenOverlay').classList.add('active');
        }
        
        // 이미지 전체화면 열기 (별칭)
        function openFullscreenImage(imageSrc) {
            openImageFullscreen(imageSrc);
        }

        // 이미지 전체화면 닫기
        function closeImageFullscreen() {
            document.getElementById('imageFullscreenOverlay').classList.remove('active');
        }

        // 메모 상세보기 닫기
        function closeMemoDetail() {
            const detailModal = document.getElementById('memoDetailModal');
            detailModal.classList.remove('active');
            // 커스텀 테마 제거
            detailModal.className = detailModal.className.replace(/theme-color-\d+/g, '').replace('custom-themed', '').trim();
            currentMemoId = null;
        }

        // 메모 상세 내용 복사
        function copyMemoDetail() {
            if (!currentMemoId) return;
            let memo;
            if (currentCustomCategoryId !== null) {
                memo = (data.customCategoryMemos[currentCustomCategoryId] || []).find(m => m.id === currentMemoId);
            } else {
                memo = data.memos.find(m => m.id === currentMemoId);
            }
            if (!memo) return;
            
            let copyText = '';
            if (memo.title) copyText += `제목: ${memo.title}\n`;
            if (memo.content) copyText += `내용: ${memo.content}\n`;
            if (memo.date) copyText += `날짜: ${formatDate(memo.date)}`;
            
            // 커스텀 카테고리 항목일 경우 추가 정보
            if (currentCustomCategoryId !== null && memo.fields) {
                const category = data.customCategories.find(c => c.id === currentCustomCategoryId);
                if (category) {
                    copyText = `[${category.name}]\n`;
                    Object.keys(memo.fields).forEach(key => {
                        if (memo.fields[key]) {
                            copyText += `${key}: ${memo.fields[key]}\n`;
                        }
                    });
                    if (memo.date) copyText += `날짜: ${formatDate(memo.date)}`;
                }
            }
            
            navigator.clipboard.writeText(copyText.trim()).then(() => {
                showToast('내용이 복사되었습니다!');
            }).catch(() => {
                showToast('복사에 실패했습니다.');
            });
        }

        // 메모 상세 내용 공유 (Share API)
        async function shareMemoDetail() {
            if (!currentMemoId) return;
            let memo;
            if (currentCustomCategoryId !== null) {
                memo = (data.customCategoryMemos[currentCustomCategoryId] || []).find(m => m.id === currentMemoId);
            } else {
                memo = data.memos.find(m => m.id === currentMemoId);
            }
            if (!memo) return;
            
            let shareTitle = memo.title || '메모';
            let shareText = '';
            
            if (memo.title) shareText += `제목: ${memo.title}\n`;
            if (memo.content) shareText += `내용: ${memo.content}\n`;
            if (memo.date) shareText += `날짜: ${formatDate(memo.date)}`;
            
            // 커스텀 카테고리 항목일 경우 추가 정보
            if (currentCustomCategoryId !== null && memo.fields) {
                const category = data.customCategories.find(c => c.id === currentCustomCategoryId);
                if (category) {
                    shareTitle = category.name;
                    shareText = `[${category.name}]\n`;
                    Object.keys(memo.fields).forEach(key => {
                        if (memo.fields[key]) {
                            shareText += `${key}: ${memo.fields[key]}\n`;
                        }
                    });
                    if (memo.date) shareText += `날짜: ${formatDate(memo.date)}`;
                }
            }
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: shareTitle,
                        text: shareText.trim()
                    });
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showToast('공유에 실패했습니다.');
                    }
                }
            } else {
                // Share API를 지원하지 않는 경우 클립보드에 복사
                navigator.clipboard.writeText(shareText.trim()).then(() => {
                    showToast('내용이 클립보드에 복사되었습니다!');
                }).catch(() => {
                    showToast('공유 기능을 지원하지 않습니다.');
                });
            }
        }

        // 현재 메모 수정
        function editCurrentMemo() {
            if (!currentMemoId) return;
            let memo;
            if (currentCustomCategoryId !== null) {
                memo = (data.customCategoryMemos[currentCustomCategoryId] || []).find(m => m.id === currentMemoId);
                if (memo) {
                    document.getElementById('memoDetailModal').classList.remove('active');
                    openCustomMemoForm(memo);
                }
            } else {
                memo = data.memos.find(m => m.id === currentMemoId);
                if (memo) {
                    closeMemoDetail();
                    openMemoForm(memo);
                }
            }
        }

        // 현재 메모 삭제
        function deleteCurrentMemo() {
            if (!currentMemoId) return;
            if (confirm('정말 삭제하시겠습니까?')) {
                if (currentCustomCategoryId !== null) {
                    data.customCategoryMemos[currentCustomCategoryId] = (data.customCategoryMemos[currentCustomCategoryId] || []).filter(m => m.id !== currentMemoId);
                    try {
                        const jsonData = JSON.stringify(data.customCategoryMemos);
                        localStorage.setItem('customCategoryMemos', jsonData);
                        // 저장 확인
                        if (!localStorage.getItem('customCategoryMemos')) {
                            localStorage.setItem('customCategoryMemos', jsonData);
                        }
                        // IndexedDB에도 백업 저장
                        saveAllToIndexedDB();
                    } catch (e) {
                        console.error('삭제 후 저장 오류:', e);
                        saveAllToIndexedDB();
                    }
                } else {
                    data.memos = data.memos.filter(m => m.id !== currentMemoId);
                    saveData('memos');
                }
                closeMemoDetail();
                if (currentCustomCategoryId !== null) {
                    renderCustomCategoryMemoList();
                } else {
                    renderMemoListByDate();
                }
                showToast('삭제되었습니다.');
            }
        }

        // 현재 메모 복사
        function copyCurrentMemo() {
            if (!currentMemoId) return;
            let memo;
            if (currentCustomCategoryId !== null) {
                memo = (data.customCategoryMemos[currentCustomCategoryId] || []).find(m => m.id === currentMemoId);
            } else {
                memo = data.memos.find(m => m.id === currentMemoId);
            }
            
            if (memo) {
                const textToCopy = `${memo.title}\n\n${memo.content || ''}`;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showToast('📋 클립보드에 복사되었습니다');
                    }).catch(err => {
                        fallbackCopyText(textToCopy);
                    });
                } else {
                    fallbackCopyText(textToCopy);
                }
            }
        }
        
        // 클립보드 복사 폴백 함수
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToast('📋 클립보드에 복사되었습니다');
            } catch (err) {
                showToast('복사에 실패했습니다');
            }
            
            document.body.removeChild(textArea);
        }

        // 현재 메모 공유
        async function shareCurrentMemo() {
            if (!currentMemoId) return;
            let memo;
            if (currentCustomCategoryId !== null) {
                memo = (data.customCategoryMemos[currentCustomCategoryId] || []).find(m => m.id === currentMemoId);
            } else {
                memo = data.memos.find(m => m.id === currentMemoId);
            }
            
            if (!memo) return;
            
            const shareTitle = memo.title;
            const shareText = memo.content || '';
            
            // 웹/앱 공유 실행 함수 (폴백으로 사용)
            const executeWebShare = async () => {
                // Web Share API 지원 확인
                if (navigator.share) {
                    try {
                        const shareData = {
                            title: shareTitle,
                            text: shareText
                        };
                        
                        // 이미지가 있고 파일 공유를 지원하면 이미지도 포함
                        if (memo.image && navigator.canShare) {
                            try {
                                // Base64를 Blob으로 변환
                                const response = await fetch(memo.image);
                                const blob = await response.blob();
                                const file = new File([blob], 'memo_image.jpg', { type: 'image/jpeg' });
                                
                                const shareDataWithFile = {
                                    title: shareTitle,
                                    text: shareText,
                                    files: [file]
                                };
                                
                                if (navigator.canShare(shareDataWithFile)) {
                                    await navigator.share(shareDataWithFile);
                                    showToast('🔗 공유되었습니다');
                                    return;
                                }
                            } catch (fileError) {
                                console.log('파일 공유 실패, 텍스트만 공유합니다:', fileError);
                            }
                        }
                        
                        // 이미지 없이 공유
                        await navigator.share(shareData);
                        showToast('🔗 공유되었습니다');
                    } catch (err) {
                        if (err.name !== 'AbortError') {
                            console.error('공유 오류:', err);
                            showShareFallback(memo);
                        }
                    }
                } else {
                    // Web Share API 미지원 시 폴백
                    showShareFallback(memo);
                }
            };
            
            // Flutter WebView 환경인지 확인하고 우선 처리
            if (isFlutterWebView()) {
                // Flutter 공유 요청 시도 (실패/타임아웃 시 웹 공유로 폴백)
                if (requestFlutterShare(shareTitle, shareText, memo.image || null, executeWebShare)) {
                    return; // Flutter에서 처리 대기
                }
            }
            
            // Flutter WebView가 아니거나 Flutter 채널이 없으면 웹 공유 실행
            await executeWebShare();
        }
        
        // 공유 폴백 (공유 모달 표시)
        function showShareFallback(memo) {
            const textToShare = `📝 ${memo.title}\n\n${memo.content || ''}`;
            
            // 앱 환경에서 커스텀 공유 모달 표시
            showShareModal(memo.title, memo.content || '', textToShare);
        }
        
        // 공유 모달 표시
        function showShareModal(title, content, fullText) {
            // 기존 모달 제거
            const existingModal = document.getElementById('shareModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modalHTML = `
                <div class="share-modal-overlay" id="shareModal">
                    <div class="share-modal">
                        <div class="share-modal-header">
                            <h3><i class="fas fa-share-alt"></i> 공유하기</h3>
                            <button class="share-modal-close" onclick="closeShareModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="share-modal-body">
                            <div class="share-preview">
                                <h4>${title}</h4>
                                <p>${content ? content.substring(0, 100) + (content.length > 100 ? '...' : '') : ''}</p>
                            </div>
                            <div class="share-options">
                                <button class="share-option-btn" onclick="shareViaClipboard()">
                                    <i class="fas fa-copy"></i>
                                    <span>클립보드 복사</span>
                                </button>
                                <button class="share-option-btn" onclick="shareViaKakao()">
                                    <i class="fas fa-comment"></i>
                                    <span>카카오톡</span>
                                </button>
                                <button class="share-option-btn" onclick="shareViaSMS()">
                                    <i class="fas fa-sms"></i>
                                    <span>문자 메시지</span>
                                </button>
                                <button class="share-option-btn" onclick="shareViaEmail()">
                                    <i class="fas fa-envelope"></i>
                                    <span>이메일</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // 공유 데이터 저장
            window.currentShareData = { title, content, fullText };
            
            // 모달 표시 애니메이션
            setTimeout(() => {
                document.getElementById('shareModal').classList.add('active');
            }, 10);
        }
        
        // 공유 모달 닫기
        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        // 클립보드로 공유
        function shareViaClipboard() {
            const data = window.currentShareData;
            if (!data) return;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(data.fullText).then(() => {
                    showToast('📋 클립보드에 복사되었습니다');
                    closeShareModal();
                }).catch(() => {
                    fallbackCopyText(data.fullText);
                    closeShareModal();
                });
            } else {
                fallbackCopyText(data.fullText);
                closeShareModal();
            }
        }
        
        // 카카오톡으로 공유 (URL scheme 사용)
        function shareViaKakao() {
            const data = window.currentShareData;
            if (!data) return;
            
            const text = encodeURIComponent(data.fullText);
            
            // 카카오톡 URL scheme 시도
            const kakaoUrl = `kakaotalk://msg/text?text=${text}`;
            
            // 새 창/탭으로 열기 시도
            const opened = window.open(kakaoUrl, '_blank');
            
            // URL scheme이 작동하지 않으면 클립보드 복사로 폴백
            setTimeout(() => {
                if (!opened || opened.closed) {
                    showToast('📋 내용이 복사되었습니다. 카카오톡에서 붙여넣기하세요');
                    shareViaClipboard();
                }
            }, 1000);
            
            closeShareModal();
        }
        
        // 문자 메시지로 공유
        function shareViaSMS() {
            const data = window.currentShareData;
            if (!data) return;
            
            const text = encodeURIComponent(data.fullText);
            
            // SMS URL scheme (iOS/Android 호환)
            const smsUrl = /iPhone|iPad|iPod/i.test(navigator.userAgent) 
                ? `sms:&body=${text}` 
                : `sms:?body=${text}`;
            
            window.location.href = smsUrl;
            closeShareModal();
        }
        
        // 이메일로 공유
        function shareViaEmail() {
            const data = window.currentShareData;
            if (!data) return;
            
            const subject = encodeURIComponent(data.title);
            const body = encodeURIComponent(data.fullText);
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            closeShareModal();
        }

        // 날짜별로 그룹화하여 메모 리스트 렌더링
        function renderMemoListByDate() {
            const container = document.getElementById('memoListContainer');

            if (data.memos.length === 0) {
                container.innerHTML = `
                    <div class="memo-empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <p>아직 등록된 메모가 없습니다.<br>+ 버튼을 눌러 새 메모를 추가해보세요!</p>
                    </div>
                `;
                return;
            }

            // 날짜별 그룹화
            const groupedMemos = {};
            data.memos.forEach(memo => {
                const date = memo.createdAt || '날짜 없음';
                if (!groupedMemos[date]) {
                    groupedMemos[date] = [];
                }
                groupedMemos[date].push(memo);
            });

            // 날짜 정렬 (최신순)
            const sortedDates = Object.keys(groupedMemos).sort((a, b) => {
                if (a === '날짜 없음') return 1;
                if (b === '날짜 없음') return -1;
                return new Date(b.replace(/\./g, '/')) - new Date(a.replace(/\./g, '/'));
            });

            let html = '';
            sortedDates.forEach(date => {
                const memos = groupedMemos[date];
                const count = memos.length;
                const isToday = date === new Date().toLocaleDateString('ko-KR');
                const displayDate = isToday ? '오늘' : date;

                html += `
                    <div class="date-group">
                        <div class="date-group-header">
                            <div class="date-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="date-info">
                                <div class="date-text">${displayDate}</div>
                                <div class="date-count">${count}개의 메모</div>
                            </div>
                        </div>
                `;

                memos.forEach(memo => {
                    const preview = memo.content ? memo.content.substring(0, 100) : '(내용 없음)';
                    const time = memo.createdTime || '';
                    const hasImage = memo.image ? true : false;
                    html += `
                        <div class="memo-list-item" onclick="showMemoDetail(${JSON.stringify({id: memo.id}).replace(/"/g, '&quot;')})">
                            ${hasImage ? `<img src="${memo.image}" alt="메모 이미지" class="memo-list-item-image">` : ''}
                            <h4>${escapeHtml(memo.title)}</h4>
                            <div class="memo-preview">${escapeHtml(preview)}</div>
                            ${time ? `<div class="memo-time"><i class="fas fa-clock"></i> ${time}${hasImage ? ' · <i class="fas fa-image"></i>' : ''}</div>` : ''}
                        </div>
                    `;
                });

                html += '</div>';
            });

            container.innerHTML = html;
        }

        // HTML 이스케이프
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 모달 외부 클릭시 닫기
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // 토스트 메시지
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }

        // 여행 추가
        function addTravel(e) {
            e.preventDefault();
            const travel = {
                id: Date.now(),
                destination: document.getElementById('travelDestination').value,
                period: document.getElementById('travelPeriod').value,
                budget: document.getElementById('travelBudget').value,
                memo: document.getElementById('travelMemo').value,
                status: document.getElementById('travelStatus').value,
                createdAt: new Date().toLocaleDateString('ko-KR')
            };
            
            data.travels.unshift(travel);
            saveData('travels');
            renderList('travel');
            document.getElementById('travelForm').reset();
            showToast('여행이 추가되었습니다!');
        }

        // 맛집 추가
        function addRestaurant(e) {
            e.preventDefault();
            const rating = document.querySelector('input[name="rating"]:checked')?.value || 3;
            const restaurant = {
                id: Date.now(),
                name: document.getElementById('restaurantName').value,
                location: document.getElementById('restaurantLocation').value,
                category: document.getElementById('restaurantCategory').value,
                rating: parseInt(rating),
                menu: document.getElementById('restaurantMenu').value,
                memo: document.getElementById('restaurantMemo').value,
                createdAt: new Date().toLocaleDateString('ko-KR')
            };
            
            data.restaurants.unshift(restaurant);
            saveData('restaurants');
            renderList('restaurant');
            document.getElementById('restaurantForm').reset();
            showToast('맛집이 추가되었습니다!');
        }

        // 메모 추가 (이전 호환성 유지 - 사용하지 않음)
        function addMemo(e) {
            e.preventDefault();
        }

        // 데이터 저장 (Flutter WebView 호환성 강화 - 듀얼 스토리지)
        function saveData(key) {
            try {
                const jsonData = JSON.stringify(data[key]);
                
                // 1. localStorage에 저장
                localStorage.setItem(key, jsonData);
                
                // 2. 저장 확인 및 재시도
                const saved = localStorage.getItem(key);
                if (!saved || saved !== jsonData) {
                    console.warn('localStorage 저장 확인 실패, 재시도 중...');
                    localStorage.setItem(key, jsonData);
                }
                
                // 3. IndexedDB에도 백업 저장 (비동기)
                saveAllToIndexedDB();
                
                // 4. Flutter 앱에 알림 (가능한 경우)
                sendToFlutter('dataChanged', { key: key });
                
            } catch (e) {
                console.error('데이터 저장 오류:', e);
                // localStorage 실패 시 IndexedDB만이라도 저장
                saveAllToIndexedDB();
                showToast('저장 중 오류가 발생했습니다.');
            }
        }

        // 모든 데이터 저장 (앱 백그라운드/종료 시 - 듀얼 스토리지)
        function saveAllData() {
            try {
                // 1. localStorage에 저장
                localStorage.setItem('travels', JSON.stringify(data.travels));
                localStorage.setItem('restaurants', JSON.stringify(data.restaurants));
                localStorage.setItem('cultures', JSON.stringify(data.cultures || []));
                localStorage.setItem('people', JSON.stringify(data.people || []));
                localStorage.setItem('memos', JSON.stringify(data.memos));
                localStorage.setItem('customCategories', JSON.stringify(data.customCategories));
                localStorage.setItem('customCategoryMemos', JSON.stringify(data.customCategoryMemos));
                localStorage.setItem('todos', JSON.stringify(data.todos));
                localStorage.setItem('todoHistory', JSON.stringify(data.todoHistory));
                localStorage.setItem('lastTodoDate', data.lastTodoDate);
                localStorage.setItem('schedules', JSON.stringify(data.schedules || []));
                console.log('localStorage에 모든 데이터 저장 완료');
            } catch (e) {
                console.error('localStorage 저장 오류:', e);
            }

            // 2. IndexedDB에도 백업 저장 (비동기)
            try {
                saveAllToIndexedDB();
            } catch (e) {
                console.error('IndexedDB 저장 오류:', e);
            }
            
            // 3. Flutter 앱에 알림 (가능한 경우)
            sendToFlutter('allDataSaved', { timestamp: Date.now() });
        }

        // 삭제 함수들
        function deleteTravel(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.travels = data.travels.filter(item => item.id !== id);
                saveData('travels');
                renderList('travel');
                showToast('삭제되었습니다.');
            }
        }

        function deleteRestaurant(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.restaurants = data.restaurants.filter(item => item.id !== id);
                saveData('restaurants');
                renderList('restaurant');
                showToast('삭제되었습니다.');
            }
        }

        function deleteMemo(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                data.memos = data.memos.filter(item => item.id !== id);
                saveData('memos');
                renderMemoListByDate();
                showToast('삭제되었습니다.');
            }
        }

        // 별점 표시
        function getStars(rating) {
            return '<span class="rating">' + '★'.repeat(rating) + '☆'.repeat(5 - rating) + '</span>';
        }

        // 리스트 렌더링
        function renderList(type) {
            if (type === 'travel') {
                const listEl = document.getElementById('travelList');
                if (data.travels.length === 0) {
                    listEl.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-plane"></i>
                            <p>아직 등록된 여행이 없습니다.<br>새로운 여행을 추가해보세요!</p>
                        </div>
                    `;
                } else {
                    listEl.innerHTML = data.travels.map(travel => `
                        <div class="item-card">
                            <div class="item-actions">
                                <button class="delete-btn" onclick="deleteTravel(${travel.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <h3><i class="fas fa-map-marker-alt" style="color: #fa709a;"></i> ${travel.destination}</h3>
                            ${travel.period ? `<p><i class="fas fa-calendar"></i> ${travel.period}</p>` : ''}
                            ${travel.budget ? `<p><i class="fas fa-wallet"></i> ${travel.budget}</p>` : ''}
                            ${travel.memo ? `<p>${travel.memo}</p>` : ''}
                            <div class="meta">
                                <span class="tag date-tag">${travel.status}</span>
                                <span class="tag">${travel.createdAt}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } else if (type === 'restaurant') {
                const listEl = document.getElementById('restaurantList');
                if (data.restaurants.length === 0) {
                    listEl.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-utensils"></i>
                            <p>아직 등록된 맛집이 없습니다.<br>좋아하는 맛집을 추가해보세요!</p>
                        </div>
                    `;
                } else {
                    listEl.innerHTML = data.restaurants.map(restaurant => `
                        <div class="item-card">
                            <div class="item-actions">
                                <button class="delete-btn" onclick="deleteRestaurant(${restaurant.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <h3><i class="fas fa-store" style="color: #ff4e50;"></i> ${restaurant.name}</h3>
                            ${restaurant.location ? `<p><i class="fas fa-map-marker-alt"></i> ${restaurant.location}</p>` : ''}
                            <p>${getStars(restaurant.rating)}</p>
                            ${restaurant.menu ? `<p><i class="fas fa-utensils"></i> 추천: ${restaurant.menu}</p>` : ''}
                            ${restaurant.memo ? `<p>${restaurant.memo}</p>` : ''}
                            <div class="meta">
                                <span class="tag" style="background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%); color: white;">${restaurant.category}</span>
                                <span class="tag">${restaurant.createdAt}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } else if (type === 'memo') {
                // 메모는 전체화면 모달에서 처리
                renderMemoListByDate();
            }
        }

        // ========== 카테고리 추가 관련 함수들 ==========

        // 카테고리 모달 열기
        function openCategoryModal() {
            document.getElementById('categoryModal').classList.add('active');
            renderIconSelector();
            renderColorSelector();
            resetCategoryForm();
        }

        // 카테고리 모달 닫기
        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        // 카테고리 폼 초기화
        function resetCategoryForm() {
            document.getElementById('categoryNameInput').value = '';
            selectedIcon = 'fa-star';
            selectedColor = 1;
            updateCategoryPreview();
            updateIconSelection();
            updateColorSelection();
            resetFieldSettings();
        }

        // 아이콘 선택기 렌더링
        function renderIconSelector() {
            const grid = document.getElementById('iconSelectorGrid');
            grid.innerHTML = availableIcons.map(icon => `
                <div class="icon-option ${icon === selectedIcon ? 'selected' : ''}" 
                     onclick="selectIcon('${icon}')" data-icon="${icon}">
                    <i class="fas ${icon}"></i>
                </div>
            `).join('');
        }

        // 색상 선택기 렌더링
        function renderColorSelector() {
            const grid = document.getElementById('colorSelectorGrid');
            grid.innerHTML = availableColors.map(color => `
                <div class="color-option ${color.id === selectedColor ? 'selected' : ''}" 
                     style="background: ${color.gradient}" 
                     onclick="selectColor(${color.id})" data-color="${color.id}">
                </div>
            `).join('');
        }

        // 아이콘 선택
        function selectIcon(icon) {
            selectedIcon = icon;
            updateIconSelection();
            updateCategoryPreview();
        }

        // 색상 선택
        function selectColor(colorId) {
            selectedColor = colorId;
            updateColorSelection();
            updateCategoryPreview();
        }

        // 아이콘 선택 상태 업데이트
        function updateIconSelection() {
            document.querySelectorAll('.icon-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.icon === selectedIcon);
            });
        }

        // 색상 선택 상태 업데이트
        function updateColorSelection() {
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.toggle('selected', parseInt(el.dataset.color) === selectedColor);
            });
        }

        // 미리보기 업데이트
        function updateCategoryPreview() {
            const name = document.getElementById('categoryNameInput').value.trim() || '새 메뉴';
            const previewIcon = document.getElementById('categoryPreviewIcon');
            const previewIconEl = document.getElementById('categoryPreviewIconEl');
            const previewName = document.getElementById('categoryPreviewName');

            // 색상 클래스 업데이트
            previewIcon.className = 'category-preview-icon custom-gradient-' + selectedColor;
            
            // 아이콘 업데이트
            previewIconEl.className = 'fas ' + selectedIcon;
            
            // 이름 업데이트
            previewName.textContent = name;
        }

        // 항목 설정 토글
        function toggleFieldSetting(fieldNum) {
            const checkbox = document.getElementById(`field${fieldNum}Enabled`);
            const details = document.getElementById(`field${fieldNum}Details`);
            
            if (details) {
                details.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        // 필드 설정 수집
        function collectFieldSettings() {
            const fields = [];
            
            // 항목1: 필수 (이름/제목)
            fields.push({
                id: 1,
                enabled: true,
                type: 'text',
                name: document.getElementById('field1Name').value.trim() || '이름/제목',
                required: true
            });
            
            // 항목2: 카테고리 선택
            if (document.getElementById('field2Enabled').checked) {
                const optionsStr = document.getElementById('field2Options').value.trim();
                const options = optionsStr ? optionsStr.split(',').map(o => o.trim()).filter(o => o) : [];
                fields.push({
                    id: 2,
                    enabled: true,
                    type: 'select',
                    name: document.getElementById('field2Name').value.trim() || '카테고리',
                    options: options.length > 0 ? options : ['옵션1', '옵션2', '옵션3']
                });
            }
            
            // 항목3: 날짜 선택
            if (document.getElementById('field3Enabled').checked) {
                fields.push({
                    id: 3,
                    enabled: true,
                    type: 'date',
                    name: document.getElementById('field3Name').value.trim() || '날짜'
                });
            }
            
            // 항목4: 이름/제목 (추가)
            if (document.getElementById('field4Enabled').checked) {
                fields.push({
                    id: 4,
                    enabled: true,
                    type: 'text',
                    name: document.getElementById('field4Name').value.trim() || '부제목'
                });
            }
            
            // 항목5: 특이사항
            if (document.getElementById('field5Enabled').checked) {
                fields.push({
                    id: 5,
                    enabled: true,
                    type: 'textarea',
                    name: document.getElementById('field5Name').value.trim() || '특이사항'
                });
            }
            
            // 항목6: 이름/제목 (추가2)
            if (document.getElementById('field6Enabled').checked) {
                fields.push({
                    id: 6,
                    enabled: true,
                    type: 'text',
                    name: document.getElementById('field6Name').value.trim() || '추가제목'
                });
            }
            
            // 항목7: 갤러리 사용 (이미지)
            if (document.getElementById('field7Enabled').checked) {
                fields.push({
                    id: 7,
                    enabled: true,
                    type: 'image',
                    name: document.getElementById('field7Name').value.trim() || '사진'
                });
            }
            
            return fields;
        }

        // 필드 설정 초기화
        function resetFieldSettings() {
            // 체크박스 초기화
            document.getElementById('field1Enabled').checked = true;
            document.getElementById('field2Enabled').checked = false;
            document.getElementById('field3Enabled').checked = false;
            document.getElementById('field4Enabled').checked = false;
            document.getElementById('field5Enabled').checked = false;
            document.getElementById('field6Enabled').checked = false;
            document.getElementById('field7Enabled').checked = false;
            
            // 이름 초기화
            document.getElementById('field1Name').value = '이름/제목';
            document.getElementById('field2Name').value = '카테고리';
            document.getElementById('field2Options').value = '';
            document.getElementById('field3Name').value = '날짜';
            document.getElementById('field4Name').value = '부제목';
            document.getElementById('field5Name').value = '특이사항';
            document.getElementById('field6Name').value = '추가제목';
            document.getElementById('field7Name').value = '사진';
            
            // 상세설정 숨기기
            for (let i = 2; i <= 7; i++) {
                const details = document.getElementById(`field${i}Details`);
                if (details) details.style.display = 'none';
            }
        }

        // 커스텀 카테고리 추가
        function addCustomCategory() {
            const name = document.getElementById('categoryNameInput').value.trim();
            
            if (!name) {
                showToast('메뉴 이름을 입력해주세요');
                return;
            }

            if (name.length > 10) {
                showToast('이름은 10자 이하로 입력해주세요');
                return;
            }

            // 필드 설정 수집
            const fieldSettings = collectFieldSettings();

            const category = {
                id: Date.now(),
                name: name,
                icon: selectedIcon,
                colorId: selectedColor,
                createdAt: new Date().toLocaleDateString('ko-KR'),
                fields: fieldSettings
            };

            data.customCategories.push(category);
            data.customCategoryMemos[category.id] = [];
            
            localStorage.setItem('customCategories', JSON.stringify(data.customCategories));
            localStorage.setItem('customCategoryMemos', JSON.stringify(data.customCategoryMemos));
            // IndexedDB에도 백업 저장
            saveAllToIndexedDB();

            renderCustomCategories();
            closeCategoryModal();
            showToast(`'${name}' 메뉴가 추가되었습니다!`);
        }

        // 커스텀 카테고리 렌더링
        function renderCustomCategories() {
            const container = document.getElementById('customCategoriesContainer');
            
            if (data.customCategories.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = data.customCategories.map(cat => `
                <div class="grid-item custom-category-wrapper" data-category-id="${cat.id}">
                    <button class="custom-category-delete" onclick="event.stopPropagation(); deleteCustomCategory(${cat.id})">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="icon-box custom-gradient-${cat.colorId}" onclick="openCustomCategoryMemos(${cat.id})">
                        <i class="fas ${cat.icon}"></i>
                    </div>
                    <span onclick="openCustomCategoryMemos(${cat.id})">${escapeHtml(cat.name)}</span>
                </div>
            `).join('');
        }

        // 커스텀 카테고리 삭제
        function deleteCustomCategory(id) {
            const category = data.customCategories.find(c => c.id === id);
            if (!category) return;

            if (confirm(`'${category.name}' 메뉴를 삭제하시겠습니까?\n(해당 메뉴의 메모도 모두 삭제됩니다)`)) {
                data.customCategories = data.customCategories.filter(c => c.id !== id);
                delete data.customCategoryMemos[id];
                
                localStorage.setItem('customCategories', JSON.stringify(data.customCategories));
                localStorage.setItem('customCategoryMemos', JSON.stringify(data.customCategoryMemos));
                // IndexedDB에도 백업 저장
                saveAllToIndexedDB();

                renderCustomCategories();
                showToast('메뉴가 삭제되었습니다.');
            }
        }

        // 커스텀 카테고리 메모 열기
        function openCustomCategoryMemos(categoryId) {
            const category = data.customCategories.find(c => c.id === categoryId);
            if (!category) return;

            currentCustomCategoryId = categoryId;
            
            // 모달 헤더 업데이트
            const modalHeader = document.querySelector('#memoFullscreenModal .memo-modal-header h2');
            modalHeader.innerHTML = `<i class="fas ${category.icon}"></i> ${escapeHtml(category.name)}`;
            
            // 테마 색상 적용 (아이콘 색상과 동기화)
            const modal = document.getElementById('memoFullscreenModal');
            // 기존 theme-color 클래스 제거
            modal.className = modal.className.replace(/theme-color-\d+/g, '').replace('custom-themed', '').trim();
            modal.classList.add('custom-themed', 'theme-color-' + category.colorId);
            
            // 모달 열기
            modal.classList.add('active');
            
            // 해당 카테고리 메모 렌더링
            renderCustomCategoryMemoList();
        }

        // 커스텀 카테고리 메모 리스트 렌더링
        function renderCustomCategoryMemoList() {
            const container = document.getElementById('memoListContainer');
            const category = data.customCategories.find(c => c.id === currentCustomCategoryId);
            const memos = data.customCategoryMemos[currentCustomCategoryId] || [];

            if (memos.length === 0) {
                container.innerHTML = `
                    <div class="memo-empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <p>아직 등록된 항목이 없습니다.<br>+ 버튼을 눌러 새 항목을 추가해보세요!</p>
                    </div>
                `;
                return;
            }

            // 날짜별 그룹화
            const groupedMemos = {};
            memos.forEach(memo => {
                const date = memo.createdAt || '날짜 없음';
                if (!groupedMemos[date]) {
                    groupedMemos[date] = [];
                }
                groupedMemos[date].push(memo);
            });

            // 날짜 정렬 (최신순)
            const sortedDates = Object.keys(groupedMemos).sort((a, b) => {
                if (a === '날짜 없음') return 1;
                if (b === '날짜 없음') return -1;
                return new Date(b.replace(/\./g, '/')) - new Date(a.replace(/\./g, '/'));
            });

            let html = '';
            sortedDates.forEach(date => {
                const memoList = groupedMemos[date];
                const count = memoList.length;
                const isToday = date === new Date().toLocaleDateString('ko-KR');
                const displayDate = isToday ? '오늘' : date;

                html += `
                    <div class="date-group">
                        <div class="date-group-header">
                            <div class="date-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="date-info">
                                <div class="date-text">${displayDate}</div>
                                <div class="date-count">${count}개의 항목</div>
                            </div>
                        </div>
                `;

                memoList.forEach(memo => {
                    // 필드 기반 미리보기 생성
                    let previewItems = [];
                    if (category && category.fields) {
                        category.fields.forEach(field => {
                            if (field.id > 1 && memo[`field${field.id}`]) {
                                previewItems.push(`${field.name}: ${memo[`field${field.id}`]}`);
                            }
                        });
                    }
                    const preview = previewItems.length > 0 ? previewItems.join(' | ') : (memo.content ? memo.content.substring(0, 100) : '');
                    const time = memo.createdTime || '';
                    
                    // title은 field1 값으로 표시
                    const displayTitle = memo.field1 || memo.title || '(제목 없음)';
                    
                    html += `
                        <div class="memo-list-item" onclick="showCustomMemoDetail(${memo.id})">
                            <h4>${escapeHtml(displayTitle)}</h4>
                            ${preview ? `<div class="memo-preview">${escapeHtml(preview)}</div>` : ''}
                            ${time ? `<div class="memo-time"><i class="fas fa-clock"></i> ${time}</div>` : ''}
                        </div>
                    `;
                });

                html += '</div>';
            });

            container.innerHTML = html;
        }

        // ========== 커스텀 메모 폼 관련 함수 ==========
        
        let customMemoEditId = null;

        // 커스텀 메모 폼 열기
        function openCustomMemoForm(memo = null) {
            const category = data.customCategories.find(c => c.id === currentCustomCategoryId);
            if (!category) return;

            const modal = document.getElementById('customMemoFormModal');
            const titleEl = document.getElementById('customMemoFormTitle');
            const bodyEl = document.getElementById('customMemoFormBody');
            
            // 테마 색상 적용
            modal.className = `custom-memo-form-modal theme-color-${category.colorId}`;
            
            // 헤더 업데이트
            titleEl.innerHTML = `<i class="fas ${category.icon}"></i> ${memo ? '항목 수정' : '새 항목'}`;
            
            // 폼 필드 생성
            let formHtml = '';
            const fields = category.fields || [{id: 1, enabled: true, type: 'text', name: '이름/제목', required: true}];
            
            fields.forEach(field => {
                if (!field.enabled) return;
                
                const value = memo ? (memo[`field${field.id}`] || '') : '';
                const requiredMark = field.required ? '<span class="required-mark">*</span>' : '';
                const requiredAttr = field.required ? 'required' : '';
                
                formHtml += `<div class="custom-form-group">`;
                formHtml += `<label>${escapeHtml(field.name)}${requiredMark}</label>`;
                
                switch (field.type) {
                    case 'select':
                        formHtml += `<select id="customField${field.id}" class="custom-form-select" ${requiredAttr}>`;
                        formHtml += `<option value="">선택하세요</option>`;
                        (field.options || []).forEach(opt => {
                            const selected = value === opt ? 'selected' : '';
                            formHtml += `<option value="${escapeHtml(opt)}" ${selected}>${escapeHtml(opt)}</option>`;
                        });
                        formHtml += `</select>`;
                        break;
                    case 'date':
                        formHtml += `<input type="date" id="customField${field.id}" class="custom-form-input" value="${escapeHtml(value)}" ${requiredAttr}>`;
                        break;
                    case 'textarea':
                        formHtml += `<textarea id="customField${field.id}" class="custom-form-textarea" placeholder="${escapeHtml(field.name)}을(를) 입력하세요" ${requiredAttr}>${escapeHtml(value)}</textarea>`;
                        break;
                    case 'image':
                        formHtml += `<div class="custom-form-image-section">`;
                        formHtml += `<input type="file" id="customField${field.id}Input" accept="image/*" style="display: none;" onchange="handleCustomImageSelect(event, ${field.id})">`;
                        formHtml += `<input type="hidden" id="customField${field.id}" value="${escapeHtml(value)}">`;
                        formHtml += `<div class="custom-form-image-buttons">`;
                        formHtml += `<label class="custom-form-image-btn" onclick="document.getElementById('customField${field.id}Input').click()">`;
                        formHtml += `<i class="fas fa-image"></i><span>갤러리</span>`;
                        formHtml += `</label>`;
                        formHtml += `</div>`;
                        formHtml += `<div class="custom-form-image-preview-container" id="customImagePreviewContainer${field.id}" style="${value ? 'display: block;' : 'display: none;'}">`;
                        formHtml += `<img src="${value || ''}" alt="미리보기" class="custom-form-image-preview" id="customImagePreview${field.id}">`;
                        formHtml += `<button type="button" class="custom-form-image-remove-btn" onclick="removeCustomImage(${field.id})"><i class="fas fa-times"></i></button>`;
                        formHtml += `</div>`;
                        formHtml += `</div>`;
                        break;
                    default: // text
                        formHtml += `<input type="text" id="customField${field.id}" class="custom-form-input" placeholder="${escapeHtml(field.name)}을(를) 입력하세요" value="${escapeHtml(value)}" ${requiredAttr}>`;
                }
                
                formHtml += `</div>`;
            });
            
            bodyEl.innerHTML = formHtml;
            
            // 수정 모드 설정
            customMemoEditId = memo ? memo.id : null;
            
            modal.classList.add('active');
            
            // 첫 번째 입력 필드에 포커스
            const firstInput = bodyEl.querySelector('input, select, textarea');
            if (firstInput) firstInput.focus();
        }

        // 커스텀 메모 폼 닫기
        function closeCustomMemoForm() {
            document.getElementById('customMemoFormModal').classList.remove('active');
            customMemoEditId = null;
        }

        // 커스텀 이미지 선택 처리
        function handleCustomImageSelect(event, fieldId) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                showToast('이미지 크기는 10MB 이하여야 합니다.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                document.getElementById(`customField${fieldId}`).value = imageData;
                document.getElementById(`customImagePreview${fieldId}`).src = imageData;
                document.getElementById(`customImagePreviewContainer${fieldId}`).style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // 커스텀 이미지 제거
        function removeCustomImage(fieldId) {
            document.getElementById(`customField${fieldId}`).value = '';
            document.getElementById(`customImagePreview${fieldId}`).src = '';
            document.getElementById(`customImagePreviewContainer${fieldId}`).style.display = 'none';
            document.getElementById(`customField${fieldId}Input`).value = '';
        }

        // 커스텀 메모 저장
        function saveCustomMemoForm() {
            const category = data.customCategories.find(c => c.id === currentCustomCategoryId);
            if (!category) return;

            const fields = category.fields || [{id: 1, enabled: true, type: 'text', name: '이름/제목', required: true}];
            
            // 데이터 수집
            const memoData = {};
            for (const field of fields) {
                if (!field.enabled) continue;
                
                const input = document.getElementById(`customField${field.id}`);
                if (!input) continue;
                
                const value = input.value.trim();
                
                // 필수 필드 검증
                if (field.required && !value) {
                    showToast(`${field.name}을(를) 입력해주세요`);
                    input.focus();
                    return;
                }
                
                memoData[`field${field.id}`] = value;
            }
            
            const now = new Date();
            
            if (customMemoEditId) {
                // 수정 모드
                const memos = data.customCategoryMemos[currentCustomCategoryId] || [];
                const memoIndex = memos.findIndex(m => m.id === customMemoEditId);
                if (memoIndex !== -1) {
                    Object.assign(memos[memoIndex], memoData);
                    memos[memoIndex].updatedAt = now.toLocaleDateString('ko-KR');
                    memos[memoIndex].updatedTime = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                }
                showToast('항목이 수정되었습니다');
            } else {
                // 추가 모드
                const newMemo = {
                    id: Date.now(),
                    ...memoData,
                    createdAt: now.toLocaleDateString('ko-KR'),
                    createdTime: now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })
                };
                
                if (!data.customCategoryMemos[currentCustomCategoryId]) {
                    data.customCategoryMemos[currentCustomCategoryId] = [];
                }
                data.customCategoryMemos[currentCustomCategoryId].push(newMemo);
                showToast('새 항목이 추가되었습니다');
            }
            
            // 저장
            localStorage.setItem('customCategoryMemos', JSON.stringify(data.customCategoryMemos));
            saveAllToIndexedDB();
            
            // 폼 닫고 리스트 업데이트
            closeCustomMemoForm();
            renderCustomCategoryMemoList();
        }

        // 커스텀 메모 상세보기
        function showCustomMemoDetail(memoId) {
            const category = data.customCategories.find(c => c.id === currentCustomCategoryId);
            if (!category) return;
            
            const memos = data.customCategoryMemos[currentCustomCategoryId] || [];
            const memo = memos.find(m => m.id === memoId);
            if (!memo) return;
            
            currentMemoId = memoId;
            
            const fields = category.fields || [{id: 1, enabled: true, type: 'text', name: '이름/제목', required: true}];
            
            // 상세 내용 생성
            let detailHtml = '';
            fields.forEach(field => {
                if (!field.enabled) return;
                const value = memo[`field${field.id}`] || '';
                if (value) {
                    detailHtml += `<div class="memo-field-item">`;
                    detailHtml += `<span class="field-label">${escapeHtml(field.name)}</span>`;
                    detailHtml += `<span class="field-value">${escapeHtml(value)}</span>`;
                    detailHtml += `</div>`;
                }
            });
            
            // 상세보기 모달 업데이트
            const titleEl = document.getElementById('memoDetailTitle');
            const bodyEl = document.getElementById('memoDetailBody');
            const dateEl = document.querySelector('#memoDetailDate span');
            
            titleEl.textContent = memo.field1 || '(제목 없음)';
            bodyEl.innerHTML = detailHtml || '<p style="color: rgba(255,255,255,0.5);">내용이 없습니다.</p>';
            dateEl.textContent = `${memo.createdAt} ${memo.createdTime || ''}`;
            
            // 테마 색상 적용 (아이콘 색상과 동기화)
            const detailModal = document.getElementById('memoDetailModal');
            detailModal.className = detailModal.className.replace(/theme-color-\d+/g, '').replace('custom-themed', '').trim();
            detailModal.classList.add('custom-themed', 'theme-color-' + category.colorId);
            
            detailModal.classList.add('active');
        }

        // ========== 백업/복원 기능 ==========
        
        // 백업 모달 열기
        function openBackupModal() {
            document.getElementById('backupModal').classList.add('active');
        }
        
        // 백업 모달 닫기
        function closeBackupModal() {
            document.getElementById('backupModal').classList.remove('active');
        }
        
        // 백업 모달 외부 클릭 시 닫기
        document.getElementById('backupModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeBackupModal();
            }
        });
        
        // 데이터 백업하기 (내보내기)
        async function exportBackupShare() {
            const backupData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                appName: '절대강자 메모장',
                data: {
                    memos: data.memos,
                    todos: data.todos,
                    todoHistory: data.todoHistory,
                    lastTodoDate: data.lastTodoDate,
                    schedules: data.schedules,
                    travels: data.travels,
                    restaurants: data.restaurants,
                    hospitals: data.hospitals,
                    sitemanages: data.sitemanages,
                    bankaccounts: data.bankaccounts,
                    ideas: data.ideas,
                    goals: data.goals,
                    cultures: data.cultures,
                    people: data.people,
                    customCategories: data.customCategories,
                    customCategoryMemos: data.customCategoryMemos,
                    hiddenMenus: hiddenMenus
                }
            };
            
            const jsonString = JSON.stringify(backupData, null, 2);
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
            const timeStr = now.toTimeString().slice(0, 5).replace(':', '');
            const filename = `메모장_백업_${dateStr}_${timeStr}.json`;
            
            if (navigator.share && navigator.canShare) {
                try {
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const file = new File([blob], filename, { type: 'application/json' });
                    
                    if (navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            title: '절대강자 메모장 백업',
                            text: `백업 날짜: ${now.toLocaleString()}`,
                            files: [file]
                        });
                        closeBackupModal();
                        showToast('백업 파일이 공유되었습니다!');
                    } else {
                        // 파일 공유가 안되면 텍스트로 공유
                        await navigator.share({
                            title: '절대강자 메모장 백업',
                            text: jsonString
                        });
                        closeBackupModal();
                        showToast('백업 데이터가 공유되었습니다!');
                    }
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        // Share API 실패 시 클립보드에 복사
                        try {
                            await navigator.clipboard.writeText(jsonString);
                            closeBackupModal();
                            showToast('백업 데이터가 클립보드에 복사되었습니다!');
                        } catch (clipErr) {
                            showToast('공유에 실패했습니다.');
                        }
                    }
                }
            } else {
                // Share API를 지원하지 않는 경우 클립보드에 복사
                try {
                    await navigator.clipboard.writeText(jsonString);
                    closeBackupModal();
                    showToast('백업 데이터가 클립보드에 복사되었습니다!');
                } catch (err) {
                    showToast('공유 기능을 지원하지 않습니다.');
                }
            }
        }
        
        // 데이터 가져오기 (복원)
        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // 유효성 검사
                    if (!backupData.appName || backupData.appName !== '절대강자 메모장') {
                        throw new Error('유효하지 않은 백업 파일입니다.');
                    }
                    
                    if (!backupData.data) {
                        throw new Error('백업 데이터가 없습니다.');
                    }
                    
                    // 확인 다이얼로그
                    const exportDate = new Date(backupData.exportDate).toLocaleString('ko-KR');
                    if (!confirm(`이 백업 파일을 복원하시겠습니까?\n\n백업 일시: ${exportDate}\n\n※ 현재 데이터가 모두 덮어씌워집니다.`)) {
                        event.target.value = '';
                        return;
                    }
                    
                    // 데이터 복원
                    const bd = backupData.data;
                    
                    if (bd.memos) {
                        data.memos = bd.memos;
                        localStorage.setItem('memos', JSON.stringify(bd.memos));
                    }
                    if (bd.todos) {
                        data.todos = bd.todos;
                        localStorage.setItem('todos', JSON.stringify(bd.todos));
                    }
                    if (bd.todoHistory) {
                        data.todoHistory = bd.todoHistory;
                        localStorage.setItem('todoHistory', JSON.stringify(bd.todoHistory));
                    }
                    if (bd.lastTodoDate) {
                        data.lastTodoDate = bd.lastTodoDate;
                        localStorage.setItem('lastTodoDate', bd.lastTodoDate);
                    }
                    if (bd.schedules) {
                        data.schedules = bd.schedules;
                        localStorage.setItem('schedules', JSON.stringify(bd.schedules));
                    }
                    if (bd.travels) {
                        data.travels = bd.travels;
                        localStorage.setItem('travels', JSON.stringify(bd.travels));
                    }
                    if (bd.restaurants) {
                        data.restaurants = bd.restaurants;
                        localStorage.setItem('restaurants', JSON.stringify(bd.restaurants));
                    }
                    if (bd.hospitals) {
                        data.hospitals = bd.hospitals;
                        localStorage.setItem('hospitals', JSON.stringify(bd.hospitals));
                    }
                    if (bd.ideas) {
                        data.ideas = bd.ideas;
                        localStorage.setItem('ideas', JSON.stringify(bd.ideas));
                    }
                    if (bd.sitemanages) {
                        data.sitemanages = bd.sitemanages;
                        localStorage.setItem('sitemanages', JSON.stringify(bd.sitemanages));
                    }
                    if (bd.bankaccounts) {
                        data.bankaccounts = bd.bankaccounts;
                        localStorage.setItem('bankaccounts', JSON.stringify(bd.bankaccounts));
                    }
                    if (bd.goals) {
                        data.goals = bd.goals;
                        localStorage.setItem('goals', JSON.stringify(bd.goals));
                    }
                    if (bd.cultures) {
                        data.cultures = bd.cultures;
                        localStorage.setItem('cultures', JSON.stringify(bd.cultures));
                    }
                    if (bd.people) {
                        data.people = bd.people;
                        localStorage.setItem('people', JSON.stringify(bd.people));
                    }
                    if (bd.customCategories) {
                        data.customCategories = bd.customCategories;
                        localStorage.setItem('customCategories', JSON.stringify(bd.customCategories));
                    }
                    if (bd.customCategoryMemos) {
                        data.customCategoryMemos = bd.customCategoryMemos;
                        localStorage.setItem('customCategoryMemos', JSON.stringify(bd.customCategoryMemos));
                    }
                    if (bd.hiddenMenus) {
                        hiddenMenus = bd.hiddenMenus;
                        localStorage.setItem('hiddenMenus', JSON.stringify(bd.hiddenMenus));
                    }
                    
                    // IndexedDB에도 전체 백업 저장
                    saveAllToIndexedDB();
                    
                    // 화면 갱신
                    renderCustomCategories();
                    applyMenuVisibility();
                    
                    closeBackupModal();
                    showToast('데이터가 성공적으로 복원되었습니다!');
                    
                } catch (error) {
                    alert('백업 파일을 읽는 중 오류가 발생했습니다.\n' + error.message);
                }
                
                event.target.value = '';
            };
            
            reader.onerror = function() {
                alert('파일을 읽는 중 오류가 발생했습니다.');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }
        
        // 모든 데이터 삭제
        function deleteAllData() {
            // 2단계 확인 절차
            if (!confirm('정말로 모든 데이터를 삭제하시겠습니까?\n\n⚠️ 이 작업은 되돌릴 수 없습니다!\n모든 메모, 일정, 메뉴가 영구적으로 삭제됩니다.')) {
                return;
            }
            
            // 2차 확인
            const confirmText = prompt('삭제를 확인하려면 "삭제"를 입력하세요:');
            if (confirmText !== '삭제') {
                showToast('삭제가 취소되었습니다.');
                return;
            }
            
            // localStorage의 모든 데이터 삭제
            const keysToDelete = [
                'memos', 'todos', 'todoHistory', 'lastTodoDate',
                'schedules', 'travels', 'restaurants', 'hospitals',
                'sitemanages', 'bankaccounts', 'ideas', 'goals',
                'cultures', 'people',
                'customCategories', 'customCategoryMemos', 'hiddenMenus'
            ];
            
            keysToDelete.forEach(key => {
                localStorage.removeItem(key);
            });
            
            // data 객체 초기화
            data.memos = [];
            data.todos = [];
            data.todoHistory = [];
            data.lastTodoDate = '';
            data.schedules = [];
            data.travels = [];
            data.restaurants = [];
            data.hospitals = [];
            data.sitemanages = [];
            data.bankaccounts = [];
            data.ideas = [];
            data.goals = [];
            data.cultures = [];
            data.people = [];
            data.customCategories = [];
            data.customCategoryMemos = {};
            hiddenMenus = [];
            
            // IndexedDB도 초기화
            saveAllToIndexedDB();
            
            // 화면 갱신
            renderCustomCategories();
            applyMenuVisibility();
            
            closeBackupModal();
            showToast('모든 데이터가 삭제되었습니다.');
        }

        // ========== 할일 목록 기능 ==========

        // 오늘 날짜 가져오기 (YYYY-MM-DD)
        function getTodayString() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        // 날짜 포맷팅 (한국어)
        function formatDateKorean(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = d.getMonth() + 1;
            const day = d.getDate();
            const weekdays = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
            const weekday = weekdays[d.getDay()];
            return { main: `${year}년 ${month}월 ${day}일`, sub: weekday };
        }

        // 할일 목록 전체화면 열기
        function openTodoFullscreen() {
            checkAndResetDailyTodos();
            document.getElementById('todoFullscreenModal').classList.add('active');
            updateTodoDateDisplay();
            renderTodoList();
            renderPastTodos();
        }

        // 할일 목록 전체화면 닫기
        function closeTodoFullscreen() {
            document.getElementById('todoFullscreenModal').classList.remove('active');
        }

        // 날짜 표시 업데이트
        function updateTodoDateDisplay() {
            const today = new Date();
            const formatted = formatDateKorean(today);
            document.getElementById('todoDateMain').textContent = formatted.main;
            document.getElementById('todoDateSub').textContent = formatted.sub;
        }

        // 자정 체크 및 할일 리셋
        function checkAndResetDailyTodos() {
            const todayStr = getTodayString();
            if (data.lastTodoDate !== todayStr) {
                // 어제 기록 저장
                if (data.lastTodoDate) {
                    saveTodoHistory(data.lastTodoDate);
                }
                // 오늘 할일 체크 상태 초기화
                data.todos.forEach(todo => {
                    if (!todo.ended) {
                        todo.completedToday = false;
                    }
                });
                data.lastTodoDate = todayStr;
                localStorage.setItem('lastTodoDate', todayStr);
                saveTodosToStorage();
            }
        }

        // 할일 기록 저장
        function saveTodoHistory(dateStr) {
            const todosForDate = data.todos.filter(todo => shouldShowTodoOnDate(todo, dateStr) && !todo.ended);
            const historyEntry = todosForDate.map(todo => ({
                id: todo.id,
                title: todo.title,
                completed: todo.completedToday || false
            }));
            if (historyEntry.length > 0) {
                data.todoHistory[dateStr] = historyEntry;
                localStorage.setItem('todoHistory', JSON.stringify(data.todoHistory));
                // IndexedDB에도 백업 저장
                saveAllToIndexedDB();
            }
        }

        // 특정 날짜에 할일이 표시되어야 하는지 확인
        function shouldShowTodoOnDate(todo, dateStr) {
            if (todo.ended) return false;
            
            const date = new Date(dateStr);
            const dayOfWeek = date.getDay();

            if (todo.repeatType === 'daily') {
                return true;
            } else if (todo.repeatType === 'weekday') {
                return todo.weekdays && todo.weekdays.includes(dayOfWeek);
            } else if (todo.repeatType === 'specific') {
                return todo.specificDate === dateStr;
            }
            return false;
        }

        // 오늘 표시할 할일 필터링
        function getTodayTodos() {
            const todayStr = getTodayString();
            return data.todos.filter(todo => shouldShowTodoOnDate(todo, todayStr));
        }

        // 할일 목록 렌더링
        function renderTodoList() {
            const container = document.getElementById('todayTodoList');
            const todayTodos = getTodayTodos();

            if (todayTodos.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #9ca3af;">
                        <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>오늘 할일이 없습니다.<br>+ 버튼을 눌러 할일을 추가해보세요!</p>
                    </div>
                `;
            } else {
                container.innerHTML = todayTodos.map(todo => `
                    <div class="todo-item ${todo.completedToday ? 'completed' : ''}" data-id="${todo.id}">
                        <div class="todo-checkbox ${todo.completedToday ? 'checked' : ''}" onclick="toggleTodoComplete(${todo.id})">
                            ${todo.completedToday ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                        <div class="todo-content">
                            <div class="todo-title">${escapeHtml(todo.title)}</div>
                            <div class="todo-meta">
                                ${getRepeatTypeTag(todo)}
                            </div>
                        </div>
                        <div class="todo-actions">
                            <button class="todo-action-btn end-btn" onclick="endTodo(${todo.id})" title="종료">
                                <i class="fas fa-stop"></i>
                            </button>
                            <button class="todo-action-btn delete-btn" onclick="deleteTodo(${todo.id})" title="삭제">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            updateSuccessRate();
        }

        // 반복 타입 태그 생성
        function getRepeatTypeTag(todo) {
            if (todo.repeatType === 'daily') {
                return '<span class="todo-tag daily"><i class="fas fa-redo"></i> 매일</span>';
            } else if (todo.repeatType === 'weekday') {
                const dayNames = ['일', '월', '화', '수', '목', '금', '토'];
                const days = todo.weekdays.map(d => dayNames[d]).join(', ');
                return `<span class="todo-tag weekday"><i class="fas fa-calendar-week"></i> ${days}</span>`;
            } else if (todo.repeatType === 'specific') {
                const date = new Date(todo.specificDate);
                const formatted = `${date.getMonth() + 1}/${date.getDate()}`;
                return `<span class="todo-tag specific"><i class="fas fa-calendar-day"></i> ${formatted}</span>`;
            }
            return '';
        }

        // 성공률 업데이트
        function updateSuccessRate() {
            const todayTodos = getTodayTodos();
            const total = todayTodos.length;
            const completed = todayTodos.filter(t => t.completedToday).length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('todoRateCircle').style.setProperty('--rate', `${rate}%`);
            document.getElementById('todoRateText').textContent = `${rate}%`;
            document.getElementById('todoRateDetail').textContent = `${completed}/${total} 완료`;

            // 색상 변경 (성공률에 따라)
            const rateText = document.getElementById('todoRateText');
            if (rate >= 80) {
                rateText.style.color = '#10b981';
            } else if (rate >= 50) {
                rateText.style.color = '#f59e0b';
            } else {
                rateText.style.color = '#ef4444';
            }
        }

        // 할일 완료 토글
        function toggleTodoComplete(id) {
            const todo = data.todos.find(t => t.id === id);
            if (todo) {
                todo.completedToday = !todo.completedToday;
                saveTodosToStorage();
                renderTodoList();
            }
        }

        // 할일 종료 (더 이상 반복 안함)
        function endTodo(id) {
            if (confirm('이 할일을 종료하시겠습니까?\n종료하면 더 이상 목록에 표시되지 않습니다.')) {
                const todo = data.todos.find(t => t.id === id);
                if (todo) {
                    todo.ended = true;
                    todo.endedAt = getTodayString();
                    saveTodosToStorage();
                    renderTodoList();
                    showToast('할일이 종료되었습니다.');
                }
            }
        }

        // 할일 삭제
        function deleteTodo(id) {
            if (confirm('이 할일을 완전히 삭제하시겠습니까?')) {
                data.todos = data.todos.filter(t => t.id !== id);
                saveTodosToStorage();
                renderTodoList();
                renderPastTodos();
                showToast('할일이 삭제되었습니다.');
            }
        }

        // localStorage에 할일 저장 (IndexedDB 백업 포함)
        function saveTodosToStorage() {
            localStorage.setItem('todos', JSON.stringify(data.todos));
            // IndexedDB에도 백업 저장
            saveAllToIndexedDB();
        }

        // 할일 추가 폼 열기
        function openTodoForm() {
            editingTodoId = null;
            document.getElementById('todoFormTitle').textContent = '새 할일 추가';
            document.getElementById('todoTitleInput').value = '';
            currentRepeatType = 'daily';
            selectedWeekdays = [];
            document.getElementById('todoSpecificDate').value = getTodayString();
            
            updateRepeatOptionUI();
            document.getElementById('todoFormModal').classList.add('active');
            document.getElementById('todoTitleInput').focus();
        }

        // 할일 추가 폼 닫기
        function closeTodoForm() {
            document.getElementById('todoFormModal').classList.remove('active');
        }

        // 반복 타입 선택
        function selectRepeatType(type) {
            currentRepeatType = type;
            updateRepeatOptionUI();
        }

        // 반복 옵션 UI 업데이트
        function updateRepeatOptionUI() {
            // 옵션 버튼 선택 상태
            document.querySelectorAll('.todo-repeat-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.type === currentRepeatType);
            });

            // 추가 선택기 표시/숨김
            document.getElementById('weekdaySelector').style.display = 
                currentRepeatType === 'weekday' ? 'block' : 'none';
            document.getElementById('specificDateSelector').style.display = 
                currentRepeatType === 'specific' ? 'block' : 'none';

            // 요일 버튼 상태 업데이트
            document.querySelectorAll('.todo-weekday-btn').forEach(btn => {
                const day = parseInt(btn.dataset.day);
                btn.classList.toggle('selected', selectedWeekdays.includes(day));
            });
        }

        // 요일 토글
        function toggleWeekday(day) {
            const index = selectedWeekdays.indexOf(day);
            if (index > -1) {
                selectedWeekdays.splice(index, 1);
            } else {
                selectedWeekdays.push(day);
            }
            updateRepeatOptionUI();
        }

        // 할일 저장
        function saveTodo() {
            const title = document.getElementById('todoTitleInput').value.trim();
            
            if (!title) {
                showToast('할일 제목을 입력해주세요.');
                return;
            }

            if (currentRepeatType === 'weekday' && selectedWeekdays.length === 0) {
                showToast('요일을 선택해주세요.');
                return;
            }

            if (currentRepeatType === 'specific') {
                const specificDate = document.getElementById('todoSpecificDate').value;
                if (!specificDate) {
                    showToast('날짜를 선택해주세요.');
                    return;
                }
            }

            const todoData = {
                id: editingTodoId || Date.now(),
                title: title,
                repeatType: currentRepeatType,
                weekdays: currentRepeatType === 'weekday' ? [...selectedWeekdays] : [],
                specificDate: currentRepeatType === 'specific' ? 
                    document.getElementById('todoSpecificDate').value : null,
                completedToday: false,
                ended: false,
                createdAt: getTodayString()
            };

            if (editingTodoId) {
                const index = data.todos.findIndex(t => t.id === editingTodoId);
                if (index > -1) {
                    todoData.completedToday = data.todos[index].completedToday;
                    data.todos[index] = todoData;
                }
            } else {
                data.todos.push(todoData);
            }

            saveTodosToStorage();
            closeTodoForm();
            renderTodoList();
            showToast(editingTodoId ? '할일이 수정되었습니다.' : '할일이 추가되었습니다!');
        }

        // 지난 할일 토글
        function togglePastTodos() {
            const list = document.getElementById('todoPastList');
            const toggle = document.getElementById('todoPastToggle');
            list.classList.toggle('expanded');
            toggle.classList.toggle('expanded');
        }

        // 지난 할일 렌더링
        function renderPastTodos() {
            const section = document.getElementById('todoPastSection');
            const container = document.getElementById('todoPastList');
            
            const historyDates = Object.keys(data.todoHistory).sort().reverse();
            
            if (historyDates.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            
            let html = '';
            historyDates.slice(0, 7).forEach(dateStr => {
                const formatted = formatDateKorean(dateStr);
                const history = data.todoHistory[dateStr];
                const completed = history.filter(h => h.completed).length;
                const total = history.length;
                const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

                html += `
                    <div class="todo-past-date-group">
                        <div class="todo-past-date-title">${formatted.main} (${formatted.sub}) - ${rate}% 달성</div>
                        ${history.map(item => `
                            <div class="todo-past-item">
                                <div class="todo-title">${escapeHtml(item.title)}</div>
                                <div class="todo-status ${item.completed ? 'completed' : 'incomplete'}">
                                    <i class="fas ${item.completed ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                                    ${item.completed ? '완료' : '미완료'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 자정 체크 타이머 (매분 확인)
        setInterval(() => {
            if (document.getElementById('todoFullscreenModal').classList.contains('active')) {
                checkAndResetDailyTodos();
                updateTodoDateDisplay();
                renderTodoList();
            }
        }, 60000);

        // 초기 로드
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('절대강자 메모장 로드 완료!');
            
            // Flutter WebView 환경 감지 및 스타일 적용 (카메라 버튼 숨김)
            applyFlutterWebViewStyles();
            
            // IndexedDB 초기화 대기 (최대 2초)
            let waitCount = 0;
            while (!isDBReady && waitCount < 20) {
                await new Promise(r => setTimeout(r, 100));
                waitCount++;
            }
            
            // IndexedDB에서 데이터 로드 및 병합 시도
            if (isDBReady) {
                try {
                    const idbData = await loadAllFromIndexedDB();
                    if (idbData) {
                        const localData = loadFromLocalStorage();
                        data = mergeData(localData, idbData);
                        console.log('IndexedDB 데이터와 병합 완료 (DOMContentLoaded)');
                    }
                } catch (e) {
                    console.warn('IndexedDB 로드 실패:', e);
                }
            }
            
            renderCustomCategories();
            checkAndResetDailyTodos();
            
            // 첫 로드 후 데이터 백업 저장
            saveAllData();
        });

        // Flutter WebView 호환성을 위한 이벤트 리스너들
        // 페이지 가시성 변경 시 저장 (앱이 백그라운드로 갈 때)
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                saveAllData();
                console.log('visibilitychange: 데이터 저장됨');
            } else if (document.visibilityState === 'visible') {
                // 앱이 다시 포그라운드로 돌아왔을 때 IndexedDB에서 데이터 확인
                (async () => {
                    if (isDBReady) {
                        const idbData = await loadAllFromIndexedDB();
                        if (idbData) {
                            const localData = loadFromLocalStorage();
                            data = mergeData(localData, idbData);
                            console.log('visibilitychange visible: 데이터 재동기화');
                        }
                    }
                })();
            }
        });

        // 페이지 언로드 전 저장
        window.addEventListener('beforeunload', () => {
            saveAllData();
            console.log('beforeunload: 데이터 저장됨');
        });

        // 모바일에서 더 신뢰성 높은 이벤트 (iOS Safari, WebView)
        window.addEventListener('pagehide', () => {
            saveAllData();
            console.log('pagehide: 데이터 저장됨');
        });

        // 포커스를 잃을 때도 저장 (추가 안전장치)
        window.addEventListener('blur', () => {
            saveAllData();
            console.log('blur: 데이터 저장됨');
        });

        // 포커스를 얻을 때 데이터 재동기화 (앱으로 돌아왔을 때)
        window.addEventListener('focus', async () => {
            if (isDBReady) {
                const idbData = await loadAllFromIndexedDB();
                if (idbData) {
                    const localData = loadFromLocalStorage();
                    data = mergeData(localData, idbData);
                    console.log('focus: 데이터 재동기화');
                }
            }
        });

        // 터치 시작 시 저장 상태 확인 (모바일 추가 안전장치)
        let lastSaveTime = Date.now();
        document.addEventListener('touchstart', () => {
            const now = Date.now();
            // 마지막 저장 이후 5초가 지났으면 저장
            if (now - lastSaveTime > 5000) {
                saveAllData();
                lastSaveTime = now;
            }
        }, { passive: true });

        // 주기적 자동 저장 (10초마다 - Flutter WebView용으로 더 자주)
        setInterval(() => {
            saveAllData();
        }, 10000);

        // ========== 캘린더 일정 관리 기능 ==========

        // 캘린더 상태
        let currentCalendarDate = new Date();
        let selectedDate = new Date();
        let editingScheduleId = null;

        // 일정 모달 열기
        function openScheduleModal() {
            document.getElementById('scheduleModal').classList.add('active');
            currentCalendarDate = new Date();
            selectedDate = new Date();
            renderCalendar();
            renderSelectedDateSchedules();
        }

        // 일정 모달 닫기
        function closeScheduleModal() {
            document.getElementById('scheduleModal').classList.remove('active');
        }

        // 캘린더 렌더링
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // 네비게이션 타이틀 업데이트
            document.getElementById('calendarNavTitle').textContent = `${year}년 ${month + 1}월`;
            
            // 캘린더 날짜 생성
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // 해당 월의 첫째 날과 마지막 날
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // 이전 달 날짜 채우기
            const startWeekday = firstDay.getDay();
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            for (let i = startWeekday - 1; i >= 0; i--) {
                const dayEl = createCalendarDay(prevMonthLastDay - i, true, year, month - 1);
                calendarDays.appendChild(dayEl);
            }
            
            // 현재 달 날짜
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const currentDate = new Date(year, month, day);
                const isToday = today.getFullYear() === year && 
                               today.getMonth() === month && 
                               today.getDate() === day;
                const isSelected = selectedDate.getFullYear() === year &&
                                  selectedDate.getMonth() === month &&
                                  selectedDate.getDate() === day;
                
                const dayEl = createCalendarDay(day, false, year, month, isToday, isSelected);
                calendarDays.appendChild(dayEl);
            }
            
            // 다음 달 날짜 채우기
            const endWeekday = lastDay.getDay();
            const remainingDays = 6 - endWeekday;
            for (let i = 1; i <= remainingDays; i++) {
                const dayEl = createCalendarDay(i, true, year, month + 1);
                calendarDays.appendChild(dayEl);
            }
        }

        // 캘린더 날짜 요소 생성
        function createCalendarDay(day, isOtherMonth, year, month, isToday = false, isSelected = false) {
            const dayEl = document.createElement('div');
            dayEl.className = 'calendar-day';
            
            if (isOtherMonth) {
                dayEl.classList.add('other-month');
            }
            if (isToday) {
                dayEl.classList.add('today');
            }
            if (isSelected) {
                dayEl.classList.add('selected');
            }
            
            // 요일 체크 (일요일, 토요일)
            const date = new Date(year, month, day);
            const weekday = date.getDay();
            if (weekday === 0) dayEl.classList.add('sunday');
            if (weekday === 6) dayEl.classList.add('saturday');
            
            // 날짜 번호
            const dayNumber = document.createElement('span');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            dayEl.appendChild(dayNumber);
            
            // 해당 날짜의 일정 확인
            const dateStr = formatDateString(year, month, day);
            const daySchedules = getSchedulesByDate(dateStr);
            
            if (daySchedules.length > 0) {
                const indicator = document.createElement('div');
                indicator.className = 'schedule-indicator';
                
                const maxDots = Math.min(daySchedules.length, 3);
                for (let i = 0; i < maxDots; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'schedule-indicator-dot';
                    if (daySchedules[i].important) {
                        dot.classList.add('important');
                    }
                    indicator.appendChild(dot);
                }
                dayEl.appendChild(indicator);
            }
            
            // 클릭 이벤트
            dayEl.onclick = () => {
                selectCalendarDate(year, month, day);
            };
            
            return dayEl;
        }

        // 날짜 선택
        function selectCalendarDate(year, month, day) {
            selectedDate = new Date(year, month, day);
            renderCalendar();
            renderSelectedDateSchedules();
        }

        // 이전 달
        function prevMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        // 다음 달
        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        // 오늘로 이동
        function goToToday() {
            currentCalendarDate = new Date();
            selectedDate = new Date();
            renderCalendar();
            renderSelectedDateSchedules();
        }

        // 날짜 문자열 포맷 (YYYY-MM-DD)
        function formatDateString(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        // 특정 날짜의 일정 가져오기
        function getSchedulesByDate(dateStr) {
            if (!data.schedules) data.schedules = [];
            return data.schedules.filter(s => s.date === dateStr)
                                 .sort((a, b) => {
                                     if (a.allDay && !b.allDay) return -1;
                                     if (!a.allDay && b.allDay) return 1;
                                     return (a.startTime || '00:00').localeCompare(b.startTime || '00:00');
                                 });
        }

        // 선택된 날짜 일정 렌더링
        function renderSelectedDateSchedules() {
            const dateStr = formatDateString(
                selectedDate.getFullYear(),
                selectedDate.getMonth(),
                selectedDate.getDate()
            );
            
            // 타이틀 업데이트
            const today = new Date();
            const isToday = today.toDateString() === selectedDate.toDateString();
            const title = document.getElementById('selectedDateTitle');
            
            if (isToday) {
                title.textContent = '오늘의 일정';
            } else {
                const month = selectedDate.getMonth() + 1;
                const day = selectedDate.getDate();
                const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
                const weekday = weekdays[selectedDate.getDay()];
                title.textContent = `${month}월 ${day}일 (${weekday}) 일정`;
            }
            
            // 일정 목록 렌더링
            const scheduleList = document.getElementById('scheduleList');
            const schedules = getSchedulesByDate(dateStr);
            
            if (schedules.length === 0) {
                scheduleList.innerHTML = `
                    <div class="schedule-empty">
                        <i class="fas fa-calendar-plus"></i>
                        <p>등록된 일정이 없습니다</p>
                    </div>
                `;
                return;
            }
            
            scheduleList.innerHTML = schedules.map(schedule => `
                <div class="schedule-item">
                    <div class="schedule-time-badge ${schedule.allDay ? 'all-day' : ''}">
                        ${schedule.allDay ? '하루 종일' : `${schedule.startTime} ~ ${schedule.endTime}`}
                    </div>
                    <div class="schedule-item-content">
                        <div class="schedule-item-title">
                            ${schedule.important ? '<i class="fas fa-star" style="color: #ffe66d; margin-right: 5px;"></i>' : ''}
                            ${escapeHtml(schedule.title)}
                        </div>
                        ${schedule.memo ? `<div class="schedule-item-memo">${escapeHtml(schedule.memo)}</div>` : ''}
                    </div>
                    <div class="schedule-item-actions">
                        <button class="schedule-item-btn" onclick="editSchedule('${schedule.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="schedule-item-btn delete" onclick="deleteSchedule('${schedule.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // HTML 이스케이프
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 일정 추가 폼 열기
        function openScheduleForm(schedule = null) {
            const modal = document.getElementById('scheduleFormModal');
            const titleEl = document.getElementById('scheduleFormTitle');
            const titleInput = document.getElementById('scheduleTitle');
            const allDayInput = document.getElementById('scheduleAllDay');
            const startTimeInput = document.getElementById('scheduleStartTime');
            const endTimeInput = document.getElementById('scheduleEndTime');
            const memoInput = document.getElementById('scheduleMemo');
            const importantInput = document.getElementById('scheduleImportant');
            
            if (schedule) {
                // 수정 모드
                editingScheduleId = schedule.id;
                titleEl.textContent = '일정 수정';
                titleInput.value = schedule.title;
                allDayInput.checked = schedule.allDay;
                startTimeInput.value = schedule.startTime || '09:00';
                endTimeInput.value = schedule.endTime || '10:00';
                memoInput.value = schedule.memo || '';
                importantInput.checked = schedule.important;
            } else {
                // 추가 모드
                editingScheduleId = null;
                titleEl.textContent = '새 일정';
                titleInput.value = '';
                allDayInput.checked = false;
                startTimeInput.value = '09:00';
                endTimeInput.value = '10:00';
                memoInput.value = '';
                importantInput.checked = false;
            }
            
            toggleTimeInputs();
            modal.classList.add('active');
            titleInput.focus();
        }

        // 일정 폼 닫기
        function closeScheduleForm() {
            document.getElementById('scheduleFormModal').classList.remove('active');
            editingScheduleId = null;
        }

        // 시간 입력 토글
        function toggleTimeInputs() {
            const allDay = document.getElementById('scheduleAllDay').checked;
            const timeGroup = document.getElementById('scheduleTimeGroup');
            timeGroup.style.display = allDay ? 'none' : 'block';
        }

        // 일정 저장
        function saveSchedule() {
            const title = document.getElementById('scheduleTitle').value.trim();
            const allDay = document.getElementById('scheduleAllDay').checked;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const memo = document.getElementById('scheduleMemo').value.trim();
            const important = document.getElementById('scheduleImportant').checked;
            
            if (!title) {
                showToast('일정 제목을 입력해주세요!');
                return;
            }
            
            const dateStr = formatDateString(
                selectedDate.getFullYear(),
                selectedDate.getMonth(),
                selectedDate.getDate()
            );
            
            if (!data.schedules) data.schedules = [];
            
            if (editingScheduleId) {
                // 수정
                const index = data.schedules.findIndex(s => s.id === editingScheduleId);
                if (index !== -1) {
                    data.schedules[index] = {
                        ...data.schedules[index],
                        title,
                        allDay,
                        startTime: allDay ? null : startTime,
                        endTime: allDay ? null : endTime,
                        memo,
                        important,
                        updatedAt: Date.now()
                    };
                }
                showToast('일정이 수정되었습니다!');
            } else {
                // 추가
                const newSchedule = {
                    id: 'sch_' + Date.now(),
                    date: dateStr,
                    title,
                    allDay,
                    startTime: allDay ? null : startTime,
                    endTime: allDay ? null : endTime,
                    memo,
                    important,
                    createdAt: Date.now()
                };
                data.schedules.push(newSchedule);
                showToast('일정이 추가되었습니다!');
            }
            
            // 저장
            localStorage.setItem('schedules', JSON.stringify(data.schedules));
            saveToIndexedDB('schedules', data.schedules);
            
            closeScheduleForm();
            renderCalendar();
            renderSelectedDateSchedules();
        }

        // 일정 수정
        function editSchedule(id) {
            const schedule = data.schedules.find(s => s.id === id);
            if (schedule) {
                openScheduleForm(schedule);
            }
        }

        // 일정 삭제
        function deleteSchedule(id) {
            if (!confirm('이 일정을 삭제하시겠습니까?')) return;
            
            data.schedules = data.schedules.filter(s => s.id !== id);
            localStorage.setItem('schedules', JSON.stringify(data.schedules));
            saveToIndexedDB('schedules', data.schedules);
            
            renderCalendar();
            renderSelectedDateSchedules();
            showToast('일정이 삭제되었습니다!');
        }

        // =====================================================
        // 메뉴 관리 기능 (숨김/복원)
        // =====================================================

        // 기본 메뉴 정의 (id, 이름, 아이콘, 색상 클래스, 카테고리)
        const defaultMenus = [
            { id: 'memo', name: '일반 메모', icon: 'fa-sticky-note', colorClass: 'memo-general', category: '기록' },
            { id: 'todo', name: '할일 목록', icon: 'fa-check-square', colorClass: 'todo-list', category: '일정' },
            { id: 'schedule', name: '일정 관리', icon: 'fa-calendar-alt', colorClass: 'schedule', category: '일정' },
            { id: 'travel', name: '여행 관리', icon: 'fa-plane', colorClass: 'travel', category: '생활' },
            { id: 'restaurant', name: '맛집 관리', icon: 'fa-utensils', colorClass: 'restaurant', category: '생활' },
            { id: 'hospital', name: '병원 관리', icon: 'fa-hospital', colorClass: 'hospital', category: '건강' },
            { id: 'sitemanage', name: '사이트 관리', icon: 'fa-globe', colorClass: 'sitemanage', category: '정보' },
            { id: 'bankaccount', name: '계좌번호 관리', icon: 'fa-university', colorClass: 'bankaccount', category: '금융' },
            { id: 'culture', name: '문화 관리', icon: 'fa-theater-masks', colorClass: 'culture', category: '취미' },
            { id: 'people', name: '사람 관리', icon: 'fa-users', colorClass: 'people', category: '관계' }
        ];

        // 숨긴 메뉴 목록 (localStorage에서 로드)
        let hiddenMenus = safeJSONParse(localStorage.getItem('hiddenMenus'), []);

        // 메뉴 관리 모달 열기
        function openMenuManageModal() {
            document.getElementById('menuManageModal').classList.add('active');
            switchMenuManageTab('visible');
            renderMenuManageLists();
        }

        // 메뉴 관리 모달 닫기
        function closeMenuManageModal() {
            document.getElementById('menuManageModal').classList.remove('active');
        }

        // 탭 전환
        function switchMenuManageTab(tab) {
            document.getElementById('visibleMenuTab').classList.toggle('active', tab === 'visible');
            document.getElementById('hiddenMenuTab').classList.toggle('active', tab === 'hidden');
            document.getElementById('visibleMenuSection').classList.toggle('active', tab === 'visible');
            document.getElementById('hiddenMenuSection').classList.toggle('active', tab === 'hidden');
        }

        // 메뉴 관리 리스트 렌더링
        function renderMenuManageLists() {
            renderVisibleMenuList();
            renderHiddenMenuList();
        }

        // 표시 중인 메뉴 리스트 렌더링
        function renderVisibleMenuList() {
            const container = document.getElementById('visibleMenuList');
            const visibleMenus = defaultMenus.filter(m => !hiddenMenus.includes(m.id));
            
            // 커스텀 카테고리도 포함
            const customCats = data.customCategories || [];
            const visibleCustom = customCats.filter(c => !hiddenMenus.includes('custom_' + c.id));

            if (visibleMenus.length === 0 && visibleCustom.length === 0) {
                container.innerHTML = `
                    <div class="menu-manage-empty">
                        <i class="fas fa-eye-slash"></i>
                        <p>표시 중인 메뉴가 없습니다.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            // 기본 메뉴
            visibleMenus.forEach(menu => {
                html += `
                    <div class="menu-manage-item">
                        <div class="menu-manage-item-icon ${menu.colorClass}">
                            <i class="fas ${menu.icon}"></i>
                        </div>
                        <div class="menu-manage-item-info">
                            <div class="menu-manage-item-name">${menu.name}</div>
                            <div class="menu-manage-item-category">${menu.category}</div>
                        </div>
                        <div class="menu-manage-item-actions">
                            <button class="menu-manage-action-btn hide" onclick="hideMenu('${menu.id}')" title="숨기기">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            // 커스텀 카테고리
            visibleCustom.forEach(cat => {
                html += `
                    <div class="menu-manage-item">
                        <div class="menu-manage-item-icon custom-gradient-${cat.colorId}">
                            <i class="fas ${cat.icon}"></i>
                        </div>
                        <div class="menu-manage-item-info">
                            <div class="menu-manage-item-name">${escapeHtml(cat.name)}</div>
                            <div class="menu-manage-item-category">커스텀 메뉴</div>
                        </div>
                        <div class="menu-manage-item-actions">
                            <button class="menu-manage-action-btn hide" onclick="hideMenu('custom_${cat.id}')" title="숨기기">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                            <button class="menu-manage-action-btn delete" onclick="deleteCustomCategoryFromManage(${cat.id})" title="삭제">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 숨긴 메뉴 리스트 렌더링
        function renderHiddenMenuList() {
            const container = document.getElementById('hiddenMenuList');
            
            // 기본 메뉴 중 숨긴 것
            const hiddenDefaultMenus = defaultMenus.filter(m => hiddenMenus.includes(m.id));
            
            // 커스텀 카테고리 중 숨긴 것
            const customCats = data.customCategories || [];
            const hiddenCustom = customCats.filter(c => hiddenMenus.includes('custom_' + c.id));

            if (hiddenDefaultMenus.length === 0 && hiddenCustom.length === 0) {
                container.innerHTML = `
                    <div class="menu-manage-empty">
                        <i class="fas fa-check-circle"></i>
                        <p>숨긴 메뉴가 없습니다.<br>모든 메뉴가 표시되고 있어요!</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            // 기본 메뉴
            hiddenDefaultMenus.forEach(menu => {
                html += `
                    <div class="menu-manage-item">
                        <div class="menu-manage-item-icon ${menu.colorClass}">
                            <i class="fas ${menu.icon}"></i>
                        </div>
                        <div class="menu-manage-item-info">
                            <div class="menu-manage-item-name">${menu.name}</div>
                            <div class="menu-manage-item-category">${menu.category}</div>
                        </div>
                        <div class="menu-manage-item-actions">
                            <button class="menu-manage-action-btn show" onclick="showMenu('${menu.id}')" title="표시하기">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            // 커스텀 카테고리
            hiddenCustom.forEach(cat => {
                html += `
                    <div class="menu-manage-item">
                        <div class="menu-manage-item-icon custom-gradient-${cat.colorId}">
                            <i class="fas ${cat.icon}"></i>
                        </div>
                        <div class="menu-manage-item-info">
                            <div class="menu-manage-item-name">${escapeHtml(cat.name)}</div>
                            <div class="menu-manage-item-category">커스텀 메뉴</div>
                        </div>
                        <div class="menu-manage-item-actions">
                            <button class="menu-manage-action-btn show" onclick="showMenu('custom_${cat.id}')" title="표시하기">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="menu-manage-action-btn delete" onclick="deleteCustomCategoryFromManage(${cat.id})" title="삭제">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 메뉴 숨기기
        function hideMenu(menuId) {
            if (!hiddenMenus.includes(menuId)) {
                hiddenMenus.push(menuId);
                saveHiddenMenus();
                applyMenuVisibility();
                renderMenuManageLists();
                showToast('메뉴가 숨겨졌습니다.');
            }
        }

        // 메뉴 표시하기
        function showMenu(menuId) {
            hiddenMenus = hiddenMenus.filter(id => id !== menuId);
            saveHiddenMenus();
            applyMenuVisibility();
            renderMenuManageLists();
            showToast('메뉴가 복원되었습니다.');
        }

        // 숨긴 메뉴 저장
        function saveHiddenMenus() {
            localStorage.setItem('hiddenMenus', JSON.stringify(hiddenMenus));
            // IndexedDB에도 저장
            if (db) {
                saveToIndexedDB('hiddenMenus', hiddenMenus);
            }
        }

        // 메뉴 가시성 적용 (홈화면)
        function applyMenuVisibility() {
            // 기본 메뉴들 숨김/표시 적용
            defaultMenus.forEach(menu => {
                const gridItem = document.querySelector(`.grid-item[data-menu-id="${menu.id}"]`);
                if (gridItem) {
                    if (hiddenMenus.includes(menu.id)) {
                        gridItem.classList.add('hidden-menu');
                    } else {
                        gridItem.classList.remove('hidden-menu');
                    }
                }
            });

            // 커스텀 카테고리 숨김/표시 적용
            const customCats = data.customCategories || [];
            customCats.forEach(cat => {
                const wrapper = document.querySelector(`.custom-category-wrapper[data-category-id="${cat.id}"]`);
                if (wrapper) {
                    if (hiddenMenus.includes('custom_' + cat.id)) {
                        wrapper.classList.add('hidden-menu');
                    } else {
                        wrapper.classList.remove('hidden-menu');
                    }
                }
            });
        }

        // 메뉴 관리에서 커스텀 카테고리 삭제
        function deleteCustomCategoryFromManage(id) {
            const category = data.customCategories.find(c => c.id === id);
            if (!category) return;

            if (confirm(`'${category.name}' 메뉴를 완전히 삭제하시겠습니까?\n(해당 메뉴의 메모도 모두 삭제됩니다)`)) {
                // 숨긴 메뉴 목록에서도 제거
                hiddenMenus = hiddenMenus.filter(m => m !== 'custom_' + id);
                saveHiddenMenus();
                
                // 카테고리 및 메모 삭제
                data.customCategories = data.customCategories.filter(c => c.id !== id);
                delete data.customCategoryMemos[id];
                
                localStorage.setItem('customCategories', JSON.stringify(data.customCategories));
                localStorage.setItem('customCategoryMemos', JSON.stringify(data.customCategoryMemos));
                saveAllToIndexedDB();

                renderCustomCategories();
                renderMenuManageLists();
                showToast('메뉴가 삭제되었습니다.');
            }
        }

        // 페이지 로드 시 메뉴 가시성 적용
        document.addEventListener('DOMContentLoaded', function() {
            // 약간의 지연 후 적용 (커스텀 카테고리가 렌더링된 후)
            setTimeout(applyMenuVisibility, 100);
            
            // Flutter WebView 카메라 캡처 호환성 개선
            setupFlutterWebViewCameraCompat();
        });

        // Flutter WebView 카메라 캡처 호환성 설정
        function setupFlutterWebViewCameraCompat() {
            if (!isFlutterWebView()) return;
            
            console.log('Flutter WebView 카메라 호환성 설정 적용');
            
            // 모든 카메라 input에 대해 이벤트 핸들러 강화
            const cameraInputs = document.querySelectorAll('input[type="file"][capture]');
            cameraInputs.forEach(input => {
                // 기존 onchange 외에 추가 리스너 등록
                input.addEventListener('change', function(e) {
                    handleFlutterCameraCapture(e, input);
                }, { capture: true });
                
                // blur 이벤트로 캡처 완료 감지 (일부 WebView에서 필요)
                input.addEventListener('blur', function(e) {
                    setTimeout(() => {
                        if (input.files && input.files.length > 0) {
                            handleFlutterCameraCapture({ target: input }, input);
                        }
                    }, 300);
                });
            });
            
            // 모든 갤러리 input에도 동일 처리
            const galleryInputs = document.querySelectorAll('input[type="file"]:not([capture])');
            galleryInputs.forEach(input => {
                if (input.accept && input.accept.includes('image')) {
                    input.addEventListener('change', function(e) {
                        handleFlutterGallerySelect(e, input);
                    }, { capture: true });
                }
            });
        }

        // Flutter WebView에서 카메라 캡처 처리
        function handleFlutterCameraCapture(event, input) {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            
            // formType 추출
            const inputId = input.id;
            let formType = 'memo';
            
            if (inputId.includes('people')) formType = 'people';
            else if (inputId.includes('culture')) formType = 'culture';
            else if (inputId.includes('travel')) formType = 'travel';
            else if (inputId.includes('restaurant')) formType = 'restaurant';
            else if (inputId.includes('hospital')) formType = 'hospital';
            else if (inputId.includes('memo')) formType = 'memo';
            
            console.log('Flutter 카메라 캡처 처리:', formType, file.name);
            
            // 파일을 base64로 변환하여 처리
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                // 이미지 리사이징 후 적용
                resizeImage(imageData, 800, 800, function(resizedImage) {
                    applyImageToForm(formType, resizedImage, 'camera');
                });
            };
            reader.onerror = function(e) {
                console.error('파일 읽기 오류:', e);
                showToast('이미지를 처리하는 중 오류가 발생했습니다.');
            };
            reader.readAsDataURL(file);
        }

        // Flutter WebView에서 갤러리 선택 처리
        function handleFlutterGallerySelect(event, input) {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            
            // formType 추출
            const inputId = input.id;
            let formType = 'memo';
            
            if (inputId.includes('people')) formType = 'people';
            else if (inputId.includes('culture')) formType = 'culture';
            else if (inputId.includes('travel')) formType = 'travel';
            else if (inputId.includes('restaurant')) formType = 'restaurant';
            else if (inputId.includes('hospital')) formType = 'hospital';
            else if (inputId.includes('memo')) formType = 'memo';
            
            console.log('Flutter 갤러리 선택 처리:', formType, file.name);
        }

        // 폼에 이미지 적용
        function applyImageToForm(formType, imageData, source) {
            if (formType === 'memo') {
                currentMemoImage = imageData;
                const previewEl = document.getElementById('memoImagePreview');
                const containerEl = document.getElementById('memoImagePreviewContainer');
                if (previewEl) previewEl.src = imageData;
                if (containerEl) containerEl.classList.add('active');
            } else {
                if (typeof currentFormImages !== 'undefined') {
                    currentFormImages[formType] = imageData;
                }
                const previewEl = document.getElementById(formType + 'ImagePreview');
                const containerEl = document.getElementById(formType + 'ImagePreviewContainer');
                if (previewEl) previewEl.src = imageData;
                if (containerEl) containerEl.classList.add('active');
            }
            
            if (source === 'camera') {
                showToast('📸 사진이 추가되었습니다');
            } else {
                showToast('🖼️ 이미지가 추가되었습니다');
            }
        }

        // Flutter에서 직접 이미지 데이터를 설정하는 함수 (Flutter 앱에서 호출 가능)
        window.setFormImageFromFlutter = function(formType, base64ImageData, source) {
            try {
                let imageData = base64ImageData;
                if (!imageData.startsWith('data:image')) {
                    imageData = 'data:image/jpeg;base64,' + imageData;
                }
                
                resizeImage(imageData, 800, 800, function(resizedImage) {
                    applyImageToForm(formType, resizedImage, source || 'camera');
                });
                
                return { success: true };
            } catch (e) {
                console.error('Flutter 이미지 설정 오류:', e);
                return { success: false, error: e.message };
            }
        };

        // 커스텀 카테고리 렌더링 후 가시성 재적용
        const originalRenderCustomCategories = renderCustomCategories;
        renderCustomCategories = function() {
            originalRenderCustomCategories();
            setTimeout(applyMenuVisibility, 50);
        };
    </script>
</body>
</html>
